!function(t){t.fn.drawFunnel=function(i,e){var n=t.extend({width:t(this).width(),height:t(this).height(),padding:1,half:!1,minSegmentSize:0,label:function(){return""}},e);n.width=n.half?2*n.width:n.width;var d=i.length,h=i.reduce(function(t,i){return t+i.value},0),o=Math.round((n.height-n.padding*d)/d),a=t('<div id="funnel" style="width: '+n.width+"px; height: "+n.height+'px; overflow: hidden;"></div>').appendTo(this),l=n.width,r=1,p=0;return t.each(i,function(i,e){var d=e.color,s=e.value/h,g=l-Math.round(s*n.width);g=g>n.minSegmentSize?g:n.minSegmentSize;var u="border-"+(r>s?"top":"bottom")+": "+o+"px solid "+d+";",x=Math.ceil((l-g)/2);u+="height: 0;",u+="margin-bottom: "+n.padding+"px;",u+="border-right: "+x+"px solid transparent;",u+="border-left: "+x+"px solid transparent;",u+="margin-left: "+(n.half?p-Math.round(n.width/2):p-(r<s?x:0))+"px;",u+=r<s?"width: "+l+"px;":"width: "+g+"px;";var f=n.label(e.labelstr),w=t('<div class="funnel-segment" style="'+u+' box-sizing: content-box; -webkit-box-sizing: content-box; -moz-box-sizing: content-box;"></div>').appendTo(a),b=t('<div class="funnel-label" style="display: inline">'+f+"</div>").appendTo(w),c=o/2+b.height()/2,v=(n.half?l+n.width/2:l)/2-b.width()/2-x;b.css({top:"-"+Math.round(c)+"px",left:Math.round(v)+"px",position:"relative"}),l=g,p+=x,r=s}),this}}(jQuery);