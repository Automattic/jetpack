{"version":3,"file":"lazy-images.js","mappings":"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","sources":["webpack:///./src/js/lazy-images.js"],"sourcesContent":["/* global jetpackLazyImagesL10n */\n\nconst jetpackLazyImagesModule = function () {\n\tconst config = {\n\t\t// If the image gets within 200px in the Y axis, start the download.\n\t\trootMargin: '200px 0px',\n\t\tthreshold: 0.01,\n\t};\n\tconst loadingImages = [];\n\tlet lazyImages, loadingWarning, observer;\n\n\tlazy_load_init();\n\n\tconst bodyEl = document.querySelector( 'body' );\n\tif ( bodyEl ) {\n\t\t// Lazy load images that are brought in from Infinite Scroll\n\t\tbodyEl.addEventListener( 'is.post-load', lazy_load_init );\n\n\t\t// Add event to provide optional compatibility for other code.\n\t\tbodyEl.addEventListener( 'jetpack-lazy-images-load', lazy_load_init );\n\t}\n\n\t/**\n\t * Initialize the module.\n\t */\n\tfunction lazy_load_init() {\n\t\tlazyImages = Array.from(\n\t\t\tdocument.querySelectorAll( 'img.jetpack-lazy-image:not(.jetpack-lazy-image--handled)' )\n\t\t);\n\n\t\t// If initialized, then disconnect the observer\n\t\tif ( observer ) {\n\t\t\tobserver.disconnect();\n\t\t}\n\n\t\t// If we don't have support for intersection observer, loads the images immediately\n\t\tif ( ! ( 'IntersectionObserver' in window ) ) {\n\t\t\tloadAllImages();\n\t\t} else {\n\t\t\t// It is supported, load the images\n\t\t\tobserver = new IntersectionObserver( onIntersection, config );\n\n\t\t\tlazyImages.forEach( function ( image ) {\n\t\t\t\tif ( ! image.getAttribute( 'data-lazy-loaded' ) ) {\n\t\t\t\t\tobserver.observe( image );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// Watch for attempts to print, and load all images. Most browsers\n\t\t\t// support beforeprint, Safari needs a media listener. Doesn't hurt\n\t\t\t// to double-fire if a browser supports both.\n\t\t\twindow.addEventListener( 'beforeprint', onPrint );\n\t\t\tif ( window.matchMedia ) {\n\t\t\t\twindow.matchMedia( 'print' ).addListener( function ( mql ) {\n\t\t\t\t\tif ( mql.matches ) {\n\t\t\t\t\t\tonPrint();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Load all of the images immediately\n\t */\n\tfunction loadAllImages() {\n\t\tif ( observer ) {\n\t\t\tobserver.disconnect();\n\t\t}\n\n\t\twhile ( lazyImages.length > 0 ) {\n\t\t\tapplyImage( lazyImages[ 0 ] );\n\t\t}\n\t}\n\n\t/**\n\t * On intersection\n\t *\n\t * @param {Array} entries - List of elements being observed.\n\t */\n\tfunction onIntersection( entries ) {\n\t\t// Loop through the entries\n\t\tfor ( let i = 0; i < entries.length; i++ ) {\n\t\t\tconst entry = entries[ i ];\n\n\t\t\t// Are we in viewport?\n\t\t\tif ( entry.intersectionRatio > 0 ) {\n\t\t\t\t// Stop watching and load the image\n\t\t\t\tobserver.unobserve( entry.target );\n\t\t\t\tapplyImage( entry.target );\n\t\t\t}\n\t\t}\n\n\t\t// Disconnect if we've already loaded all of the images\n\t\tif ( lazyImages.length === 0 ) {\n\t\t\tobserver.disconnect();\n\t\t}\n\t}\n\n\t/**\n\t * On print\n\t */\n\tfunction onPrint() {\n\t\tif ( ! loadingWarning && ( lazyImages.length > 0 || loadingImages.length > 0 ) ) {\n\t\t\t// Replace the printed page with a notice that images are still loading.\n\t\t\t// Hopefully the user won't actually print this, but if they do at least it'll not\n\t\t\t// waste too much ink.\n\t\t\tloadingWarning = document.createElement( 'div' );\n\t\t\tloadingWarning.id = 'loadingWarning';\n\t\t\tloadingWarning.style.fontWeight = 'bold';\n\t\t\tloadingWarning.innerText = jetpackLazyImagesL10n.loading_warning;\n\n\t\t\tconst s = document.createElement( 'style' );\n\t\t\ts.innerHTML =\n\t\t\t\t'#loadingWarning { display: none; }\\n@media print {\\n#loadingWarning { display: block; }\\nbody > #loadingWarning ~ * { display: none !important; }\\n}';\n\t\t\tloadingWarning.appendChild( s );\n\n\t\t\tbodyEl.insertBefore( loadingWarning, bodyEl.firstChild );\n\t\t}\n\n\t\tif ( lazyImages.length > 0 ) {\n\t\t\tloadAllImages();\n\t\t}\n\n\t\t// May as well try an alert() too. The browser may block it, but if not\n\t\t// it could save them some trouble.\n\t\tif ( loadingWarning ) {\n\t\t\talert( jetpackLazyImagesL10n.loading_warning );\n\t\t}\n\t}\n\n\t/**\n\t * Apply the image\n\t *\n\t * @param {Element} image - The image object.\n\t */\n\tfunction applyImage( image ) {\n\t\tlet lazyLoadedImageEvent;\n\n\t\tif ( ! ( image instanceof HTMLImageElement ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst srcset = image.getAttribute( 'data-lazy-srcset' );\n\t\tconst sizes = image.getAttribute( 'data-lazy-sizes' );\n\n\t\t// Remove lazy attributes.\n\t\timage.removeAttribute( 'data-lazy-srcset' );\n\t\timage.removeAttribute( 'data-lazy-sizes' );\n\t\timage.removeAttribute( 'data-lazy-src' );\n\n\t\t// Add the attributes we want.\n\t\timage.classList.add( 'jetpack-lazy-image--handled' );\n\t\timage.setAttribute( 'data-lazy-loaded', 1 );\n\n\t\tif ( sizes ) {\n\t\t\timage.setAttribute( 'sizes', sizes );\n\t\t}\n\n\t\tif ( ! srcset ) {\n\t\t\timage.removeAttribute( 'srcset' );\n\t\t} else {\n\t\t\timage.setAttribute( 'srcset', srcset );\n\t\t}\n\n\t\t// Force eager loading, otherwise the browser-native loading=lazy support will still\n\t\t// prevent the loading.\n\t\timage.setAttribute( 'loading', 'eager' );\n\n\t\tloadingImages.push( image );\n\t\tconst idx = lazyImages.indexOf( image );\n\t\tif ( idx >= 0 ) {\n\t\t\tlazyImages.splice( idx, 1 );\n\t\t}\n\n\t\tif ( image.complete ) {\n\t\t\tloadedImage.call( image, null );\n\t\t} else {\n\t\t\timage.addEventListener( 'load', loadedImage, { once: true } );\n\t\t\timage.addEventListener( 'error', loadedImage, { once: true } );\n\t\t}\n\n\t\t// Hack for Safari: it does not respect srcset changes for img tags outside\n\t\t// of <figure> tags. So, we need to force Safari to re-parse that bit of HTML.\n\t\tif ( 'undefined' !== typeof safari ) {\n\t\t\t// eslint-disable-next-line no-self-assign\n\t\t\timage.outerHTML = image.outerHTML;\n\t\t}\n\n\t\t// Fire an event so that third-party code can perform actions after an image is loaded.\n\t\ttry {\n\t\t\tlazyLoadedImageEvent = new Event( 'jetpack-lazy-loaded-image', {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t} );\n\t\t} catch ( e ) {\n\t\t\tlazyLoadedImageEvent = document.createEvent( 'Event' );\n\t\t\tlazyLoadedImageEvent.initEvent( 'jetpack-lazy-loaded-image', true, true );\n\t\t}\n\n\t\timage.dispatchEvent( lazyLoadedImageEvent );\n\t}\n\n\t/**\n\t * An image from applyImage() finished loading.\n\t */\n\tfunction loadedImage() {\n\t\tconst idx = loadingImages.indexOf( this );\n\t\tif ( idx >= 0 ) {\n\t\t\tloadingImages.splice( idx, 1 );\n\t\t}\n\n\t\tif ( loadingWarning && lazyImages.length === 0 && loadingImages.length === 0 ) {\n\t\t\tloadingWarning.parentNode.removeChild( loadingWarning );\n\t\t\tloadingWarning = null;\n\t\t}\n\t}\n};\n\n// Let's kick things off now\nif ( document.readyState === 'interactive' || document.readyState === 'complete' ) {\n\tjetpackLazyImagesModule();\n} else {\n\tdocument.addEventListener( 'DOMContentLoaded', jetpackLazyImagesModule );\n}\n"],"names":["jetpackLazyImagesModule","config","rootMargin","threshold","loadingImages","lazyImages","loadingWarning","observer","lazy_load_init","bodyEl","document","querySelector","addEventListener","Array","from","querySelectorAll","disconnect","window","loadAllImages","IntersectionObserver","onIntersection","forEach","image","getAttribute","observe","onPrint","matchMedia","addListener","mql","matches","length","applyImage","entries","i","entry","intersectionRatio","unobserve","target","createElement","id","style","fontWeight","innerText","jetpackLazyImagesL10n","loading_warning","s","innerHTML","appendChild","insertBefore","firstChild","alert","lazyLoadedImageEvent","HTMLImageElement","srcset","sizes","removeAttribute","classList","add","setAttribute","push","idx","indexOf","splice","complete","loadedImage","call","once","safari","outerHTML","Event","bubbles","cancelable","e","createEvent","initEvent","dispatchEvent","parentNode","removeChild","readyState"],"sourceRoot":""}