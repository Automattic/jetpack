# WAF (Web Application Firewall)

Tools to implement and assist with the Jetpack Web Application Firewall.

Need to report a security vulnerability? Go to [https://automattic.com/security/](https://automattic.com/security/) or directly to our security bug bounty site [https://hackerone.com/automattic](https://hackerone.com/automattic).

## Standalone Mode

The WAF can be executed before WordPress initializes. This is accomplished by pointing the `auto_prepend_file` PHP directive to point to the `bootstrap.php` file generated by the WAF.

It is therefore important that any functionality that runs during the execution of the firewall to not depend on the WordPress environment to already be initialized. 

## CLI

The WAF provides a command-line interface via the WP CLI.

View available commands by running `jetpack docker wp jetpack-waf --help` from the root of the monorepo.

## General Architecture

The WAF is primarily a collection of PHP classes that work together to execute the firewall. 

Some high level classes to be aware of:
* `Waf_Manager` - Generic top-level class that provides methods for managing and updating the waf package and its configuration.
* `Waf_Initializer` - Initializes the WAF to run in the WordPress environment.
* `Waf_Standalone_Bootstrap` - Generates the code that runs the firewall when it is in "Standalone Mode", outside of the WordPress environment.
* `Waf_Runner` - Responsible for actually running the firewall against a request, in any environment.

## Testing

PHPUnit tests can be found in `./tests/php/`.

Trigger these tests by running `jetpack test packages/waf php` from the root of the monorepo.

## License

waf is licensed under [GNU General Public License v2 (or later)](./LICENSE.txt)
