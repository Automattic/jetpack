/* Do not modify this file directly. It is compiled from other files. */
/* global idcL10n, jQuery, analytics, history, wpCookies */
!function(e){function i(){u.prop("disabled",!0)}function c(){u.prop("disabled",!1)}function n(){v.hide(),s("confirm_safe_mode");var n=p+"jetpack/v4/identity-crisis/confirm-safe-mode";i(),e.ajax({method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",d)},url:n,data:{},success:function(){l.hide(),h.removeClass("hide"),window.location.search&&1===window.location.search.indexOf("page=jetpack")&&window.location.reload()},error:function(e){g="confirm",r(e),c()}})}function t(){v.hide(),s("migrate");var n=p+"jetpack/v4/identity-crisis/migrate";i(),e.ajax({method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",d)},url:n,data:{},success:function(){l.hide(),e("body").hasClass("toplevel_page_jetpack")&&window.location.reload(!0)},error:function(e){g="migrate",r(e),c()}})}function o(){v.hide(),s("fix_connection"),l.addClass("jp-idc-show-second-step")}function a(){v.hide(),s("start_fresh");var n=p+"jetpack/v4/identity-crisis/start-fresh";i(),e.ajax({method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",d)},url:n,data:{},success:function(e){window.location=e+"&from=idc-notice"},error:function(e){g="start-fresh",r(e),c()}})}function r(i){var c=e(".jp-idc-error__desc");i&&i.responseJSON&&i.responseJSON.message?c.html(i.responseJSON.message):c.html(""),v.css("display","flex")}function s(e,i){void 0!==i&&"object"==typeof i||(i={}),e&&e.length&&"undefined"!=typeof analytics&&analytics.tracks&&analytics.mc&&(e=e.replace(/-/g,"_"),e=0!==e.indexOf("jetpack_idc_")?"jetpack_idc_"+e:e,analytics.tracks.recordEvent(e,i),e=e.replace("jetpack_idc_",""),e=e.replace(/_/g,"-"),analytics.mc.bumpStat("jetpack-idc",e))}var d=idcL10n.nonce,f=idcL10n.currentUrl,p=idcL10n.apiRoot,l=e(".jp-idc-notice"),u=e(".jp-idc-notice .dops-button"),m=idcL10n.tracksUserData,_=idcL10n.tracksEventData,h=e("#wp-admin-bar-jetpack-idc"),j=e("#jp-idc-confirm-safe-mode-action"),k=e("#jp-idc-fix-connection-action"),w=e("#jp-idc-migrate-action"),y=e("#jp-idc-reconnect-site-action"),v=e(".jp-idc-error__notice"),g=!1;"undefined"!=typeof analytics&&analytics.initialize(m.userid,m.username),_.isAdmin?s("notice_view"):s("non_admin_notice_view",{page:_.currentScreen}),function(e){e=void 0!==e&&e,window.location.search&&-1!==window.location.search.indexOf("jetpack_idc_clear_confirmation")&&(s("clear_confirmation_clicked"),history&&history.pushState?history.pushState({},"",f):e&&(window.location.href=f))}(),l.on("click",".notice-dismiss",function(){var e="https:"===window.location.protocol;wpCookies.set("jetpack_idc_dismiss_notice","1",604800,!1,!1,e),s("non_admin_notice_dismiss",{page:_.currentScreen})}),l.on("click","#jp-idc-error__action",function(){switch(v.hide(),g){case"confirm":n();break;case"start-fresh":a();break;case"migrate":t();break;default:return}}),j.on("click",n),k.on("click",o),y.on("click",a),w.on("click",t)}(jQuery);