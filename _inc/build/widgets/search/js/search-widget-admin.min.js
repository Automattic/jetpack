/* Do not modify this file directly. It is compiled from other files. */
/* globals jetpack_search_filter_admin, jQuery, analytics */
!function(e,t){function a(a){var s=null,c=null,i=null,r=a.find(".filter-select").val();"taxonomy"===r?s=a.find(".taxonomy-select option:selected").text().trim():"date_histogram"===r&&t&&t.i18n?(c=-1!==a.find(".date-field-select").val().indexOf("modified"),i="month"===a.find(".date-interval-select").val(),s=i?c?t.i18n.monthUpdated:t.i18n.month:c?t.i18n.yearUpdated:t.i18n.year):s=a.find(".filter-select option:selected").text().trim(),e(a).find(".jetpack-search-filters-widget__title input").prop("placeholder",s)}function s(e,t){void 0!==t&&"object"==typeof t||(t={}),e&&e.length&&"undefined"!=typeof analytics&&analytics.tracks&&analytics.mc&&(e=e.replace(/-/g,"_"),e=0!==e.indexOf("jetpack_widget_search_")?"jetpack_widget_search_"+e:e,analytics.tracks.recordEvent(e,t),e=e.replace("jetpack_widget_search_",""),e=e.replace(/_/g,"-"),analytics.mc.bumpStat("jetpack-search-widget",e))}var c=void 0!==t&&t.defaultFilterCount?t.defaultFilterCount:5;e(document).ready(function(){r(),window.JetpackSearch=window.JetpackSearch||{},window.JetpackSearch.addFilter=i,"undefined"!=typeof analytics&&t.tracksUserData&&analytics.initialize(t.tracksUserData.userid,t.tracksUserData.username)});var i=function(e,t){var s=_.template(e.closest(".jetpack-search-filters-widget").find(".jetpack-search-filters-widget__filter-template").html());a(e.append(s(t)))},r=function(r){r=void 0===r?e(".jetpack-search-filters-widget"):r;var n=function(t){return e(t).closest(".jetpack-search-filters-widget__filter")};r.on("change",".filter-select",function(){var c=e(this),i=c.val(),r={is_customizer:t.tracksEventData.is_customizer};r.type=i,c.closest(".jetpack-search-filters-widget__filter").attr("class","jetpack-search-filters-widget__filter").addClass("is-"+i),a(n(this)),s("changed_filter_type",r)}),r.on("change",".jetpack-search-filters-widget__search-box-enabled",function(){var a=e(this),c=a.is(":checked"),i=a.closest(".jetpack-search-filters-widget"),r=i.find(".jetpack-search-filters-widget__sort-controls-enabled");i.toggleClass("hide-post-types"),c?(r.removeAttr("disabled"),s("enabled_search_box",t.tracksEventData)):(r.prop("checked",!1),r.prop("disabled",!0),s("disabled_search_box",t.tracksEventData))}),r.on("change",".jetpack-search-filters-widget__sort-controls-enabled",function(){e(this).is(":checked")?s("enabled_sort_controls",t.tracksEventData):s("disabled_sort_controls",t.tracksEventData)}),r.on("click",'.jetpack-search-filters-widget__post-types-select input[type="checkbox"]',function(a){0===e(this).closest(".jetpack-search-filters-widget").find('.jetpack-search-filters-widget__post-types-select input[type="checkbox"]:checked').length&&(a.preventDefault(),a.stopPropagation(),s("attempted_no_post_types",t.tracksEventData))}),r.on("change",'.jetpack-search-filters-widget__post-types-select input[type="checkbox"]',function(){var a=e(this),c={is_customizer:t.tracksEventData.is_customizer,post_type:a.val()};wp&&wp.customize&&wp.customize.state("saved").set(!1),a.is(":checked")?s("added_post_type",c):s("removed_post_type",c)}),r.on("change",".jetpack-search-filters-widget__sort-order",function(){var a={is_customizer:t.tracksEventData.is_customizer};a.order=e(this).val(),wp&&wp.customize&&wp.customize.state("saved").set(!1),s("changed_sort_order",a)}),r.on("change",".jetpack-search-filters-widget__taxonomy-select select",function(){var c={is_customizer:t.tracksEventData.is_customizer};c.taxonomy=e(this).val(),a(n(this)),wp&&wp.customize&&wp.customize.state("saved").set(!1),s("changed_taxonomy",c)}),r.on("change","select.date-field-select",function(){var c={is_customizer:t.tracksEventData.is_customizer};c.field=e(this).val(),a(n(this)),wp&&wp.customize&&wp.customize.state("saved").set(!1),s("changed_date_field",c)}),r.on("change","select.date-interval-select",function(){var c={is_customizer:t.tracksEventData.is_customizer};c.interval=e(this).val(),a(n(this)),wp&&wp.customize&&wp.customize.state("saved").set(!1),s("changed_date_interval",c)}),r.on("change","input.filter-count",function(){var a={is_customizer:t.tracksEventData.is_customizer};a.count=e(this).val(),wp&&wp.customize&&wp.customize.state("saved").set(!1),s("changed_filter_count",a)}),r.on("click",".jetpack-search-filters-widget__add-filter",function(a){a.preventDefault();var r=e(this).closest(".jetpack-search-filters-widget").find(".jetpack-search-filters-widget__filters");i(r,{type:"taxonomy",taxonomy:"",post_type:"",field:"",interval:"",count:c,name_placeholder:"",name:""}),wp&&wp.customize&&wp.customize.state("saved").set(!1),r.find(".jetpack-search-filters-widget__filter").find("input, textarea, select").change(),s("added_filter",t.tracksEventData)}),r.on("click",".jetpack-search-filters-widget__controls .delete",function(a){a.preventDefault();var c=e(this).closest(".jetpack-search-filters-widget__filter"),i={is_customizer:t.tracksEventData.is_customizer};switch(i.type=c.find(".filter-select").val(),i.type){case"taxonomy":i.taxonomy=c.find(".jetpack-search-filters-widget__taxonomy-select select").val();break;case"date_histogram":i.dateField=c.find(".jetpack-search-filters-widget__date-histogram-select:first select").val(),i.dateInterval=c.find(".jetpack-search-filters-widget__date-histogram-select:nth-child( 2 ) select").val()}i.filterCount=c.find(".filter-count").val(),s("deleted_filter",i),c.find("input, textarea, select").change(),c.remove(),wp&&wp.customize&&wp.customize.state("saved").set(!1)}),e(".jetpack-search-filters-widget__filters").sortable({placeholder:"jetpack-search-filters-widget__filter-placeholder",axis:"y",revert:!0,cancel:"input,textarea,button,select,option,.jetpack-search-filters-widget__controls a",change:function(){wp&&wp.customize&&wp.customize.state("saved").set(!1)},update:function(t,a){e(a.item).find("input, textarea, select").change()}}).disableSelection()};e(document).on("widget-updated widget-added",function(t,a){a=e(a);var s=a.attr("id");s&&-1!==s.indexOf("jetpack-search-filters")&&(a.off("change",".filter-select"),a.off("click",".jetpack-search-filters-widget__controls .delete"),a.off("change",".jetpack-search-filters-widget__use-filters"),a.off("change",".jetpack-search-filters-widget__search-box-enabled"),a.off("change",".jetpack-search-filters-widget__sort-controls-enabled"),a.off("change",".jetpack-search-filters-widget__sort-controls-enabled"),a.off("change",".jetpack-search-filters-widget__post-type-selector"),a.off("change",".jetpack-search-filters-widget__sort-order"),a.off("change",".jetpack-search-filters-widget__taxonomy-select"),a.off("change",".jetpack-search-filters-widget__date-histogram-select:first select"),a.off("change",".jetpack-search-filters-widget__date-histogram-select:eq(1) select"),a.off("click",'.jetpack-search-filters-widget__post-types-select input[type="checkbox"]'),a.off("click",".jetpack-search-filters-widget__add-filter"),r(a))})}(jQuery,jetpack_search_filter_admin);