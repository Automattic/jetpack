/* Do not modify this file directly. It is compiled from other files. */
/* jshint onevar: false, multistr: true */
/* global _wpMediaViewsL10n, _wpGalleryWidgetAdminSettings */
!function(e){function t(){e(".widget-inside .gallery-widget-style").each(function(){var t=e(this).val(),i=e(this).parents("form");switch(t){case"slideshow":i.find(".gallery-widget-link-wrapper").hide(),i.find(".gallery-widget-columns-wrapper").hide();break;default:i.find(".gallery-widget-link-wrapper").show(),i.find(".gallery-widget-columns-wrapper").show()}})}function i(e,t){t.empty();var i=_wpGalleryWidgetAdminSettings.thumbSize;e.each(function(e){var l=e.get("url")+"?w="+i+"&h="+i+"&crop=true",n=jQuery("<img>",{src:l,alt:e.get("title"),title:e.get("title"),width:i,height:i,class:"thumb"});t.append(n)})}function l(e){if(!e)return null;var t=wp.shortcode.next("gallery",'[gallery ids="'+e+'"]');return t=t.shortcode,wp.media.gallery.attachments(t)}function n(e){var t=new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0});return t.gallery=e.gallery,t.more().done(function(){t.props.set({query:!1}),t.unmirror(),t.props.unset("orderby")}),t}function r(e){var t=new wp.media.view.MediaFrame.GalleryWidget(e);return t.on("update",function(e){var l=t.state();if(e=e||l.get("selection")){var n=e.map(function(e){return e.get("id")}),r=n.join(",");a.val(r).trigger("change"),i(e,o)}},this),t.setState(t.options.state),t}var a,o;e(function(){e(document.body).on("click",".gallery-widget-choose-images",function(t){t.preventDefault();var i=e(this).closest("form, .form");a=i.find(".gallery-widget-ids"),o=i.find(".gallery-widget-thumbs");var d=a.val(),s=l(d),g=null,c=!1;s&&(g=n(s),c=!0),r({state:"gallery-edit",title:wp.media.view.l10n.addMedia,multiple:!0,editing:c,selection:g}).open()}),e(".widget-inside").on("change",".gallery-widget-style",t),t()});var d,s=wp.media;d=s.view.l10n="undefined"==typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n,s.view.MediaFrame.GalleryWidget=s.view.MediaFrame.Post.extend({createStates:function(){var e=this.options;"CollectionEdit"in s.controller?this.states.add([new s.controller.CollectionEdit({type:"image",collectionType:"gallery",title:d.editGalleryTitle,SettingsView:s.view.Settings.Gallery,library:e.selection,editing:e.editing,menu:"gallery"}),new s.controller.CollectionAdd({type:"image",collectionType:"gallery",title:d.addToGalleryTitle})]):("WidgetGalleryEdit"in s.controller||(s.controller.WidgetGalleryEdit=s.controller.GalleryEdit.extend({gallerySettings:function(){}})),this.states.add([new s.controller.WidgetGalleryEdit({library:e.selection,editing:e.editing,menu:"gallery"}),new s.controller.GalleryAdd({})]))}})}(jQuery);