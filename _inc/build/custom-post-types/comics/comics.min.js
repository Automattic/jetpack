/* Do not modify this file directly. It is compiled from other files. */
/* jshint onevar: false, smarttabs: true, devel: true */
/* global Jetpack_Comics_Options */
jQuery(function(o){var e={init:function(){o(document).on("dragover.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragOver),o(document).on("dragleave.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragLeave),o(document).on("drop.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDrop),o("body").append(o('<div id="jetpack-comic-drop-zone"><p class="dragging" /><p class="uploading" /></div>')),o("#jetpack-comic-drop-zone").find(".dragging").text(Jetpack_Comics_Options.labels.dragging).end().find(".uploading").text(Jetpack_Comics_Options.labels.uploading).prepend(o('<span class="spinner"/>')),"FileReader"in window&&"File"in window||(o("#jetpack-comic-drop-zone .dragging").text(Jetpack_Comics_Options.labels.unsupported),o(document).off("drop.jetpack-comics").on("drop.jetpack-comics","body, #jetpack-comic-drop-zone",this.onDragLeave))},filterImageFiles:function(o){for(var e=[],n=0,a=o.length;n<a;n++)o[n].type.match(/^image\//i)&&e.push(o[n]);return e},dragTimeout:null,onDragOver:function(n){n.preventDefault(),clearTimeout(e.dragTimeout),o("body").addClass("dragging")},onDragLeave:function(){clearTimeout(e.dragTimeout),e.dragTimeout=setTimeout(function(){o("body").removeClass("dragging")},100)},onDrop:function(n){n.preventDefault(),n.stopPropagation(),n.originalEvent.stopPropagation(),n.originalEvent.preventDefault();var a=e.filterImageFiles(n.originalEvent.dataTransfer.files);if(o("body").removeClass("dragging"),0===a.length)return void alert(Jetpack_Comics_Options.labels.invalidUpload);o("body").addClass("uploading");for(var i=new FormData,t=0,r=a.length;t<r;t++)i.append("image_"+t,a[t]);o("#jetpack-comic-drop-zone .uploading .spinner").spin(),o.ajax({url:Jetpack_Comics_Options.writeURL+"&nonce="+Jetpack_Comics_Options.nonce,data:i,processData:!1,contentType:!1,type:"POST",dataType:"json",xhrFields:{withCredentials:!0}}).done(function(e){o("#jetpack-comic-drop-zone .uploading").text(Jetpack_Comics_Options.labels.processing),"url"in e?document.location.href=e.url:"error"in e&&(alert(e.error),o("body").removeClass("uploading"))}).fail(function(){alert(Jetpack_Comics_Options.labels.error)})}};e.init()});