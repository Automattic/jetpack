{"version":3,"sources":["widgets/simple-payments/customizer.js"],"names":["api","wp","$","initWidget","widgetContainer","widgetForm","find","on","showAddNewForm","showEditForm","selectImage","removeImage","saveChanges","clearForm","deleteProduct","_","debounce","disableFormActions","syncProductLists","ajax","post","customize-jetpack-simple-payments-nonce","settings","nonce","customize_changeset_uuid","changeset","uuid","done","data","selectedProduct","document","each","index","select","$select","val","remove","append","map","product","value","ID","text","post_title","showForm","removeClass","add","attr","show","hideForm","removeAttr","hide","changeFormAction","action","change","event","preventDefault","enableFormActions","isFormVisible","is","isProductSelectVisible","isEdit","imageContainer","mediaFrame","media","view","MediaFrame","Select","title","multiple","library","type","button","selection","state","get","first","toJSON","url","id","open","updateProductImage","newImageId","parseInt","newImageSrc","placeholder","image","imageControls","decimalPlaces","number","parts","split","length","isFormValid","errors","addClass","productPrice","isNaN","parseFloat","precision","priceDecimalPlaces","productEmail","isProductEmailValid","test","productPostId","request","params","product_post_id","post_content","image_id","currency","price","email","productOption","product_post_title","fail","validCodes","forEach","item","hasOwnProperty","code","confirm","jpSimplePaymentsStrings","deleteConfirmation","formProductId","productList","selectedIndex","dispatchEvent","Event","has","$document","ready","customize","jQuery"],"mappings":"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","file":"../../../widgets/simple-payments/customizer.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* global jQuery, jpSimplePaymentsStrings, confirm, _ */\n/* eslint no-var: 0, quote-props: 0 */\n\n( function( api, wp, $ ) {\n\tvar $document = $( document );\n\n\t$document.ready( function() {\n\t\t$document.on( 'widget-added', function( event, widgetContainer ) {\n\t\t\tif ( widgetContainer.is( '[id*=\"jetpack_simple_payments_widget\"]' ) ) {\n\t\t\t\tinitWidget( widgetContainer );\n\t\t\t}\n\t\t} );\n\n\t\t$document.on( 'widget-synced widget-updated', function( event, widgetContainer ) {\n\t\t\t//this fires for all widgets, this prevent errors for non SP widgets\n\t\t\tif ( ! widgetContainer.is( '[id*=\"jetpack_simple_payments_widget\"]' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\tsyncProductLists();\n\n\t\t\tvar widgetForm = widgetContainer.find( '> .widget-inside > .form, > .widget-inside > form' );\n\n\t\t\tenableFormActions( widgetForm );\n\n\t\t\tupdateProductImage( widgetForm );\n\t\t} );\n\t} );\n\n\tfunction initWidget( widgetContainer ) {\n\t\tvar widgetForm = widgetContainer.find( '> .widget-inside > .form, > .widget-inside > form' );\n\n\t\t//Add New Button\n\t\twidgetForm.find( '.jetpack-simple-payments-add-product' ).on( 'click', showAddNewForm( widgetForm ) );\n\t\t//Edit Button\n\t\twidgetForm.find( '.jetpack-simple-payments-edit-product' ).on( 'click', showEditForm( widgetForm ) );\n\t\t//Select an Image\n\t\twidgetForm.find( '.jetpack-simple-payments-image-fieldset .placeholder, .jetpack-simple-payments-image > img' ).on( 'click', selectImage( widgetForm ) );\n\t\t//Remove Image Button\n\t\twidgetForm.find( '.jetpack-simple-payments-remove-image' ).on( 'click', removeImage( widgetForm ) );\n\t\t//Save Product button\n\t\twidgetForm.find( '.jetpack-simple-payments-save-product' ).on( 'click', saveChanges( widgetForm ) );\n\t\t//Cancel Button\n\t\twidgetForm.find( '.jetpack-simple-payments-cancel-form' ).on( 'click', clearForm( widgetForm ) );\n\t\t//Delete Selected Product\n\t\twidgetForm.find( '.jetpack-simple-payments-delete-product' ).on( 'click', deleteProduct( widgetForm ) );\n\t\t//Input, Select and Checkbox change\n\t\twidgetForm.find( 'select, input, textarea, checkbox' ).on( 'change input propertychange', _.debounce( function() {\n\t\t\tdisableFormActions( widgetForm );\n\t\t}, 250 ) );\n\t}\n\n\tfunction syncProductLists() {\n\t\tvar request = wp.ajax.post( 'customize-jetpack-simple-payments-buttons-get', {\n\t\t\t'customize-jetpack-simple-payments-nonce': api.settings.nonce[ 'customize-jetpack-simple-payments' ],\n\t\t\t'customize_changeset_uuid': api.settings.changeset.uuid\n\t\t} );\n\n\t\trequest.done( function( data ) {\n\t\t\tvar selectedProduct = 0;\n\n\t\t\t$( document ).find( 'select.jetpack-simple-payments-products' ).each( function( index, select ) {\n\t\t\t\tvar $select = $( select );\n\t\t\t\tselectedProduct = $select.val();\n\n\t\t\t\t$select.find( 'option' ).remove();\n\t\t\t\t$select.append( $.map( data, function( product ) {\n\t\t\t\t\treturn $( '<option>', { value: product.ID, text: product.post_title } );\n\t\t\t\t} ) );\n\t\t\t\t$select.val( selectedProduct );\n\t\t\t} );\n\t\t} );\n\t}\n\n\tfunction showForm( widgetForm ) {\n\t\t//reset validations\n\t\twidgetForm.find( '.invalid' ).removeClass( 'invalid' );\n\t\t//disable widget title and product selector\n\t\twidgetForm.find( '.jetpack-simple-payments-widget-title' )\n\t\t\t.add( '.jetpack-simple-payments-products' )\n\t\t\t//disable add and edit buttons\n\t\t\t.add( '.jetpack-simple-payments-add-product' )\n\t\t\t.add( '.jetpack-simple-payments-edit-product' )\n\t\t\t//disable save, delete and cancel until the widget update event is fired\n\t\t\t.add( '.jetpack-simple-payments-save-product' )\n\t\t\t.add( '.jetpack-simple-payments-cancel-form' )\n\t\t\t.add( '.jetpack-simple-payments-delete-product' )\n\t\t\t.attr( 'disabled', 'disabled' );\n\t\t//show form\n\t\twidgetForm.find( '.jetpack-simple-payments-form' ).show();\n\t}\n\n\tfunction hideForm( widgetForm ) {\n\t\t//enable widget title and product selector\n\t\twidgetForm.find( '.jetpack-simple-payments-widget-title' )\n\t\t\t.add( '.jetpack-simple-payments-products' )\n\t\t\t.removeAttr( 'disabled' );\n\t\t//hide the form\n\t\twidgetForm.find( '.jetpack-simple-payments-form' ).hide();\n\t}\n\n\tfunction changeFormAction( widgetForm, action ) {\n\t\twidgetForm.find( '.jetpack-simple-payments-form-action' ).val( action ).change();\n\t}\n\n\tfunction showAddNewForm( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\tshowForm( widgetForm );\n\t\t\tchangeFormAction( widgetForm, 'add' );\n\t\t};\n\t}\n\n\tfunction showEditForm( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\tshowForm( widgetForm );\n\t\t\tchangeFormAction( widgetForm, 'edit' );\n\t\t};\n\t}\n\n\tfunction clearForm( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\thideForm( widgetForm );\n\t\t\twidgetForm.find( '.jetpack-simple-payments-add-product, .jetpack-simple-payments-edit-product' ).attr( 'disabled', 'disabled' );\n\t\t\tchangeFormAction( widgetForm, 'clear' );\n\t\t};\n\t}\n\n\tfunction enableFormActions( widgetForm ) {\n\t\tvar isFormVisible = widgetForm.find( '.jetpack-simple-payments-form' ).is( ':visible' );\n\t\tvar isProductSelectVisible = widgetForm.find( '.jetpack-simple-payments-products' ).is( ':visible' ); //areProductsVisible ?\n\t\tvar isEdit = widgetForm.find( '.jetpack-simple-payments-form-action' ).val() === 'edit';\n\n\t\tif ( isFormVisible ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-save-product' )\n\t\t\t\t.add( '.jetpack-simple-payments-cancel-form' )\n\t\t\t\t.removeAttr( 'disabled' );\n\t\t} else {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-add-product' ).removeAttr( 'disabled' );\n\t\t}\n\n\t\tif ( isFormVisible && isEdit ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-delete-product' ).removeAttr( 'disabled' );\n\t\t}\n\n\t\tif ( isProductSelectVisible && ! isFormVisible ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-edit-product' ).removeAttr( 'disabled' );\n\t\t}\n\t}\n\n\tfunction disableFormActions( widgetForm ) {\n\t\twidgetForm.find( '.jetpack-simple-payments-add-product' )\n\t\t\t.add( '.jetpack-simple-payments-edit-product' )\n\t\t\t.add( '.jetpack-simple-payments-save-product' )\n\t\t\t.add( '.jetpack-simple-payments-cancel-form' )\n\t\t\t.add( '.jetpack-simple-payments-delete-product' )\n\t\t\t.attr( 'disabled', 'disabled' );\n\t}\n\n\tfunction selectImage( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\tvar imageContainer = widgetForm.find( '.jetpack-simple-payments-image' );\n\n\t\t\tvar mediaFrame = new wp.media.view.MediaFrame.Select( {\n\t\t\t\ttitle: 'Choose Product Image',\n\t\t\t\tmultiple: false,\n\t\t\t\tlibrary: { type: 'image' },\n\t\t\t\tbutton: { text: 'Choose Image' }\n\t\t\t} );\n\n\t\t\tmediaFrame.on( 'select', function() {\n\t\t\t\tvar selection = mediaFrame.state().get( 'selection' ).first().toJSON();\n\t\t\t\t//hide placeholder\n\t\t\t\twidgetForm.find( '.jetpack-simple-payments-image-fieldset .placeholder' ).hide();\n\n\t\t\t\t//load image from media library\n\t\t\t\timageContainer.find( 'img' )\n\t\t\t\t\t.attr( 'src', selection.url )\n\t\t\t\t\t.show();\n\n\t\t\t\t//show image and remove button\n\t\t\t\twidgetForm.find( '.jetpack-simple-payments-image' ).show();\n\n\t\t\t\t//set hidden field for the selective refresh\n\t\t\t\twidgetForm.find( '.jetpack-simple-payments-form-image-id' ).val( selection.id ).change();\n\t\t\t} );\n\n\t\t\tmediaFrame.open();\n\t\t};\n\t}\n\n\tfunction removeImage( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\t//show placeholder\n\t\t\twidgetForm.find( '.jetpack-simple-payments-image-fieldset .placeholder' ).show();\n\n\t\t\t//hide image and remove button\n\t\t\twidgetForm.find( '.jetpack-simple-payments-image' ).hide();\n\n\t\t\t//set hidden field for the selective refresh\n\t\t\twidgetForm.find( '.jetpack-simple-payments-form-image-id' ).val( '' ).change();\n\t\t};\n\t}\n\n\tfunction updateProductImage( widgetForm ) {\n\t\tvar newImageId = parseInt( widgetForm.find( '.jetpack-simple-payments-form-image-id' ).val(), 10 );\n\t\tvar newImageSrc = widgetForm.find( '.jetpack-simple-payments-form-image-src' ).val();\n\n\t\tvar placeholder = widgetForm.find( '.jetpack-simple-payments-image-fieldset .placeholder' );\n\t\tvar image = widgetForm.find( '.jetpack-simple-payments-image > img' );\n\t\tvar imageControls = widgetForm.find( '.jetpack-simple-payments-image' );\n\n\t\tif ( newImageId && newImageSrc ) {\n\t\t\timage.attr( 'src', newImageSrc );\n\t\t\tplaceholder.hide();\n\t\t\timageControls.show();\n\t\t} else {\n\t\t\tplaceholder.show();\n\t\t\timage.removeAttr( 'src' );\n\t\t\timageControls.hide();\n\t\t}\n\t}\n\n\tfunction decimalPlaces( number ) {\n\t\tvar parts = number.split( '.' );\n\t\tif ( parts.length > 2 ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn parts[ 1 ] ? parts[ 1 ].length : 0;\n\t}\n\n\tfunction isFormValid( widgetForm ) {\n\t\twidgetForm.find( '.invalid' ).removeClass( 'invalid' );\n\n\t\tvar errors = false;\n\n\t\tvar postTitle = widgetForm.find( '.jetpack-simple-payments-form-product-title' ).val();\n\t\tif ( ! postTitle ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-form-product-title' ).addClass( 'invalid' );\n\t\t\terrors = true;\n\t\t}\n\n\t\tvar productPrice = widgetForm.find( '.jetpack-simple-payments-form-product-price' ).val();\n\t\tif ( ! productPrice || isNaN( productPrice ) || parseFloat( productPrice ) <= 0 ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-form-product-price' ).addClass( 'invalid' );\n\t\t\terrors = true;\n\t\t}\n\n\t\t// Japan's Yen is the only supported currency with a zero decimal precision.\n\t\tvar precision = widgetForm.find( '.jetpack-simple-payments-form-product-currency' ).val() === 'JPY' ? 0 : 2;\n\t\tvar priceDecimalPlaces = decimalPlaces( productPrice );\n\t\tif ( priceDecimalPlaces === null || priceDecimalPlaces > precision ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-form-product-price' ).addClass( 'invalid' );\n\t\t\terrors = true;\n\t\t}\n\n\t\tvar productEmail = widgetForm.find( '.jetpack-simple-payments-form-product-email' ).val();\n\t\tvar isProductEmailValid = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i.test( productEmail );\n\t\tif ( ! productEmail || ! isProductEmailValid ) {\n\t\t\twidgetForm.find( '.jetpack-simple-payments-form-product-email' ).addClass( 'invalid' );\n\t\t\terrors = true;\n\t\t}\n\n\t\treturn ! errors;\n\t}\n\n\tfunction saveChanges( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\t\t\tvar productPostId = widgetForm.find( '.jetpack-simple-payments-form-product-id' ).val();\n\n\t\t\tif ( ! isFormValid( widgetForm ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdisableFormActions( widgetForm );\n\n\t\t\twidgetForm.find( '.spinner' ).show();\n\n\t\t\tvar request = wp.ajax.post( 'customize-jetpack-simple-payments-button-save', {\n\t\t\t\t'customize-jetpack-simple-payments-nonce': api.settings.nonce[ 'customize-jetpack-simple-payments' ],\n\t\t\t\t'customize_changeset_uuid': api.settings.changeset.uuid,\n\t\t\t\t'params': {\n\t\t\t\t\t'product_post_id': productPostId,\n\t\t\t\t\t'post_title': widgetForm.find( '.jetpack-simple-payments-form-product-title' ).val(),\n\t\t\t\t\t'post_content': widgetForm.find( '.jetpack-simple-payments-form-product-description' ).val(),\n\t\t\t\t\t'image_id': widgetForm.find( '.jetpack-simple-payments-form-image-id' ).val(),\n\t\t\t\t\t'currency': widgetForm.find( '.jetpack-simple-payments-form-product-currency' ).val(),\n\t\t\t\t\t'price': widgetForm.find( '.jetpack-simple-payments-form-product-price' ).val(),\n\t\t\t\t\t'multiple': widgetForm.find( '.jetpack-simple-payments-form-product-multiple' ).is( ':checked' ) ? 1 : 0,\n\t\t\t\t\t'email': widgetForm.find( '.jetpack-simple-payments-form-product-email' ).val()\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\trequest.done( function( data ) {\n\t\t\t\tvar select = widgetForm.find( 'select.jetpack-simple-payments-products' );\n\t\t\t\tvar productOption = select.find( 'option[value=\"' + productPostId + '\"]' );\n\n\t\t\t\tif ( productOption.length > 0\t) {\n\t\t\t\t\tproductOption.text( data.product_post_title );\n\t\t\t\t} else {\n\t\t\t\t\tselect.append(\n\t\t\t\t\t\t$( '<option>', {\n\t\t\t\t\t\t\tvalue: data.product_post_id,\n\t\t\t\t\t\t\ttext: data.product_post_title\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t\tselect.val( data.product_post_id ).change();\n\t\t\t\t}\n\n\t\t\t\twidgetForm.find( '.jetpack-simple-payments-products-fieldset' ).show();\n\t\t\t\twidgetForm.find( '.jetpack-simple-payments-products-warning' ).hide();\n\n\t\t\t\tchangeFormAction( widgetForm, 'clear' );\n\t\t\t\thideForm( widgetForm );\n\t\t\t} );\n\n\t\t\trequest.fail( function( data ) {\n\t\t\t\tvar validCodes = {\n\t\t\t\t\t'post_title': 'product-title',\n\t\t\t\t\t'price': 'product-price',\n\t\t\t\t\t'email': 'product-email'\n\t\t\t\t};\n\n\t\t\t\tdata.forEach( function( item ) {\n\t\t\t\t\tif ( validCodes.hasOwnProperty( item.code ) ) {\n\t\t\t\t\t\twidgetForm.find( '.jetpack-simple-payments-form-' + validCodes[ item.code ] ).addClass( 'invalid' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tenableFormActions( widgetForm );\n\t\t\t} );\n\t\t};\n\t}\n\n\tfunction deleteProduct( widgetForm ) {\n\t\treturn function( event ) {\n\t\t\tevent.preventDefault();\n\n\t\t\tif ( ! confirm( jpSimplePaymentsStrings.deleteConfirmation ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar formProductId = parseInt( widgetForm.find( '.jetpack-simple-payments-form-product-id' ).val(), 10 );\n\t\t\tif ( ! formProductId ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdisableFormActions( widgetForm );\n\n\t\t\twidgetForm.find( '.spinner' ).show();\n\n\t\t\tvar request = wp.ajax.post( 'customize-jetpack-simple-payments-button-delete', {\n\t\t\t\t'customize-jetpack-simple-payments-nonce': api.settings.nonce[ 'customize-jetpack-simple-payments' ],\n\t\t\t\t'customize_changeset_uuid': api.settings.changeset.uuid,\n\t\t\t\t'params': {\n\t\t\t\t\t'product_post_id': formProductId\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\trequest.done( function() {\n\t\t\t\tvar productList = widgetForm.find( 'select.jetpack-simple-payments-products' )[ 0 ];\n\t\t\t\tproductList.remove( productList.selectedIndex );\n\t\t\t\tproductList.dispatchEvent( new Event( 'change' ) );\n\n\t\t\t\tif ( $( productList ).has( 'option' ).length === 0 ) {\n\t\t\t\t\t//hide products select and label\n\t\t\t\t\twidgetForm.find( '.jetpack-simple-payments-products-fieldset' ).hide();\n\t\t\t\t\t//show empty products list warning\n\t\t\t\t\twidgetForm.find( '.jetpack-simple-payments-products-warning' ).show();\n\t\t\t\t}\n\n\t\t\t\tchangeFormAction( widgetForm, 'clear' );\n\t\t\t\thideForm( widgetForm );\n\t\t\t} );\n\t\t};\n\t}\n}( wp.customize, wp, jQuery ) );\n"]}