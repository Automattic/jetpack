{"version":3,"sources":["after-the-deadline/jquery.atd.js"],"names":["AtD","rpc","rpc_css","rpc_css_lang","api_key","i18n","listener","getLang","key","defaultk","window","AtD_l10n_r0ar","addI18n","obj","setIgnoreStrings","string","core","showTypes","checkCrossAJAX","container_id","callback_f","AtD_proofread_click_count","remove","container","jQuery","text","trim","html","replace","encodeURIComponent","length","navigator","appName","undefined","error","CSSHttpRequest","get","Date","getTime","response","xml","ActiveXObject","async","loadXML","DOMParser","parseFromString","hasErrorMessage","getErrorMessage","count","Number","processXML","ready","success","counter","check","ajax","type","url","data","format","dataType","browser","XHR","status","_removeWords","clickListener","event","isMarkedNode","target","suggest","responseXML","results","markMyWords","contents","errors","unbind","click","useSuggestion","word","this","applySuggestion","errorElement","editSelection","parent","ignoreSuggestion","removeParent","ignoreAll","removed","ignore","explainError","explain","explainURL","element","prependTo","hide","errorDescription","findSuggestion","empty","append","i","sugg","pos","offset","width","css","left","top","fadeIn","suggestShow","setTimeout","bind","fadeOut","w","removeWords","initCoreModule","AtDCore","hasClass","node","className","map","replaceWith","old_node","new_node","findSpans","makeArray","find","create","x","matches","match","isIE","unwrap","getAttrib","name","attr"],"mappings":"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","file":"../../after-the-deadline/jquery.atd.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/*\n * jquery.atd.js - jQuery powered writing check with After the Deadline\n * Author      : Raphael Mudge, Automattic Inc.\n * License     : LGPL or MIT License (take your pick)\n * Project     :  http://www.afterthedeadline.com/development.slp\n * Contact     : raffi@automattic.com\n *\n * Derived from:\n *\n * jquery.spellchecker.js - a simple jQuery Spell Checker\n * Copyright (c) 2008 Richard Willis\n * MIT license  : http://www.opensource.org/licenses/mit-license.php\n * Project      : http://jquery-spellchecker.googlecode.com\n * Contact      : willis.rh@gmail.com\n */\n\n/* jshint onevar: false, sub: true, smarttabs: true, loopfunc: true */\n/* global AtDCore, AtD_proofread_click_count, CSSHttpRequest, ActiveXObject */\n\nvar AtD =\n{\n\trpc : '', /* see the proxy.php that came with the AtD/TinyMCE plugin */\n\trpc_css : 'http://www.polishmywriting.com/atd-jquery/server/proxycss.php?data=', /* you may use this, but be nice! */\n\trpc_css_lang : 'en',\n\tapi_key : '',\n\ti18n : {}, // Back-compat\n\tlistener : {}\n};\n\nAtD.getLang = function( key, defaultk ) {\n\treturn ( window.AtD_l10n_r0ar && window.AtD_l10n_r0ar[key] ) || defaultk;\n};\n\nAtD.addI18n = function( obj ) {\n\t// Back-compat\n\twindow.AtD_l10n_r0ar = obj;\n};\n\nAtD.setIgnoreStrings = function(string) {\n\tAtD.core.setIgnoreStrings(string);\n};\n\nAtD.showTypes = function(string) {\n\tAtD.core.showTypes(string);\n};\n\nAtD.checkCrossAJAX = function(container_id, callback_f) {\n\t/* checks if a global var for click stats exists and increments it if it does... */\n\tif (typeof AtD_proofread_click_count !== 'undefined') {\n\t\tAtD_proofread_click_count++;\n\t}\n\n\tAtD.callback_f = callback_f; /* remember the callback for later */\n\tAtD.remove(container_id);\n\tvar container = jQuery('#' + container_id);\n\n\tvar text = jQuery.trim(container.html());\n\ttext     = text.replace(/\\&lt;/g, '<').replace(/\\&gt;/g, '>').replace(/\\&amp;/g, '&');\n\ttext     = encodeURIComponent( text.replace( /\\%/g, '%25' ) ); /* % not being escaped here creates problems, I don't know why. */\n\n\t/* do some sanity checks based on the browser */\n\tif ((text.length > 2000 && navigator.appName === 'Microsoft Internet Explorer') || text.length > 7800) {\n\t\tif (callback_f !== undefined && callback_f.error !== undefined) {\n\t\t\tcallback_f.error('Maximum text length for this browser exceeded');\n\t\t}\n\n\t\treturn;\n\t}\n\n\t/* do some cross-domain AJAX action with CSSHttpRequest */\n\tCSSHttpRequest.get(AtD.rpc_css + text + '&lang=' + AtD.rpc_css_lang + '&nocache=' + (new Date().getTime()), function(response) {\n\t\t/* do some magic to convert the response into an XML document */\n\t\tvar xml;\n\t\tif (navigator.appName === 'Microsoft Internet Explorer') {\n\t\t\txml = new ActiveXObject('Microsoft.XMLDOM');\n\t\t\txml.async = false;\n\t\t\txml.loadXML(response);\n\t\t} else {\n\t\t\txml = (new DOMParser()).parseFromString(response, 'text/xml');\n\t\t}\n\n\t\t/* check for and display error messages from the server */\n\t\tif (AtD.core.hasErrorMessage(xml)) {\n\t\t\tif (AtD.callback_f !== undefined && AtD.callback_f.error !== undefined) {\n\t\t\t\tAtD.callback_f.error(AtD.core.getErrorMessage(xml));\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t/* highlight the errors */\n\n\t\tAtD.container = container_id;\n\t\tvar count = Number( AtD.processXML(container_id, xml) );\n\n\t\tif (AtD.callback_f !== undefined && AtD.callback_f.ready !== undefined) {\n\t\t\tAtD.callback_f.ready(count);\n\t\t}\n\n\t\tif (count === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\t\tAtD.callback_f.success(count);\n\t\t}\n\n\t\tAtD.counter = count;\n\t\tAtD.count   = count;\n\t});\n};\n\n/* check a div for any incorrectly spelled words */\nAtD.check = function(container_id, callback_f) {\n\t/* checks if a global var for click stats exists and increments it if it does... */\n\tif (typeof AtD_proofread_click_count !== 'undefined') {\n\t\tAtD_proofread_click_count++;\n\t}\n\n\tAtD.callback_f = callback_f; /* remember the callback for later */\n\n\tAtD.remove(container_id);\n\n\tvar container = jQuery('#' + container_id);\n\n\tvar text = jQuery.trim(container.html());\n\ttext     = text.replace(/\\&lt;/g, '<').replace(/\\&gt;/g, '>').replace(/\\&amp;/g, '&');\n\ttext     = encodeURIComponent( text ); /* re-escaping % is not necessary here. don't do it */\n\n\tjQuery.ajax({\n\t\ttype : 'POST',\n\t\turl : AtD.rpc + '/checkDocument',\n\t\tdata : 'key=' + AtD.api_key + '&data=' + text,\n\t\tformat : 'raw',\n\t\tdataType : (jQuery.browser.msie) ? 'text' : 'xml',\n\n\t\terror : function(XHR, status, error) {\n\t\t\tif (AtD.callback_f !== undefined && AtD.callback_f.error !== undefined) {\n\t\t\t\tAtD.callback_f.error(status + ': ' + error);\n\t\t\t}\n\t\t},\n\n\t\tsuccess : function(data) {\n\t\t\t/* apparently IE likes to return XML as plain text-- work around from:\n\t\t\t   http://docs.jquery.com/Specifying_the_Data_Type_for_AJAX_Requests */\n\n\t\t\tvar xml;\n\t\t\tif (typeof data === 'string') {\n\t\t\t\txml = new ActiveXObject('Microsoft.XMLDOM');\n\t\t\t\txml.async = false;\n\t\t\t\txml.loadXML(data);\n\t\t\t}\n\t\t\telse {\n\t\t\t\txml = data;\n\t\t\t}\n\n\t\t\tif (AtD.core.hasErrorMessage(xml)) {\n\t\t\t\tif (AtD.callback_f !== undefined && AtD.callback_f.error !== undefined) {\n\t\t\t\t\tAtD.callback_f.error(AtD.core.getErrorMessage(xml));\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/* on with the task of processing and highlighting errors */\n\n\t\t\tAtD.container = container_id;\n\t\t\tvar count = Number( AtD.processXML(container_id, xml) );\n\n\t\t\tif (AtD.callback_f !== undefined && AtD.callback_f.ready !== undefined) {\n\t\t\t\tAtD.callback_f.ready(count);\n\t\t\t}\n\n\t\t\tif (count === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\t\t\tAtD.callback_f.success(count);\n\t\t\t}\n\n\t\t\tAtD.counter = count;\n\t\t\tAtD.count   = count;\n\t\t}\n\t});\n};\n\nAtD.remove = function(container_id) {\n\tAtD._removeWords(container_id, null);\n};\n\nAtD.clickListener = function(event) {\n\tif (AtD.core.isMarkedNode(event.target)) {\n\t\tAtD.suggest(event.target);\n\t}\n};\n\nAtD.processXML = function(container_id, responseXML) {\n\n\tvar results = AtD.core.processXML(responseXML);\n\n\tif (results.count > 0) {\n\t\tresults.count = AtD.core.markMyWords(jQuery('#' + container_id).contents(), results.errors);\n\t}\n\n\tjQuery('#' + container_id).unbind('click', AtD.clickListener);\n\tjQuery('#' + container_id).click(AtD.clickListener);\n\n\treturn results.count;\n};\n\nAtD.useSuggestion = function(word) {\n\tthis.core.applySuggestion(AtD.errorElement, word);\n\n\tAtD.counter --;\n\tif (AtD.counter === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\tAtD.callback_f.success(AtD.count);\n\t}\n};\n\nAtD.editSelection = function() {\n\tvar parent = AtD.errorElement.parent();\n\n\tif (AtD.callback_f !== undefined && AtD.callback_f.editSelection !== undefined) {\n\t\tAtD.callback_f.editSelection(AtD.errorElement);\n\t}\n\n\tif (AtD.errorElement.parent() !== parent) {\n\t\tAtD.counter --;\n\t\tif (AtD.counter === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\t\tAtD.callback_f.success(AtD.count);\n\t\t}\n\t}\n};\n\nAtD.ignoreSuggestion = function() {\n\tAtD.core.removeParent(AtD.errorElement);\n\n\tAtD.counter --;\n\tif (AtD.counter === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\tAtD.callback_f.success(AtD.count);\n\t}\n};\n\nAtD.ignoreAll = function(container_id) {\n\tvar target = AtD.errorElement.text();\n\tvar removed = AtD._removeWords(container_id, target);\n\n\tAtD.counter -= removed;\n\n\tif (AtD.counter === 0 && AtD.callback_f !== undefined && AtD.callback_f.success !== undefined) {\n\t\tAtD.callback_f.success(AtD.count);\n\t}\n\n\tif (AtD.callback_f !== undefined && AtD.callback_f.ignore !== undefined) {\n\t\tAtD.callback_f.ignore(target);\n\t\tAtD.core.setIgnoreStrings(target);\n\t}\n};\n\nAtD.explainError = function() {\n\tif (AtD.callback_f !== undefined && AtD.callback_f.explain !== undefined) {\n\t\tAtD.callback_f.explain(AtD.explainURL);\n\t}\n};\n\nAtD.suggest = function(element) {\n\t/* construct the menu if it doesn't already exist */\n\tvar suggest;\n\n\tif (jQuery('#suggestmenu').length === 0) {\n\t\tsuggest = jQuery('<div id=\"suggestmenu\"></div>');\n\t\tsuggest.prependTo('body');\n\t} else {\n\t\tsuggest = jQuery('#suggestmenu');\n\t\tsuggest.hide();\n\t}\n\n\t/* find the correct suggestions object */\n\n\tvar errorDescription = AtD.core.findSuggestion(element);\n\n\t/* build up the menu y0 */\n\n\tAtD.errorElement = jQuery(element);\n\n\tsuggest.empty();\n\n\tif (errorDescription === undefined) {\n\t\tsuggest.append('<strong>' + AtD.getLang('menu_title_no_suggestions', 'No suggestions') + '</strong>');\n\t} else if (errorDescription['suggestions'].length === 0) {\n\t\tsuggest.append('<strong>' + errorDescription['description'] + '</strong>');\n\t} else {\n\t\tsuggest.append('<strong>' + errorDescription['description'] + '</strong>');\n\n\t\tfor (var i = 0; i < errorDescription['suggestions'].length; i++) {\n\t\t\t(function(sugg) {\n\t\t\t\tsuggest.append('<a href=\"javascript:AtD.useSuggestion(\\'' + sugg.replace(/'/, '\\\\\\'') + '\\')\">' + sugg + '</a>');\n\t\t\t})(errorDescription['suggestions'][i]); // jshint ignore:line\n\t\t}\n\t}\n\n\t/* do the explain menu if configured */\n\n\tif (AtD.callback_f !== undefined && AtD.callback_f.explain !== undefined && errorDescription['moreinfo'] !== undefined) {\n\t\tsuggest.append('<a href=\"javascript:AtD.explainError()\" class=\"spell_sep_top\">' + AtD.getLang('menu_option_explain', 'Explain...') + '</a>');\n\t\tAtD.explainURL = errorDescription['moreinfo'];\n\t}\n\n\t/* do the ignore option */\n\n\tsuggest.append('<a href=\"javascript:AtD.ignoreSuggestion()\" class=\"spell_sep_top\">' + AtD.getLang('menu_option_ignore_once', 'Ignore suggestion') + '</a>');\n\n\t/* add the edit in place and ignore always option */\n\n\tif (AtD.callback_f !== undefined && AtD.callback_f.editSelection !== undefined) {\n\t\tif (AtD.callback_f !== undefined && AtD.callback_f.ignore !== undefined) {\n\t\t\tsuggest.append('<a href=\"javascript:AtD.ignoreAll(\\'' + AtD.container + '\\')\">' + AtD.getLang('menu_option_ignore_always', 'Ignore always') + '</a>');\n\t\t} else {\n\t\t\tsuggest.append('<a href=\"javascript:AtD.ignoreAll(\\'' + AtD.container + '\\')\">' + AtD.getLang('menu_option_ignore_all', 'Ignore all') + '</a>');\n\t\t}\n\n\t\tsuggest.append('<a href=\"javascript:AtD.editSelection(\\'' + AtD.container + '\\')\" class=\"spell_sep_bottom spell_sep_top\">' + AtD.getLang('menu_option_edit_selection', 'Edit Selection...') + '</a>');\n\t}\n\telse {\n\t\tif (AtD.callback_f !== undefined && AtD.callback_f.ignore !== undefined) {\n\t\t\tsuggest.append('<a href=\"javascript:AtD.ignoreAll(\\'' + AtD.container + '\\')\" class=\"spell_sep_bottom\">' + AtD.getLang('menu_option_ignore_always', 'Ignore always') + '</a>');\n\t\t} else {\n\t\t\tsuggest.append('<a href=\"javascript:AtD.ignoreAll(\\'' + AtD.container + '\\')\" class=\"spell_sep_bottom\">' + AtD.getLang('menu_option_ignore_all', 'Ignore all') + '</a>');\n\t\t}\n\t}\n\n\t/* show the menu */\n\n\tvar pos = jQuery(element).offset();\n\tvar width = jQuery(element).width();\n\n        /* a sanity check for Internet Explorer--my favorite browser in every possible way */\n\tif (width > 100) {\n\t\twidth = 50;\n\t}\n\n\tjQuery(suggest).css({ left: (pos.left + width) + 'px', top: pos.top + 'px' });\n\n\tjQuery(suggest).fadeIn(200);\n\n\t/* bind events to make the menu disappear when the user clicks outside of it */\n\n\tAtD.suggestShow = true;\n\n\tsetTimeout(function() {\n\t\tjQuery('body').bind('click', function() {\n\t\t\tif (!AtD.suggestShow) {\n\t\t\t\tjQuery('#suggestmenu').fadeOut(200);\n\t\t\t}\n\t\t});\n\t}, 1);\n\n\tsetTimeout(function() {\n\t\tAtD.suggestShow = false;\n\t}, 2);\n};\n\nAtD._removeWords = function(container_id, w) {\n\treturn this.core.removeWords(jQuery('#' + container_id), w);\n};\n\n/*\n * Set prototypes used by AtD Core UI\n */\nAtD.initCoreModule = function() {\n\tvar core = new AtDCore();\n\n\tcore.hasClass = function(node, className) {\n\t\treturn jQuery(node).hasClass(className);\n\t};\n\n\tcore.map = jQuery.map;\n\n\tcore.contents = function(node) {\n\t\treturn jQuery(node).contents();\n\t};\n\n\tcore.replaceWith = function(old_node, new_node) {\n\t\treturn jQuery(old_node).replaceWith(new_node);\n\t};\n\n\tcore.findSpans = function(parent) {\n\t\treturn jQuery.makeArray(parent.find('span'));\n\t};\n\n\tcore.create = function(string/*, isTextNode*/) {\n\t\t// replace out all tags with &-equivalents so that we preserve tag text.\n\t\tstring = string.replace(/\\&/g, '&amp;');\n\t\tstring = string.replace(/</g, '&lt;').replace(/\\>/g, '&gt;');\n\n\t\t// find all instances of AtD-created spans\n\t\tvar matches = string.match(/\\&lt;span class=\"hidden\\w+?\" pre=\"[^\"]*\"\\&gt;.*?\\&lt;\\/span\\&gt;/g);\n\t\tvar x;\n\n\t\t// ... and fix the tags in those substrings.\n\t\tif (matches) {\n\t\t\tfor (x = 0; x < matches.length; x++) {\n\t\t\t\tstring = string.replace(matches[x], matches[x].replace(/\\&lt;/gi, '<').replace(/\\&gt;/gi, '>'));\n\t\t\t}\n\t\t}\n\n\t\tif (core.isIE()) {\n\t\t\t// and... one more round of corrections for our friends over at the Internet Explorer\n\t\t\tmatches = string.match(/\\&lt;span class=\"mceItemHidden\"\\&gt;\\&amp;nbsp;\\&lt;\\/span&gt;/g, string);\n\t\t\t//|&lt;BR.*?class.*?atd_remove_me.*?\\&gt;/gi, string);\n\t\t\tif (matches) {\n\t\t\t\tfor (x = 0; x < matches.length; x++) {\n\t\t\t\t\tstring = string.replace(matches[x], matches[x].replace(/\\&lt;/gi, '<').replace(/\\&gt;/gi, '>').replace(/\\&amp;/gi, '&'));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar node = jQuery('<span class=\"mceItemHidden\"></span>');\n\t\tnode.html(string);\n\t\treturn node;\n\t};\n\n\tcore.remove = function(node) {\n\t\treturn jQuery(node).remove();\n\t};\n\n\tcore.removeParent = function(node) {\n\t\t/* unwrap exists in jQuery 1.4+ only. Thankfully because replaceWith as-used here won't work in 1.4 */\n\t\tif (jQuery(node).unwrap) {\n\t\t\treturn jQuery(node).contents().unwrap();\n\t\t} else {\n\t\t\treturn jQuery(node).replaceWith(jQuery(node).html());\n\t\t}\n\t};\n\n\tcore.getAttrib = function(node, name) {\n\t\treturn jQuery(node).attr(name);\n\t};\n\n\treturn core;\n};\n\nAtD.core = AtD.initCoreModule();\n"]}