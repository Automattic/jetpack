{"version":3,"sources":["publicize/assets/publicize.js"],"names":["showOptionsPage","jQuery","$","service","nonce","connection","blogId","tb_show","append","tb_pathToImage","show","query","encodeURIComponent","Number","post","ajaxurl","response","remove","obj","parseJSON","hasOwnProperty","location","href","fb_redirect","err","blogID","val","message","html","tb_init","click","tb_height","parseInt","css","content_height","height","new_height","new_margin","unbind","sel","global","this","data","token","id","attr","type","global_conn","global_nonce","length","frameNonce","tb_remove","document","search","match","test","top","change","inputs","parents","find","_this","filter","serialize","myblogsResponse","call","bind","e","preventDefault","stopPropagation","replace","publicizeConnTestStart","addClass","action","publicizeConnTestComplete","publicizeConnRefreshClick","event","popupURL","currentTarget","popupTitle","title","popupWin","window","open","popupWinTimer","setInterval","closed","clearInterval","removeClass","each","index","testResult","testSelector","connectionID","connectionTestPassed","connectionTestMessage","userCanRefresh","class","refreshText","refreshURL","text","target","serviceName","appendTo","ready"],"mappings":"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","file":"../../../publicize/assets/publicize.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* jshint onevar: false,  smarttabs: true */\n/* global tb_show, tb_pathToImage, ajaxurl, tb_init, tb_remove */\n/* global myblogsResponse, publicizeConnTestStart:true, publicizeConnTestComplete:true, publicizeConnRefreshClick:true */\n\nvar showOptionsPage;\n\njQuery( function( $ ) {\n\n\tshowOptionsPage = function( service, nonce, connection, blogId ) {\n\t\ttb_show( null, null, null );\n\t\t$('body').append( '<div id=\\'TB_load\\'><img src=\\'' + tb_pathToImage + '\\' /></div>' );\n\t\t$('#TB_load').show();\n\n\t\tvar query = '';\n\t\tif ( connection ) {\n\t\t\tquery += '&connection=' + encodeURIComponent( connection );\n\t\t}\n\t\tif ( 'undefined' !== typeof( blogId ) && blogId ) {\n\t\t\tquery += '&blog_id=' + Number( blogId );\n\t\t}\n\n\t\t$.post( ajaxurl, 'action=publicize_' + service + '_options_page&_wpnonce=' + nonce + query, function( response ) {\n\t\t\t$('#TB_load').remove();\n\n\t\t\ttry {\n\t\t\t\tvar obj = jQuery.parseJSON( response );\n\t\t\t\tif ( obj && 'object' === typeof( obj ) ) {\n\t\t\t\t\tif ( obj.hasOwnProperty( 'fb_redirect' ) ) {\n\t\t\t\t\t\tlocation.href = obj.fb_redirect + '&redirect_uri=' + encodeURIComponent( location.href );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t// Do nothing and move on\n\t\t\t}\n\n\t\t\tif ( response ) {\n\t\t\t\tvar blogID = $( 'input[name=wpas_ajax_blog_id]' ).val();\n\n\t\t\t\tvar message = $( '<div id=\"wpas-ajax-' + blogID + '\" class=\"wrap\"></div>' ).append( response );\n\t\t\t\tmessage.append( '<a href=\"#TB_inline?thickbox&height=420&width=555&inlineId=wpas-ajax-' + blogID + '\" id=\"wpas-click-' + blogID + '\" class=\"new-thickbox\" style=\"display: none;\"></a>' );\n\t\t\t\t$('#wpas-message').html( message );\n\n\n\t\t\t\ttb_init( 'a.new-thickbox' );\n\t\t\t\t$('#wpas-click-' + blogID).click();\n\n\t\t\t\tvar tb_height = parseInt( $('#TB_ajaxContent').css('height'), 10 );\n\t\t\t\tvar content_height = $('#thickbox-content').height();\n\t\t\t\tif ( content_height < tb_height ) {\n\t\t\t\t\tvar new_height = content_height + 15;\n\t\t\t\t\t$('#TB_ajaxContent').css( 'height', new_height );\n\n\t\t\t\t\tvar new_margin = parseInt( $('#TB_window').css( 'margin-top'), 10 ) + (tb_height - new_height) / 2 + 'px';\n\t\t\t\t\t$('#TB_window').css( 'margin-top',  new_margin);\n\t\t\t\t}\n\n\t\t\t\t$('.save-options').unbind('click').click( function() {\n\t\t\t\t\tvar sel = $( 'input[name=\\'option\\']:checked' );\n\t\t\t\t\tvar global = $( 'input[name=\\'global\\']:checked' );\n\n\t\t\t\t\tvar connection = $(this).data('connection');\n\t\t\t\t\tvar token = encodeURIComponent( sel.val() );\n\t\t\t\t\tvar id = encodeURIComponent( sel.attr( 'id' ) );\n\t\t\t\t\tvar type = encodeURIComponent( sel.attr( 'data-type' ) );\n\t\t\t\t\tvar nonce = $(this).attr('rel');\n\t\t\t\t\tvar global_conn = 'off';\n\t\t\t\t\tvar global_nonce = '';\n\n\t\t\t\t\tif ( global.length ) {\n\t\t\t\t\t\tglobal_conn = 'on';\n\t\t\t\t\t\tglobal_nonce = global.val();\n\t\t\t\t\t}\n\n\t\t\t\t\t$.post( ajaxurl, 'action=publicize_'+ service + '_options_save&connection=' + connection + '&selected_id=' + id + '&token=' + token + '&type=' + type + '&_wpnonce=' + nonce + '&global=' + global_conn + '&global_nonce=' + global_nonce, function( /*response*/ ) {\n\t\t\t\t\t\tvar frameNonce;\n\t\t\t\t\t\ttb_remove();\n\t\t\t\t\t\tframeNonce = document.location.search.match( /frame-nonce=([^&]+)/ );\n\t\t\t\t\t\tif ( /inside-newdash=1/.test( document.location.search ) && frameNonce ) {\n\t\t\t\t\t\t\tdocument.location = 'options-general.php?page=sharing&inside-newdash=1&frame-nonce' + frameNonce[1];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttop.location = 'options-general.php?page=sharing';\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\t\t\t}\n\n\t\t}, 'html' );\n\t};\n\n\t$( 'body' ).append( '<div id=\"wpas-message\" style=\"display: none\"></div>' );\n\n\t$( '.wpas-posts' ).change( function() {\n\t\tvar inputs = $(this).parents( 'td:first' ).find( ':input' );\n\t\tvar _this = this;\n\t\tvar blogID = inputs.filter( '[name=wpas_ajax_blog_id]' ).val();\n\n\t\t$( '#waiting_' + blogID ).show();\n\t\t$.post( ajaxurl, inputs.serialize() + '&action=wpas_post', function( response ) { myblogsResponse.call( _this, blogID, response ); }, 'html' );\n\t} );\n\n\t$( '.options' ).unbind('click').bind( 'click', function(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tvar service = $(this).attr('class').replace( 'options ', '' );\n\n\t\tvar blogId = null;\n\t\tif ( 'undefined' !== typeof( $(this).attr('id') ) ) {\n\t\t\tblogId = parseInt( $(this).attr('id').replace( 'options-', '' ), 10 );\n\t\t}\n\n\t\tvar nonce = $(this).attr('href').replace( '#nonce=', '' );\n\t\tvar connection = $(this).data( 'connection' );\n\t\tshowOptionsPage.call( this, service, nonce, connection, blogId );\n\t});\n\n\t/**\n\t  * Kicks off tests for all connections\n\t  */\n\tpublicizeConnTestStart = function() {\n\t\t$( '.pub-connection-test' )\n\t\t\t.addClass( 'test-in-progress' );\n\t\t$.post( ajaxurl, { action: 'test_publicize_conns' }, publicizeConnTestComplete );\n\t};\n\n\tpublicizeConnRefreshClick = function( event ) {\n\t\tevent.preventDefault();\n\t\tvar popupURL = event.currentTarget.href;\n\t\tvar popupTitle = event.currentTarget.title;\n\t\t// open a popup window\n\t\t// when it is closed, kick off the tests again\n\t\tvar popupWin = window.open( popupURL, popupTitle, '' );\n\t\tvar popupWinTimer= window.setInterval( function() {\n\t\t\tif ( popupWin.closed !== false ) {\n\t\t\t\twindow.clearInterval( popupWinTimer );\n\t\t\t\tpublicizeConnTestStart();\n\t\t\t}\n\t\t}, 500 );\n\t};\n\n\tpublicizeConnTestComplete = function( response ) {\n\t\t$( '.pub-connection-test' ).removeClass( 'test-in-progress' );\n\n\t\t$.each( response.data, function( index, testResult ) {\n\t\t\t// find the li for this connection\n\t\t\tvar testSelector = '#pub-connection-test-' + testResult.connectionID;\n\t\t\tif ( testResult.connectionTestPassed ) {\n\t\t\t\t$( testSelector )\n\t\t\t\t\t.addClass( 'test-passed' )\n\t\t\t\t\t.html( '' )\n\t\t\t\t\t.removeClass( 'test-failed' );\n\t\t\t} else {\n\t\t\t\t$( testSelector )\n\t\t\t\t\t.addClass( 'test-failed' )\n\t\t\t\t\t.html( '<p><span class=\"pub-connection-error\">' + testResult.connectionTestMessage + '</span></p>' )\n\t\t\t\t\t.removeClass( 'test-passed' );\n\n\t\t\t\tif ( testResult.userCanRefresh ) {\n\t\t\t\t\t$( testSelector )\n\t\t\t\t\t\t.append( '<br/>' );\n\t\t\t\t\t$( '<a/>', {\n\t\t\t\t\t\t'class'  : 'pub-refresh-button button',\n\t\t\t\t\t\t'title'  : testResult.refreshText,\n\t\t\t\t\t\t'href'   : testResult.refreshURL,\n\t\t\t\t\t\t'text'   : testResult.refreshText,\n\t\t\t\t\t\t'target' : '_refresh_' + testResult.serviceName\n\t\t\t\t\t} )\n\t\t\t\t\t\t.appendTo( testSelector )\n\t\t\t\t\t\t.click( publicizeConnRefreshClick );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t};\n\n\t$( document ).ready( function() {\n\t\t// If we have at least one .pub-connection-test div present, kick off the connection test\n\t\tif ( $( '.pub-connection-test' ).length ) {\n\t\t\tpublicizeConnTestStart();\n\t\t}\n\t} );\n\n} );\n"]}