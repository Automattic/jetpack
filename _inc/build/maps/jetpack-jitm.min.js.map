{"version":3,"sources":["jetpack-jitm.js"],"names":["jQuery","document","ready","$","templates","default","envelope","html","CTA","message","content","classes","jitm_stats_url","icon","description","list","length","i","text","item","url","feature_class","id","activate_module","window","jitm_config","activate_module_text","ctaClasses","primary","newWindow","setJITMContent","$el","response","redirect","template","$template","find","click","$my_template","e","preventDefault","hide","ajax","api_root","method","data","replaceWith","prependTo","$activate_button","this","attr","beforeSend","xhr","setRequestHeader","activating_module_text","done","activated_module_text","each","message_path","query","get","_wpnonce","then"],"mappings":"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","file":"../jetpack-jitm.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\njQuery( document ).ready( function( $ ) {\n\tvar templates = {\n\t\t'default': function( envelope ) {\n\t\t\tvar html = '<div class=\"jitm-card jitm-banner ' + (\n\t\t\t\t\tenvelope.CTA.message ? 'has-call-to-action' : ''\n\t\t\t\t) + ' is-upgrade-premium ' + envelope.content.classes + '\" data-stats_url=\"' + envelope.jitm_stats_url + '\">';\n\t\t\thtml += '<div class=\"jitm-banner__icon-plan\">' + envelope.content.icon + '</div>';\n\t\t\thtml += '<div class=\"jitm-banner__content\">';\n\t\t\thtml += '<div class=\"jitm-banner__info\">';\n\t\t\thtml += '<div class=\"jitm-banner__title\">' + envelope.content.message + '</div>';\n\t\t\tif ( envelope.content.description && envelope.content.description !== '' ) {\n\t\t\t\thtml += '<div class=\"jitm-banner__description\">' + envelope.content.description;\n\t\t\t\tif ( envelope.content.list.length > 0 ) {\n\t\t\t\t\thtml += '<ul class=\"banner__list\">';\n\t\t\t\t\tfor ( var i = 0; i < envelope.content.list.length; i++ ) {\n\n\t\t\t\t\t\tvar text = envelope.content.list[ i ].item;\n\n\t\t\t\t\t\tif ( envelope.content.list[ i ].url ) {\n\t\t\t\t\t\t\ttext = '<a href=\"' + envelope.content.list[ i ].url + '\" target=\"_blank\" rel=\"noopener noreferrer\" data-module=\"' + envelope.feature_class + '\" data-jptracks-name=\"nudge_item_click\" data-jptracks-prop=\"jitm-' + envelope.id + '\">' +\n\t\t\t\t\t\t\t\ttext + '</a>';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thtml += '<li>' +\n\t\t\t\t\t\t\t'<svg class=\"gridicon gridicons-checkmark\" height=\"16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><g>' +\n\t\t\t\t\t\t\t'<path d=\"M9 19.414l-6.707-6.707 1.414-1.414L9 16.586 20.293 5.293l1.414 1.414\" /></g></svg>' +\n\t\t\t\t\t\t\ttext +\n\t\t\t\t\t\t\t'</li>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\thtml += '</div>';\n\t\t\t}\n\t\t\thtml += '</div>';\n\t\t\tif ( envelope.activate_module ) {\n\t\t\t\thtml += '<div class=\"jitm-banner__action\" id=\"jitm-banner__activate\">';\n\t\t\t\thtml += '<a href=\"#\" data-module=\"' + envelope.activate_module + '\" type=\"button\" class=\"jitm-button is-compact is-primary jptracks\" data-jptracks-name=\"nudge_click\" data-jptracks-prop=\"jitm-' + envelope.id + '-activate_module\">' + window.jitm_config.activate_module_text + '</a>';\n\t\t\t\thtml += '</div>';\n\t\t\t}\n\t\t\tif ( envelope.CTA.message ) {\n\t\t\t\tvar ctaClasses = 'jitm-button is-compact jptracks';\n\t\t\t\tif (\n\t\t\t\t\tenvelope.CTA.primary &&\n\t\t\t\t\tnull === envelope.activate_module\n\t\t\t\t) {\n\t\t\t\t\tctaClasses += ' is-primary';\n\t\t\t\t}\n\n\t\t\t\thtml += '<div class=\"jitm-banner__action\">';\n\t\t\t\thtml += '<a href=\"' + envelope.url + '\" target=\"' + ( envelope.CTA.newWindow === false ? '_self' : '_blank' ) + '\" rel=\"noopener noreferrer\" title=\"' + envelope.CTA.message + '\" data-module=\"' + envelope.feature_class + '\" type=\"button\" class=\"' + ctaClasses + '\" data-jptracks-name=\"nudge_click\" data-jptracks-prop=\"jitm-' + envelope.id + '\">' + envelope.CTA.message + '</a>';\n\t\t\t\thtml += '</div>';\n\t\t\t}\n\t\t\thtml += '<a href=\"#\" data-module=\"' + envelope.feature_class + '\" class=\"jitm-banner__dismiss\"></a>';\n\t\t\thtml += '</div>';\n\t\t\thtml += '</div>';\n\n\t\t\treturn $( html );\n\t\t}\n\t};\n\n\tvar setJITMContent = function( $el, response, redirect ) {\n\t\tvar template;\n\n\t\tvar render = function( $my_template ) {\n\t\t\treturn function( e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t$my_template.hide();\n\n\t\t\t\t$.ajax( {\n\t\t\t\t\turl: window.jitm_config.api_root + 'jetpack/v4/jitm',\n\t\t\t\t\tmethod: 'POST', // using DELETE without permalinks is broken in default nginx configuration\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: response.id,\n\t\t\t\t\t\tfeature_class: response.feature_class\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t};\n\t\t};\n\n\t\ttemplate = response.template;\n\n\t\t// if we don't have a template for this version, just use the default template\n\t\tif ( ! template || ! templates[ template ] ) {\n\t\t\ttemplate = 'default';\n\t\t}\n\n\t\tresponse.url = response.url + '&redirect=' + redirect;\n\n\t\tvar $template = templates[ template ]( response );\n\t\t$template.find( '.jitm-banner__dismiss' ).click( render( $template ) );\n\n\t\t$el.replaceWith( $template );\n\n\t\t// Add to Jetpack notices within the Jetpack settings app.\n\t\t$template.prependTo( $( '#jp-admin-notices' ) );\n\n\t\t// Handle Module activation button if it exists.\n\t\t$template.find( '#jitm-banner__activate a' ).click( function() {\n\t\t\tvar $activate_button = $( this );\n\n\t\t\t// Do not allow any requests if the button is disabled.\n\t\t\tif ( $activate_button.attr( 'disabled' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make request to activate module.\n\t\t\t$.ajax( {\n\t\t\t\turl: window.jitm_config.api_root + 'jetpack/v4/module/' + $activate_button.data( 'module' ) + '/active',\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbeforeSend: function( xhr ) {\n\t\t\t\t\txhr.setRequestHeader( 'X-WP-Nonce', $el.data( 'nonce' ) );\n\n\t\t\t\t\t// Change the button status to disabled as the change is in progress.\n\t\t\t\t\t$( '#jitm-banner__activate a' ).text( window.jitm_config.activating_module_text );\n\t\t\t\t\t$( '#jitm-banner__activate a' ).attr( 'disabled', true );\n\t\t\t\t}\n\t\t\t} ).done( function() {\n\t\t\t\t$( '#jitm-banner__activate a' ).text( window.jitm_config.activated_module_text );\n\t\t\t\t$( '#jitm-banner__activate a' ).attr( 'disabled', true );\n\t\t\t} );\n\t\t} );\n\t};\n\n\t$( '.jetpack-jitm-message' ).each( function() {\n\t\tvar $el = $( this );\n\n\t\tvar message_path = $el.data( 'message-path' );\n\t\tvar query = $el.data( 'query' );\n\t\tvar redirect = $el.data( 'redirect' );\n\n\t\t$.get( window.jitm_config.api_root + 'jetpack/v4/jitm', {\n\t\t\tmessage_path: message_path,\n\t\t\tquery: query,\n\t\t\t_wpnonce: $el.data( 'nonce' )\n\t\t} ).then( function( response ) {\n\t\t\tif ( 'object' === typeof response && response['1'] ) {\n\t\t\t\tresponse = [ response['1'] ];\n\t\t\t}\n\n\t\t\t// properly handle the case of an empty array or no content set\n\t\t\tif ( 0 === response.length || ! response[ 0 ].content ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// for now, always take the first response\n\t\t\tsetJITMContent( $el, response[ 0 ], redirect );\n\t\t} );\n\t} );\n} );\n"]}