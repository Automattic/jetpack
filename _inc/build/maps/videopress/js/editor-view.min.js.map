{"version":3,"sources":["videopress/js/editor-view.js"],"names":["$","wp","vpEditorView","mce","views","videopress_wp_view_renderer","shortcode_string","shortcode_data","defaults","w","at","permalink","hd","loop","freedom","autoplay","flashonly","coerce","media","template","getContent","options","key","width","urlargs","encodeURIComponent","home_url_host","named","this","shortcode","attrs","parseInt","content_width","height","guid","numeric","min_content_width","ratio","edit","data","next","editor","tinyMCE","activeEditor","renderer","oldRenderFormItem","ui","FormItem","prototype","renderHtml","TextBox","i","self","settings","element","document","createElement","multiline","extraAttrs","length","setAttribute","innerText","state","get","subtype","id","_id","className","classes","disabled","outerHTML","_","each","modal_labels","value","items","text","add","contains","call","windowManager","open","title","body","type","name","label","min","checked","onsubmit","e","args","tag","pick","keys","insertContent","string","onopen","prefix","target","$el","find","append","addClass","onclose","removeClass","register","wpvideo_wp_view_renderer","extend","jQuery"],"mappings":"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","file":"../../../videopress/js/editor-view.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* global tinyMCE, vpEditorView */\n(function( $, wp, vpEditorView ){\n\twp.mce = wp.mce || {};\n\tif ( 'undefined' === typeof wp.mce.views ) {\n\t\treturn;\n\t}\n\twp.mce.videopress_wp_view_renderer = {\n\t\tshortcode_string : 'videopress',\n\t\tshortcode_data : {},\n\t\tdefaults       : {\n\t\t\tw         : '',\n\t\t\tat        : '',\n\t\t\tpermalink : true,\n\t\t\thd        : false,\n\t\t\tloop      : false,\n\t\t\tfreedom   : false,\n\t\t\tautoplay  : false,\n\t\t\tflashonly : false\n\t\t},\n\t\tcoerce         : wp.media.coerce,\n\t\ttemplate       : wp.template( 'videopress_iframe_vnext' ),\n\t\tgetContent     : function() {\n\t\t\tvar urlargs = 'for=' + encodeURIComponent( vpEditorView.home_url_host ),\n\t\t\t\tnamed = this.shortcode.attrs.named,\n\t\t\t\toptions, key, width;\n\n\t\t\tfor ( key in named ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'at' :\n\t\t\t\t\t\tif ( parseInt( named[ key ], 10 ) ) {\n\t\t\t\t\t\t\turlargs += '&' + key + '=' + parseInt( named[ key ], 10 );\n\t\t\t\t\t\t} // Else omit, as it's the default.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'permalink' :\n\t\t\t\t\t\tif ( 'false' === named[ key ] ) {\n\t\t\t\t\t\t\turlargs += '&' + key + '=0';\n\t\t\t\t\t\t} // Else omit, as it's the default.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'hd' :\n\t\t\t\t\tcase 'loop' :\n\t\t\t\t\tcase 'autoplay' :\n\t\t\t\t\t\tif ( 'true' === named[ key ] ) {\n\t\t\t\t\t\t\turlargs += '&' + key + '=1';\n\t\t\t\t\t\t} // Else omit, as it's the default.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t// Unknown parameters?  Ditch it!\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toptions = {\n\t\t\t\twidth   : vpEditorView.content_width,\n\t\t\t\theight  : ( vpEditorView.content_width * 0.5625 ),\n\t\t\t\tguid    : this.shortcode.attrs.numeric[0],\n\t\t\t\turlargs : urlargs\n\t\t\t};\n\n\t\t\tif ( typeof named.w !== 'undefined' ) {\n\t\t\t\twidth = parseInt( named.w, 10 );\n\t\t\t\tif ( width >= vpEditorView.min_content_width && width < vpEditorView.content_width ) {\n\t\t\t\t\toptions.width  = width;\n\t\t\t\t\toptions.height = parseInt( width * 0.5625, 10 );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toptions.ratio = 100 * ( options.height / options.width );\n\n\t\t\treturn this.template( options );\n\t\t},\n\t\tedit: function( data ) {\n\t\t\tvar shortcode_data    = wp.shortcode.next( this.shortcode_string, data),\n\t\t\t\tnamed             = shortcode_data.shortcode.attrs.named,\n\t\t\t\teditor            = tinyMCE.activeEditor,\n\t\t\t\trenderer          = this,\n\t\t\t\toldRenderFormItem = tinyMCE.ui.FormItem.prototype.renderHtml;\n\n\t\t\t/**\n\t\t\t * Override TextBox renderHtml to support html5 attrs.\n\t\t\t * @link https://github.com/tinymce/tinymce/pull/2784\n\t\t\t *\n\t\t\t * @returns {string}\n\t\t\t */\n\t\t\ttinyMCE.ui.TextBox.prototype.renderHtml = function() {\n\t\t\t\tvar self       = this,\n\t\t\t\t\tsettings   = self.settings,\n\t\t\t\t\telement    = document.createElement( settings.multiline ? 'textarea' : 'input' ),\n\t\t\t\t\textraAttrs = [\n\t\t\t\t\t\t'rows',\n\t\t\t\t\t\t'spellcheck',\n\t\t\t\t\t\t'maxLength',\n\t\t\t\t\t\t'size',\n\t\t\t\t\t\t'readonly',\n\t\t\t\t\t\t'min',\n\t\t\t\t\t\t'max',\n\t\t\t\t\t\t'step',\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'pattern',\n\t\t\t\t\t\t'placeholder',\n\t\t\t\t\t\t'required',\n\t\t\t\t\t\t'multiple'\n\t\t\t\t\t],\n\t\t\t\t\ti, key;\n\n\t\t\t\tfor ( i = 0; i < extraAttrs.length; i++ ) {\n\t\t\t\t\tkey = extraAttrs[ i ];\n\t\t\t\t\tif ( typeof settings[ key ] !== 'undefined' ) {\n\t\t\t\t\t\telement.setAttribute( key, settings[ key ] );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( settings.multiline ) {\n\t\t\t\t\telement.innerText = self.state.get( 'value' );\n\t\t\t\t} else {\n\t\t\t\t\telement.setAttribute( 'type', settings.subtype ? settings.subtype : 'text' );\n\t\t\t\t\telement.setAttribute( 'value', self.state.get( 'value' ) );\n\t\t\t\t}\n\n\t\t\t\telement.id = self._id;\n\t\t\t\telement.className = self.classes;\n\t\t\t\telement.setAttribute( 'hidefocus', 1 );\n\t\t\t\tif ( self.disabled() ) {\n\t\t\t\t\telement.disabled = true;\n\t\t\t\t}\n\n\t\t\t\treturn element.outerHTML;\n\t\t\t};\n\n\t\t\ttinyMCE.ui.FormItem.prototype.renderHtml = function() {\n\t\t\t\t_.each( vpEditorView.modal_labels, function( value, key ) {\n\t\t\t\t\tif ( value === this.settings.items.text ) {\n\t\t\t\t\t\tthis.classes.add( 'videopress-field-' + key );\n\t\t\t\t\t}\n\t\t\t\t}, this );\n\n\t\t\t\tif ( _.contains( [\n\t\t\t\t\t\tvpEditorView.modal_labels.hd,\n\t\t\t\t\t\tvpEditorView.modal_labels.permalink,\n\t\t\t\t\t\tvpEditorView.modal_labels.autoplay,\n\t\t\t\t\t\tvpEditorView.modal_labels.loop,\n\t\t\t\t\t\tvpEditorView.modal_labels.freedom,\n\t\t\t\t\t\tvpEditorView.modal_labels.flashonly\n\t\t\t\t\t], this.settings.items.text ) ) {\n\t\t\t\t\tthis.classes.add( 'videopress-checkbox' );\n\t\t\t\t}\n\t\t\t\treturn oldRenderFormItem.call( this );\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Populate the defaults.\n\t\t\t */\n\t\t\t_.each( this.defaults, function( value, key ) {\n\t\t\t\tnamed[ key ] = this.coerce( named, key);\n\t\t\t}, this );\n\n\t\t\t/**\n\t\t\t * Declare the fields that will show in the popup when editing the shortcode.\n\t\t\t */\n\t\t\teditor.windowManager.open( {\n\t\t\t\ttitle : vpEditorView.modal_labels.title,\n\t\t\t\tid    : 'videopress-shortcode-settings-modal',\n\t\t\t\twidth : 520,\n\t\t\t\theight : 240,\n\t\t\t\tbody  : [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype     : 'textbox',\n\t\t\t\t\t\tdisabled : true,\n\t\t\t\t\t\tname     : 'guid',\n\t\t\t\t\t\tlabel    : vpEditorView.modal_labels.guid,\n\t\t\t\t\t\tvalue    : shortcode_data.shortcode.attrs.numeric[0]\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'textbox',\n\t\t\t\t\t\tsubtype : 'number',\n\t\t\t\t\t\tmin     : vpEditorView.min_content_width,  // The `min` may supported be in the future. https://github.com/tinymce/tinymce/pull/2784\n\t\t\t\t\t\tname    : 'w',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.w,\n\t\t\t\t\t\tvalue   : named.w\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'textbox',\n\t\t\t\t\t\tsubtype : 'number',\n\t\t\t\t\t\tmin     : 0, // The `min` may supported be in the future. https://github.com/tinymce/tinymce/pull/2784\n\t\t\t\t\t\tname    : 'at',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.at,\n\t\t\t\t\t\tvalue   : named.at\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'hd',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.hd,\n\t\t\t\t\t\tchecked : named.hd\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'permalink',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.permalink,\n\t\t\t\t\t\tchecked : named.permalink\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'autoplay',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.autoplay,\n\t\t\t\t\t\tchecked : named.autoplay\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'loop',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.loop,\n\t\t\t\t\t\tchecked : named.loop\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'freedom',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.freedom,\n\t\t\t\t\t\tchecked : named.freedom\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype    : 'checkbox',\n\t\t\t\t\t\tname    : 'flashonly',\n\t\t\t\t\t\tlabel   : vpEditorView.modal_labels.flashonly,\n\t\t\t\t\t\tchecked : named.flashonly\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tonsubmit : function( e ) {\n\t\t\t\t\tvar args = {\n\t\t\t\t\t\ttag   : renderer.shortcode_string,\n\t\t\t\t\t\ttype  : 'single',\n\t\t\t\t\t\tattrs : {\n\t\t\t\t\t\t\tnamed   : _.pick( e.data, _.keys( renderer.defaults ) ),\n\t\t\t\t\t\t\tnumeric : [ e.data.guid ]\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( '0' === args.attrs.named.at ) {\n\t\t\t\t\t\targs.attrs.named.at = '';\n\t\t\t\t\t}\n\n\t\t\t\t\t_.each( renderer.defaults, function( value, key ) {\n\t\t\t\t\t\targs.attrs.named[ key ] = this.coerce( args.attrs.named, key );\n\n\t\t\t\t\t\tif ( value === args.attrs.named[ key ] ) {\n\t\t\t\t\t\t\tdelete args.attrs.named[ key ];\n\t\t\t\t\t\t}\n\t\t\t\t\t}, renderer );\n\n\t\t\t\t\teditor.insertContent( wp.shortcode.string( args ) );\n\t\t\t\t},\n\t\t\t\tonopen : function ( e ) {\n\t\t\t\t\tvar prefix = 'mce-videopress-field-';\n\t\t\t\t\t_.each( ['w', 'at'], function( value ) {\n\t\t\t\t\t\te.target.$el.find( '.' + prefix + value + ' .mce-container-body' ).append( '<span class=\"' + prefix + 'unit ' + prefix + 'unit-' + value + '\">' + vpEditorView.modal_labels[ value + '_unit' ] );\n\t\t\t\t\t} );\n\t\t\t\t\t$('body').addClass( 'modal-open' );\n\t\t\t\t},\n\t\t\t\tonclose: function () {\n\t\t\t\t\t$('body').removeClass( 'modal-open' );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// Set it back to its original renderer.\n\t\t\ttinyMCE.ui.FormItem.prototype.renderHtml = oldRenderFormItem;\n\t\t}\n\t};\n\twp.mce.views.register( 'videopress', wp.mce.videopress_wp_view_renderer );\n\n\t// Extend the videopress one to also handle `wpvideo` instances.\n\twp.mce.wpvideo_wp_view_renderer = _.extend( {}, wp.mce.videopress_wp_view_renderer, {\n\t\tshortcode_string : 'wpvideo'\n\t});\n\twp.mce.views.register( 'wpvideo', wp.mce.wpvideo_wp_view_renderer );\n}( jQuery, wp, vpEditorView ));\n"]}