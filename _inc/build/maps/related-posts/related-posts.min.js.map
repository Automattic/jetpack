{"version":3,"sources":["related-posts/related-posts.js"],"names":["$","startRelatedPosts","jprp","cleanupTrackedUrl","endpointURL","getEndpointURL","$relatedPosts","getJSON","response","items","length","html","showThumbnails","options","wp","customize","instance","get","showDate","showContext","layout","show_thumbnails","show_date","show_context","generateVisualHtml","generateMinimalHtml","append","setVisualExcerptHeights","find","show","click","this","href","getTrackedUrl","URL","locationObject","is_customizer","settings","url","self","document","createElement","location","match","args","data","pathname","search","getAnchor","post","classNames","anchor_title","title","excerpt","anchor","attr","class","rel","data-origin","url_meta","origin","data-position","position","anchor_html","substring","posts","each","index","classes","join","id","format","date","context","img","src","width","anchor_overlay","related_posts_js_options","post_heading","text","elements","fontSize","parseInt","first","css","lineHeight","history","replaceState","cleaned_search","replace","selectiveRefresh","bind","placement","partial","jQuery"],"mappings":"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","file":"../../related-posts/related-posts.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* jshint onevar: false */\n/* globals related_posts_js_options */\n\n/**\n * Load related posts\n */\n(function($) {\n\tvar jprp = {\n\t\tresponse: null,\n\n\t\t/**\n\t\t * Utility get related posts JSON endpoint from URLs\n\t\t *\n\t\t * @param  {string} URL (optional)\n\t\t * @return {string} Endpoint URL\n\t\t */\n\t\tgetEndpointURL: function( URL ) {\n\t\t\tvar locationObject,\n\t\t\t\tis_customizer = 'undefined' !== typeof wp && wp.customize && wp.customize.settings && wp.customize.settings.url && wp.customize.settings.url.self;\n\n\t\t\t// If we're in Customizer, write the correct URL.\n\t\t\tif ( is_customizer ) {\n\t\t\t\t\tlocationObject = document.createElement( 'a' );\n\t\t\t\t\tlocationObject.href = wp.customize.settings.url.self;\n\t\t\t} else {\n\t\t\t\tlocationObject = document.location;\n\t\t\t}\n\n\t\t\tif ( 'string' === typeof( URL ) && URL.match( /^https?:\\/\\// ) ) {\n\t\t\t\tlocationObject = document.createElement( 'a' );\n\t\t\t\tlocationObject.href = URL;\n\t\t\t}\n\n\t\t\tvar args = 'relatedposts=1';\n\t\t\tif ( $( '#jp-relatedposts' ).data( 'exclude' ) ) {\n\t\t\t\targs += '&relatedposts_exclude=' + $( '#jp-relatedposts' ).data( 'exclude' );\n\t\t\t}\n\n\t\t\tif ( is_customizer ) {\n\t\t\t\targs += '&jetpackrpcustomize=1';\n\t\t\t}\n\n\t\t\tvar pathname = locationObject.pathname;\n\t\t\tif ( '/' !== pathname[0] ) {\n\t\t\t\tpathname = '/' + pathname;\n\t\t\t}\n\n\t\t\tif ( '' === locationObject.search ) {\n\t\t\t\treturn pathname + '?' + args;\n\t\t\t} else {\n\t\t\t\treturn pathname + locationObject.search + '&' + args;\n\t\t\t}\n\t\t},\n\n\t\tgetAnchor: function( post, classNames ) {\n\t\t\tvar anchor_title = post.title;\n\t\t\tif ( '' !== ( '' + post.excerpt ) ) {\n\t\t\t\tanchor_title += '\\n\\n' + post.excerpt;\n\t\t\t}\n\n\t\t\tvar anchor = $( '<a>' );\n\n\t\t\tanchor.attr({\n\t\t\t\t'class': classNames,\n\t\t\t\t'href': post.url,\n\t\t\t\t'title': anchor_title,\n\t\t\t\t'rel': post.rel,\n\t\t\t\t'data-origin': post.url_meta.origin,\n\t\t\t\t'data-position': post.url_meta.position\n\t\t\t});\n\n\t\t\tvar anchor_html = $( '<div>' ).append( anchor ).html();\n\t\t\treturn [\n\t\t\t\tanchor_html.substring( 0, anchor_html.length-4 ),\n\t\t\t\t'</a>'\n\t\t\t];\n\t\t},\n\n\t\tgenerateMinimalHtml: function( posts, options ) {\n\t\t\tvar self = this;\n\t\t\tvar html = '';\n\n\t\t\t$.each( posts, function( index, post ) {\n\t\t\t\tvar anchor = self.getAnchor( post, 'jp-relatedposts-post-a' );\n\t\t\t\tvar classes = 'jp-relatedposts-post jp-relatedposts-post' + index;\n\n\t\t\t\tif ( post.classes.length > 0 ) {\n\t\t\t\t\tclasses += ' ' + post.classes.join( ' ' );\n\t\t\t\t}\n\n\t\t\t\thtml += '<p class=\"' + classes + '\" data-post-id=\"' + post.id + '\" data-post-format=\"' + post.format + '\">';\n\t\t\t\thtml += '<span class=\"jp-relatedposts-post-title\">' + anchor[0] + post.title + anchor[1] + '</span>';\n\t\t\t\tif ( options.showDate ) {\n\t\t\t\t\thtml += '<span class=\"jp-relatedposts-post-date\">' + post.date + '</span>';\n\t\t\t\t}\n\t\t\t\tif ( options.showContext ) {\n\t\t\t\t\thtml += '<span class=\"jp-relatedposts-post-context\">' + post.context + '</span>';\n\t\t\t\t}\n\t\t\t\thtml += '</p>';\n\t\t\t} );\n\t\t\treturn '<div class=\"jp-relatedposts-items jp-relatedposts-items-minimal jp-relatedposts-' + options.layout + ' \">' + html + '</div>';\n\t\t},\n\n\t\tgenerateVisualHtml: function( posts, options ) {\n\t\t\tvar self = this;\n\t\t\tvar html = '';\n\n\t\t\t$.each( posts, function( index, post ) {\n\t\t\t\tvar anchor = self.getAnchor( post, 'jp-relatedposts-post-a' );\n\t\t\t\tvar classes = 'jp-relatedposts-post jp-relatedposts-post' + index;\n\n\t\t\t\tif ( post.classes.length > 0 ) {\n\t\t\t\t\tclasses += ' ' + post.classes.join( ' ' );\n\t\t\t\t}\n\n\t\t\t\tif ( ! post.img.src ) {\n\t\t\t\t\tclasses += ' jp-relatedposts-post-nothumbs';\n\t\t\t\t} else {\n\t\t\t\t\tclasses += ' jp-relatedposts-post-thumbs';\n\t\t\t\t}\n\n\t\t\t\thtml += '<div class=\"' + classes + '\" data-post-id=\"' + post.id + '\" data-post-format=\"' + post.format + '\">';\n\t\t\t\tif ( post.img.src ) {\n\t\t\t\t\thtml += anchor[0] + '<img class=\"jp-relatedposts-post-img\" src=\"' + post.img.src + '\" width=\"' + post.img.width + '\" alt=\"' + post.title + '\" />' + anchor[1];\n\t\t\t\t} else {\n\t\t\t\t\tvar anchor_overlay = self.getAnchor( post, 'jp-relatedposts-post-a jp-relatedposts-post-aoverlay' );\n\t\t\t\t\thtml += anchor_overlay[0] + anchor_overlay[1];\n\t\t\t\t}\n\t\t\t\thtml += '<' + related_posts_js_options.post_heading + ' class=\"jp-relatedposts-post-title\">' + anchor[0] + post.title + anchor[1] + '</' + related_posts_js_options.post_heading + '>';\n\t\t\t\thtml += '<p class=\"jp-relatedposts-post-excerpt\">' + $( '<p>' ).text( post.excerpt ).html() + '</p>';\n\t\t\t\tif ( options.showDate ) {\n\t\t\t\t\thtml += '<p class=\"jp-relatedposts-post-date\">' + post.date + '</p>';\n\t\t\t\t}\n\t\t\t\tif ( options.showContext ) {\n\t\t\t\t\thtml += '<p class=\"jp-relatedposts-post-context\">' + post.context + '</p>';\n\t\t\t\t}\n\t\t\t\thtml += '</div>';\n\t\t\t} );\n\t\t\treturn '<div class=\"jp-relatedposts-items jp-relatedposts-items-visual jp-relatedposts-' + options.layout + ' \">' + html + '</div>';\n\t\t},\n\n\t\t/**\n\t\t * We want to set a max height on the excerpt however we want to set\n\t\t * this according to the natual pacing of the page as we never want to\n\t\t * cut off a line of text in the middle so we need to do some detective\n\t\t * work.\n\t\t */\n\t\tsetVisualExcerptHeights: function() {\n\t\t\tvar elements = $( '#jp-relatedposts .jp-relatedposts-post-nothumbs .jp-relatedposts-post-excerpt' );\n\n\t\t\tif ( 0 >= elements.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar fontSize = parseInt( elements.first().css( 'font-size' ), 10 ),\n\t\t\t\tlineHeight = parseInt( elements.first().css( 'line-height' ), 10 );\n\n\t\t\t// Show 5 lines of text\n\t\t\telements.css(\n\t\t\t\t'max-height',\n\t\t\t\t( 5 * lineHeight / fontSize ) + 'em'\n\t\t\t);\n\t\t},\n\n\t\tgetTrackedUrl: function( anchor ) {\n\t\t\tvar args = 'relatedposts_hit=1';\n\t\t\targs += '&relatedposts_origin=' + $( anchor ).data( 'origin' );\n\t\t\targs += '&relatedposts_position=' + $( anchor ).data( 'position' );\n\n\t\t\tvar pathname = anchor.pathname;\n\t\t\tif ( '/' !== pathname[0] ) {\n\t\t\t\tpathname = '/' + pathname;\n\t\t\t}\n\n\t\t\tif ( '' === anchor.search ) {\n\t\t\t\treturn pathname + '?' + args;\n\t\t\t} else {\n\t\t\t\treturn pathname + anchor.search + '&' + args;\n\t\t\t}\n\t\t},\n\n\t\tcleanupTrackedUrl: function() {\n\t\t\tif ( 'function' !== typeof history.replaceState ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar cleaned_search = document.location.search.replace( /\\brelatedposts_[a-z]+=[0-9]*&?\\b/gi, '' );\n\t\t\tif ( '?' === cleaned_search ) {\n\t\t\t\tcleaned_search = '';\n\t\t\t}\n\t\t\tif ( document.location.search !== cleaned_search ) {\n\t\t\t\thistory.replaceState( {}, document.title, document.location.pathname + cleaned_search );\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Initialize Related Posts.\n\t */\n\tfunction startRelatedPosts() {\n\t\tjprp.cleanupTrackedUrl();\n\n\t\tvar endpointURL = jprp.getEndpointURL(),\n\t\t\t$relatedPosts = $( '#jp-relatedposts' );\n\n\t\t$.getJSON( endpointURL, function( response ) {\n\t\t\tif ( 0 === response.items.length || 0 === $relatedPosts.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tjprp.response = response;\n\n\t\t\tvar html,\n\t\t\t\tshowThumbnails,\n\t\t\t\toptions = {};\n\n\t\t\tif ( 'undefined' !== typeof wp && wp.customize ) {\n\t\t\t\tshowThumbnails = wp.customize.instance( 'jetpack_relatedposts[show_thumbnails]' ).get();\n\t\t\t\toptions.showDate = wp.customize.instance( 'jetpack_relatedposts[show_date]' ).get();\n\t\t\t\toptions.showContext = wp.customize.instance( 'jetpack_relatedposts[show_context]' ).get();\n\t\t\t\toptions.layout = wp.customize.instance( 'jetpack_relatedposts[layout]' ).get();\n\t\t\t} else {\n\t\t\t\tshowThumbnails = response.show_thumbnails;\n\t\t\t\toptions.showDate = response.show_date;\n\t\t\t\toptions.showContext = response.show_context;\n\t\t\t\toptions.layout = response.layout;\n\t\t\t}\n\n\t\t\thtml = ! showThumbnails ? jprp.generateMinimalHtml( response.items, options ) : jprp.generateVisualHtml( response.items, options );\n\n\t\t\t$relatedPosts.append( html );\n\t\t\tjprp.setVisualExcerptHeights();\n\t\t\tif ( options.showDate ) {\n\t\t\t\t$relatedPosts.find( '.jp-relatedposts-post-date' ).show();\n\t\t\t}\n\t\t\t$relatedPosts.show();\n\n\t\t\t$( '#jp-relatedposts a.jp-relatedposts-post-a' ).click(function() {\n\t\t\t\tthis.href = jprp.getTrackedUrl( this );\n\t\t\t});\n\t\t} );\n\t}\n\n\t$( function() {\n\t\tif ( 'undefined' !== typeof wp && wp.customize ) {\n\t\t\tif ( wp.customize.selectiveRefresh ) {\n\t\t\t\twp.customize.selectiveRefresh.bind( 'partial-content-rendered', function( placement ) {\n\t\t\t\t\tif ( 'jetpack_relatedposts' === placement.partial.id ) {\n\t\t\t\t\t\tstartRelatedPosts();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\twp.customize.bind( 'preview-ready', startRelatedPosts );\n\t\t} else {\n\t\t\tstartRelatedPosts();\n\t\t}\n\t} );\n\n})(jQuery);"]}