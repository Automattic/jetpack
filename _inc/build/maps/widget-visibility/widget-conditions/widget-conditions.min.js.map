{"version":3,"sources":["widget-visibility/widget-conditions/widget-conditions.js"],"names":["jQuery","$","setWidgetMargin","$widget","currentWidth","extra","hasClass","find","css","attr","data","width","isRtl","removeAttr","moveWidgetVisibilityButton","$displayOptionsButton","first","insertBefore","parent","removeClass","remove","prependTo","buildMinorConditions","condition","minor","hasChildren","majorData","i","j","key","val","_len","_jlen","subkey","subval","optgroup","select","html","major","widget_conditions_data","length","append","text","decodeEntities","replace","widget_conditions_parent_pages","siblings","show","hide","resetRuleIndexes","widget","index","each","this","encodedString","textarea","document","createElement","innerHTML","value","widgets_shell","on","e","$condition","closest","$conditionClone","clone","insertAfter","preventDefault","toggleClass","is","click","change","detach","parents","$conditionsRuleMajor","$conditionsRuleMinor","$conditionsRuleHasChildren"],"mappings":"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","file":"../../../widget-visibility/widget-conditions/widget-conditions.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* jshint onevar: false, smarttabs: true */\n/* global isRtl */\n/* global widget_conditions_parent_pages */\n/* global widget_conditions_data */\n/* global jQuery */\n\njQuery( function( $ ) {\n\tvar widgets_shell = $( 'div#widgets-right' );\n\n\tif ( ! widgets_shell.length || ! $( widgets_shell ).find( '.widget-control-actions' ).length ) {\n\t\twidgets_shell = $( 'form#customize-controls' );\n\t}\n\n\tfunction setWidgetMargin( $widget ) {\n\t\tvar currentWidth,\n\t\t\textra;\n\n\t\tif ( $( 'body' ).hasClass( 'wp-customizer' ) ) {\n\t\t\t// set the inside widget 2 top this way we can see the widget settings\n\t\t\t$widget.find( '.widget-inside' ).css( 'top', 0 );\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( $widget.hasClass( 'expanded' ) ) {\n\t\t\t// The expanded widget must be at least 400px wide in order to\n\t\t\t// contain the visibility settings. IE wasn't handling the\n\t\t\t// margin-left value properly.\n\n\t\t\tif ( $widget.attr( 'style' ) ) {\n\t\t\t\t$widget.data( 'original-style', $widget.attr( 'style' ) );\n\t\t\t}\n\n\t\t\tcurrentWidth = $widget.width();\n\n\t\t\tif ( currentWidth < 400 ) {\n\t\t\t\textra = 400 - currentWidth;\n\t\t\t\tif ( isRtl ) {\n\t\t\t\t\t$widget.css( 'position', 'relative' ).css( 'right', '-' + extra + 'px' ).css( 'width', '400px' );\n\t\t\t\t} else {\n\t\t\t\t\t$widget.css( 'position', 'relative' ).css( 'left', '-' + extra + 'px' ).css( 'width', '400px' );\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ( $widget.data( 'original-style' ) ) {\n\t\t\t// Restore any original inline styles when visibility is toggled off.\n\t\t\t$widget.attr( 'style', $widget.data( 'original-style' ) ).data( 'original-style', null );\n\t\t} else {\n\t\t\t$widget.removeAttr( 'style' );\n\t\t}\n\t}\n\n\tfunction moveWidgetVisibilityButton( $widget ) {\n\t\tvar $displayOptionsButton = $widget.find( 'a.display-options' ).first();\n\t\t$displayOptionsButton.insertBefore( $widget.find( 'input.widget-control-save' ) );\n\n\t\t// Widgets with no configurable options don't show the Save button's container.\n\t\t$displayOptionsButton\n\t\t\t.parent()\n\t\t\t\t.removeClass( 'widget-control-noform' )\n\t\t\t\t.find( '.spinner' )\n\t\t\t\t\t.remove()\n\t\t\t\t\t.css( 'float', 'left' )\n\t\t\t\t\t.prependTo( $displayOptionsButton.parent() );\n\t}\n\n\t$( '.widget' ).each( function() {\n\t\tmoveWidgetVisibilityButton( $( this ) );\n\t} );\n\n\t$( document ).on( 'widget-added', function( e, $widget ) {\n\t\tif ( $widget.find( 'div.widget-control-actions a.display-options' ).length === 0 ) {\n\t\t\tmoveWidgetVisibilityButton( $widget );\n\t\t}\n\t} );\n\n\twidgets_shell.on( 'click.widgetconditions', 'a.add-condition', function( e ) {\n\t\tvar $condition = $( this ).closest( 'div.condition' ),\n\t\t\t$conditionClone = $condition.clone().data( 'rule-major', '' ).data( 'rule-minor', '' ).data( 'has-children','' ).insertAfter( $condition );\n\n\t\te.preventDefault();\n\n\t\t$conditionClone.find( 'select.conditions-rule-major' ).val( '' );\n\t\t$conditionClone.find( 'select.conditions-rule-minor' ).html( '' ).attr( 'disabled' );\n\t\t$conditionClone.find( 'span.conditions-rule-has-children' ).hide().find( 'input[type=\"checkbox\"]' ).removeAttr( 'checked' );\n\n\t\tresetRuleIndexes( $conditionClone.closest( '.conditions' ) );\n\t} );\n\n\twidgets_shell.on( 'click.widgetconditions', 'a.display-options', function( e ) {\n\t\tvar $displayOptionsButton = $( this ),\n\t\t\t$widget = $displayOptionsButton.closest( 'div.widget' );\n\n\t\te.preventDefault();\n\n\t\t$widget.find( 'div.widget-conditional' ).toggleClass( 'widget-conditional-hide' );\n\t\t$( this ).toggleClass( 'active' );\n\t\t$widget.toggleClass( 'expanded' );\n\t\tsetWidgetMargin( $widget );\n\n\t\tif ( $( this ).hasClass( 'active' ) ) {\n\t\t\t$widget.find( 'input[name=widget-conditions-visible]' ).val( '1' );\n\t\t\t$widget.find( '.condition' ).each( function() {\n\t\t\t\tbuildMinorConditions( $( this ) );\n\t\t\t} );\n\t\t} else {\n\t\t\t$widget.find( 'input[name=widget-conditions-visible]' ).val( '0' );\n\t\t}\n\t} );\n\n\twidgets_shell.on( 'click.widgetconditions', 'a.delete-condition', function( e ) {\n\t\tvar $condition = $( this ).closest( 'div.condition' );\n\n\t\te.preventDefault();\n\n\t\tif ( $condition.is( ':first-child' ) && $condition.is( ':last-child' ) ) {\n\t\t\t$( this ).closest( 'div.widget' ).find( 'a.display-options' ).click();\n\t\t\t$condition.find( 'select.conditions-rule-major' ).val( '' ).change();\n\t\t} else {\n\t\t\t$condition.find( 'select.conditions-rule-major' ).change();\n\t\t\t$condition.detach();\n\t\t}\n\n\t\tresetRuleIndexes( $condition.closest( '.conditions' ) );\n\t} );\n\n\twidgets_shell.on( 'click.widgetconditions', 'div.widget-top', function() {\n\t\tvar $widget = $( this ).closest( 'div.widget' ),\n\t\t\t$displayOptionsButton = $widget.find( 'a.display-options' );\n\n\t\tif ( $displayOptionsButton.hasClass( 'active' ) ) {\n\t\t\t$displayOptionsButton.attr( 'opened', 'true' );\n\t\t}\n\n\t\tif ( $displayOptionsButton.attr( 'opened' ) ) {\n\t\t\t$displayOptionsButton.removeAttr( 'opened' );\n\t\t\t$widget.toggleClass( 'expanded' );\n\t\t\tsetWidgetMargin( $widget );\n\t\t}\n\t} );\n\n\twidgets_shell.on( 'change.widgetconditions', 'input.conditions-match-all', function() {\n\t\t$( this ).parents( '.widget-conditional' )\n\t\t\t.toggleClass( 'conjunction' )\n\t\t\t.toggleClass( 'intersection' );\n\t} );\n\n\t$( document ).on( 'change.widgetconditions', 'select.conditions-rule-major', function() {\n\t\tvar $conditionsRuleMajor = $( this ),\n\t\t\t$conditionsRuleMinor = $conditionsRuleMajor.siblings( 'select.conditions-rule-minor:first' ),\n\t\t\t$conditionsRuleHasChildren = $conditionsRuleMajor.siblings( 'span.conditions-rule-has-children' ),\n\t\t\t$condition = $conditionsRuleMinor.closest( '.condition' );\n\n\t\t$condition.data( 'rule-minor', '' ).data( 'rule-major', $conditionsRuleMajor.val() );\n\n\t\tif ( $conditionsRuleMajor.val() ) {\n\t\t\tbuildMinorConditions( $condition );\n\t\t} else {\n\t\t\t$conditionsRuleMajor.siblings( 'select.conditions-rule-minor' ).attr( 'disabled', 'disabled' ).html( '' );\n\t\t\t$conditionsRuleHasChildren.hide().find( 'input[type=\"checkbox\"]' ).removeAttr( 'checked' );\n\t\t}\n\t} );\n\n\t$( document ).on( 'change.widgetconditions', 'select.conditions-rule-minor', function() {\n\t\tvar $conditionsRuleMinor = $( this ),\n\t\t\t$conditionsRuleMajor = $conditionsRuleMinor.siblings( 'select.conditions-rule-major' ),\n\t\t\t$conditionsRuleHasChildren = $conditionsRuleMinor.siblings( 'span.conditions-rule-has-children' ),\n\t\t\t$condition = $conditionsRuleMinor.closest( '.condition' );\n\n\t\t$condition.data( 'rule-minor', $conditionsRuleMinor.val() );\n\n\t\tif ( $conditionsRuleMajor.val() === 'page' ) {\n\t\t\tif ( $conditionsRuleMinor.val() in widget_conditions_parent_pages ) {\n\t\t\t\t$conditionsRuleHasChildren.show();\n\t\t\t} else {\n\t\t\t\t$conditionsRuleHasChildren.hide().find( 'input[type=\"checkbox\"]' ).removeAttr( 'checked' );\n\t\t\t}\n\t\t} else {\n\t\t\t$conditionsRuleHasChildren.hide().find( 'input[type=\"checkbox\"]' ).removeAttr( 'checked' );\n\t\t}\n\t} );\n\n\t$( document ).on( 'widget-updated widget-synced', function( e, widget ) {\n\t\twidget.find( '.condition' ).each( function() {\n\t\t\tbuildMinorConditions( $( this ) );\n\t\t} );\n\t} );\n\n\tfunction buildMinorConditions( condition ) {\n\t\tvar minor,\n\t\t\thasChildren,\n\t\t\tmajorData,\n\t\t\ti,\n\t\t\tj,\n\t\t\tkey,\n\t\t\tval,\n\t\t\t_len,\n\t\t\t_jlen,\n\t\t\tsubkey,\n\t\t\tsubval,\n\t\t\toptgroup,\n\t\t\tselect = condition.find( '.conditions-rule-minor' ).html( '' ),\n\t\t\tmajor = condition.data( 'rule-major' );\n\n\t\t// Disable the select, if major rule is empty or if it's a `post_type`.\n\t\t// \"Post Type\" rule has been removed in Jetpack 4.7, and\n\t\t// because it breaks all other rules we should `return`.\n\t\tif ( ! major || 'post_type' === major ) {\n\t\t\tselect.attr( 'disabled', 'disabled' );\n\t\t\treturn;\n\t\t}\n\n\t\tminor = condition.data( 'rule-minor' );\n\t\thasChildren = condition.data( 'rule-has-children' );\n\t\tmajorData = widget_conditions_data[ major ];\n\n\t\tfor ( i = 0, _len = majorData.length; i < _len; i++ ) {\n\t\t\tkey = majorData[i][0];\n\t\t\tval = majorData[i][1];\n\n\t\t\tif ( typeof val === 'object' ) {\n\t\t\t\toptgroup = $( '<optgroup/>' ).attr( 'label', key );\n\n\t\t\t\tfor ( j = 0, _jlen = val.length; j < _jlen; j++ ) {\n\t\t\t\t\tsubkey = majorData[i][1][j][0];\n\t\t\t\t\tsubval = majorData[i][1][j][1];\n\n\t\t\t\t\toptgroup.append( $( '<option/>' ).val( subkey ).text( decodeEntities( subval.replace( /&nbsp;/g, '\\xA0' ) ) ) );\n\t\t\t\t}\n\n\t\t\t\tselect.append( optgroup );\n\t\t\t} else {\n\t\t\t\tselect.append( $( '<option/>' ).val( key ).text( decodeEntities( val.replace( /&nbsp;/g, '\\xA0' ) ) ) );\n\t\t\t}\n\t\t}\n\n\t\tselect.removeAttr( 'disabled' );\n\t\tselect.val( minor );\n\n\t\tif ( 'page' === major && minor in widget_conditions_parent_pages ) {\n\t\t\tselect.siblings( 'span.conditions-rule-has-children' ).show();\n\n\t\t\tif ( hasChildren ) {\n\t\t\t\tselect.siblings( 'span.conditions-rule-has-children' ).find( 'input[type=\"checkbox\"]' ).attr( 'checked', 'checked' );\n\t\t\t}\n\t\t} else {\n\t\t\tselect.siblings( 'span.conditions-rule-has-children' ).hide().find( 'input[type=\"checkbox\"]' ).removeAttr( 'checked' );\n\t\t}\n\t}\n\n\tfunction resetRuleIndexes( widget ) {\n\t\tvar index = 0;\n\t\twidget.find( 'span.conditions-rule-has-children' )\n\t\t\t.find( 'input[type=\"checkbox\"]' )\n\t\t\t.each( function() {\n\t\t\t\t$( this ).attr( 'name', 'conditions[page_children][' + index + ']' );\n\t\t\t\tindex++;\n\t\t\t} );\n\t}\n\n\tfunction decodeEntities( encodedString ) {\n\t\tvar textarea = document.createElement( 'textarea' );\n\t\ttextarea.innerHTML = encodedString;\n\t\treturn textarea.value;\n\t}\n} );\n"]}