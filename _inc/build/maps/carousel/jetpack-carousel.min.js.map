{"version":3,"sources":["carousel/jetpack-carousel.js"],"names":["jQuery","document","ready","$","overlay","comments","gallery","container","nextButton","previousButton","info","transitionBegin","caption","resizeTimeout","photo_info","close_hint","commentInterval","lastSelectedSlide","imageMeta","titleAndDescription","commentForm","leftColWrapper","scrollPos","screenPadding","originalOverflow","css","originalHOverflow","last_known_location_hash","window","innerWidth","Math","round","DocumentTouch","Date","now","getTime","keyListener","e","which","preventDefault","scrollTop","jp_carousel","resizeListener","clearTimeout","setTimeout","prepareGallery","addClass","position","top","right","bottom","left","buttons","jetpackCarouselStrings","comment","Number","is_logged_in","append","float","margin-top","width","commentFormMarkup","local_comments_commenting_as","length","comment_registration","write_comment","post_comment","color","commentsLoading","loading_comments","leftWidth","floor","fadeaway","height","remove","insertAfter","prepend","targetBottomPos","parseInt","hide","add","background_color","attr","z-index","overflow-x","overflow-y","direction","appendTo","click","target","wrap","parents","data","slide","find","attachment_id","is","hasClass","stopPropagation","unbind","animate","slideDown","focus","url","login_url","location","href","textarea","blur","bind","emailField","authorField","urlField","spin","ajaxData","action","nonce","blog_id","id","val","field","error","no_comment_text","require_name_email","match","no_comment_email","no_comment_author","ajax","type","ajaxurl","dataType","success","response","comment_status","slideUp","html","comment_approved","comment_unapproved","comment_post_error","offset","clear","opened","scroll","hash","history","back","on","originalEvent","propertyName","transitionMultiplier","elapsedTime","off","removeClass","touchwipe","wipeLeft","wipeRight","preventDefaultEvents","this","processSingleImageGallery","each","parent","valid","split","single_image_gallery_media_file","methods","testForData","testIfOpened","openOrSelectSlide","index","start_index","open","options","settings","items_selector","$this","extend","trigger","fadeIn","selectSlideAtIndex","slides","selected","eq","close","fadeOut","next","previous","previousOrNext","slideSelectionMethodName","selectedSlide","setSlidePosition","x","-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform","updateSlidePositions","current","galleryWidth","currentWidth","previousPrevious","prev","nextNext","show","prevAll","ceil","selectSlide","animated","captionHtml","attachmentId","not","title","desc","text","empty","stats","Image","src","protocol","encodeURIComponent","random","slideDimensions","loadSlide","one","bestFit","max","orig","orig_ratio","w_ratio","h_ratio","fitInfo","size","fitMeta","newInfoTop","newLeftWidth","fitSlide","dimensions","texturize","replace","trim","initSlides","items","src_item","orig_size","parts","medium_file","large_file","orig_file","orig_width","orig_height","max_width","max_height","useInPageThumbnails","first","closest","i","comments_opened","image_meta","thumb_size","naturalWidth","naturalHeight","description","tiledCaption","image","background-image","background-size","background-position","selectBestImageSize","args","imageLinkParser","createElement","isPhotonUrl","hostname","medium_size_parts","large_size_parts","large_width","large_height","medium_width","medium_height","orig_max_width","orig_max_height","devicePixelRatio","largeFileIndex","lastIndexOf","origPhotonUrl","substring","getImageSizeParts","file","size_parts","originalDimensions","splitted","format","replacements","number","shutterSpeed","speed","parseTitleDesc","value","key","RegExp","test","getTitleDesc","markup","updateExif","meta","display_exif","$ul","parseFloat","inArray","makeArray","meta_data","replaceWith","updateFullSizeLink","original","origSize","permalink","download_original","updateMap","latitude","longitude","display_geo","$metabox","$mapbox","style","prependTo","testCommentsOpened","getComments","clearInterval","setInterval","xhr","status","console","log","postCommentError","setCommentIframeSrc","iframe","clearCommentTextAreaValue","commentTextArea","nextSlide","last","prevSlide","loadFullImage","hasMultipleImages","fn","method","apply","Array","prototype","slice","call","arguments","body","currentTarget","single_image_gallery","matches","galleries","selectedThumbnail","hashRegExp","_","galleryEl","imageIndex","imageEl","config","min_move_x","min_move_y","wipeUp","wipeDown","cancelTouch","removeEventListener","onTouchMove","startX","isMoving","touches","pageX","y","pageY","dx","dy","startY","abs","onTouchStart","addEventListener","documentElement"],"mappings":"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","file":"../../carousel/jetpack-carousel.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* jshint sub: true, onevar: false, multistr: true, devel: true, smarttabs: true */\n/* global jetpackCarouselStrings, DocumentTouch */\n\n\njQuery(document).ready(function($) {\n\n\t// gallery faded layer and container elements\n\tvar overlay, comments, gallery, container, nextButton, previousButton, info, transitionBegin,\n\tcaption, resizeTimeout, photo_info, close_hint, commentInterval, lastSelectedSlide,\n\tscreenPadding = 110, originalOverflow = $('body').css('overflow'), originalHOverflow = $('html').css('overflow'), proportion = 85,\n\tlast_known_location_hash = '', imageMeta, titleAndDescription, commentForm, leftColWrapper, scrollPos;\n\n\tif ( window.innerWidth <= 760 ) {\n\t\tscreenPadding = Math.round( ( window.innerWidth / 760 ) * 110 );\n\n\t\tif ( screenPadding < 40 && ( ( 'ontouchstart' in window ) || window.DocumentTouch && document instanceof DocumentTouch ) ) {\n\t\t\tscreenPadding = 0;\n\t\t}\n\t}\n\n\t// Adding a polyfill for browsers that do not have Date.now\n\tif ( 'undefined' === typeof Date.now ) {\n\t\tDate.now = function now() {\n\t\t\treturn new Date().getTime();\n\t\t};\n\t}\n\n\tvar keyListener = function(e){\n\t\tswitch(e.which){\n\t\t\tcase 38: // up\n\t\t\t\te.preventDefault();\n\t\t\t\tcontainer.scrollTop(container.scrollTop() - 100);\n\t\t\t\tbreak;\n\t\t\tcase 40: // down\n\t\t\t\te.preventDefault();\n\t\t\t\tcontainer.scrollTop(container.scrollTop() + 100);\n\t\t\t\tbreak;\n\t\t\tcase 39: // right\n\t\t\t\te.preventDefault();\n\t\t\t\tgallery.jp_carousel('next');\n\t\t\t\tbreak;\n\t\t\tcase 37: // left\n\t\t\tcase 8: // backspace\n\t\t\t\te.preventDefault();\n\t\t\t\tgallery.jp_carousel('previous');\n\t\t\t\tbreak;\n\t\t\tcase 27: // escape\n\t\t\t\te.preventDefault();\n\t\t\t\tcontainer.jp_carousel('close');\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t// making jslint happy\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tvar resizeListener = function(/*e*/){\n\t\tclearTimeout(resizeTimeout);\n\t\tresizeTimeout = setTimeout(function(){\n\t\t\tgallery\n\t\t\t\t.jp_carousel('slides')\n\t\t\t\t.jp_carousel('fitSlide', true);\n\t\t\tgallery.jp_carousel('updateSlidePositions', true);\n\t\t\tgallery.jp_carousel('fitMeta', true);\n\t\t}, 200);\n\t};\n\n\tvar prepareGallery = function( /*dataCarouselExtra*/ ){\n\t\tif (!overlay) {\n\t\t\toverlay = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-overlay')\n\t\t\t\t.css({\n\t\t\t\t\t'position' : 'absolute',\n\t\t\t\t\t'top'      : 0,\n\t\t\t\t\t'right'    : 0,\n\t\t\t\t\t'bottom'   : 0,\n\t\t\t\t\t'left'     : 0\n\t\t\t\t});\n\n\t\t\tvar buttons  = '<a class=\"jp-carousel-commentlink\" href=\"#\">' + jetpackCarouselStrings.comment + '</a>';\n\t\t\tif ( 1 === Number( jetpackCarouselStrings.is_logged_in ) ) {\n\t\t\t}\n\n\t\t\tbuttons  = $('<div class=\"jp-carousel-buttons\">' + buttons + '</div>');\n\n\t\t\tcaption    = $('<h2 itemprop=\"caption description\"></h2>');\n\t\t\tphoto_info = $('<div class=\"jp-carousel-photo-info\"></div>').append(caption);\n\n\t\t\timageMeta = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-image-meta')\n\t\t\t\t.css({\n\t\t\t\t\t'float'      : 'right',\n\t\t\t\t\t'margin-top' : '20px',\n\t\t\t\t\t'width'      :  '250px'\n\t\t\t\t});\n\n\t\t\timageMeta\n\t\t\t\t.append( buttons )\n\t\t\t\t.append( '<ul class=\\'jp-carousel-image-exif\\' style=\\'display:none;\\'></ul>' )\n\t\t\t\t.append( '<a class=\\'jp-carousel-image-download\\' style=\\'display:none;\\'></a>' )\n\t\t\t\t.append( '<div class=\\'jp-carousel-image-map\\' style=\\'display:none;\\'></div>' );\n\n\t\t\ttitleAndDescription = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-titleanddesc')\n\t\t\t\t.css({\n\t\t\t\t\t'width'      : '100%',\n\t\t\t\t\t'margin-top' : imageMeta.css('margin-top')\n\t\t\t\t});\n\n\t\t\tvar commentFormMarkup = '<div id=\"jp-carousel-comment-form-container\">';\n\n\t\t\tif ( jetpackCarouselStrings.local_comments_commenting_as && jetpackCarouselStrings.local_comments_commenting_as.length ) {\n\t\t\t\t// Comments not enabled, fallback to local comments\n\n\t\t\t\tif ( 1 !== Number( jetpackCarouselStrings.is_logged_in ) && 1 === Number( jetpackCarouselStrings.comment_registration ) ) {\n\t\t\t\t\tcommentFormMarkup += '<div id=\"jp-carousel-comment-form-commenting-as\">' + jetpackCarouselStrings.local_comments_commenting_as + '</div>';\n\t\t\t\t} else {\n\t\t\t\t\tcommentFormMarkup += '<form id=\"jp-carousel-comment-form\">';\n\t\t\t\t\tcommentFormMarkup += '<textarea name=\"comment\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-textarea\" id=\"jp-carousel-comment-form-comment-field\" placeholder=\"' + jetpackCarouselStrings.write_comment + '\"></textarea>';\n\t\t\t\t\tcommentFormMarkup += '<div id=\"jp-carousel-comment-form-submit-and-info-wrapper\">';\n\t\t\t\t\tcommentFormMarkup += '<div id=\"jp-carousel-comment-form-commenting-as\">' + jetpackCarouselStrings.local_comments_commenting_as + '</div>';\n\t\t\t\t\tcommentFormMarkup += '<input type=\"submit\" name=\"submit\" class=\"jp-carousel-comment-form-button\" id=\"jp-carousel-comment-form-button-submit\" value=\"'+jetpackCarouselStrings.post_comment+'\" />';\n\t\t\t\t\tcommentFormMarkup += '<span id=\"jp-carousel-comment-form-spinner\">&nbsp;</span>';\n\t\t\t\t\tcommentFormMarkup += '<div id=\"jp-carousel-comment-post-results\"></div>';\n\t\t\t\t\tcommentFormMarkup += '</div>';\n\t\t\t\t\tcommentFormMarkup += '</form>';\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommentFormMarkup += '</div>';\n\n\t\t\tcommentForm = $(commentFormMarkup)\n\t\t\t\t.css({\n\t\t\t\t\t'width'      : '100%',\n\t\t\t\t\t'margin-top' : '20px',\n\t\t\t\t\t'color'      : '#999'\n\t\t\t\t});\n\n\t\t\tcomments = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-comments')\n\t\t\t\t.css({\n\t\t\t\t\t'width'      : '100%',\n\t\t\t\t\t'bottom'     : '10px',\n\t\t\t\t\t'margin-top' : '20px'\n\t\t\t\t});\n\n\t\t\tvar commentsLoading = $('<div id=\"jp-carousel-comments-loading\"><span>'+jetpackCarouselStrings.loading_comments+'</span></div>')\n\t\t\t\t.css({\n\t\t\t\t\t'width'      : '100%',\n\t\t\t\t\t'bottom'     : '10px',\n\t\t\t\t\t'margin-top' : '20px'\n\t\t\t\t});\n\n\t\t\tvar leftWidth = ( $(window).width() - ( screenPadding * 2 ) ) - (imageMeta.width() + 40);\n\t\t\tleftWidth += 'px';\n\n\t\t\tleftColWrapper = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-left-column-wrapper')\n\t\t\t\t.css({\n\t\t\t\t\t'width' : Math.floor( leftWidth )\n\t\t\t\t})\n\t\t\t\t.append(titleAndDescription)\n\t\t\t\t.append(commentForm)\n\t\t\t\t.append(comments)\n\t\t\t\t.append(commentsLoading);\n\n\t\t\tvar fadeaway = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-fadeaway');\n\n\t\t\tinfo = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-info')\n\t\t\t\t.css({\n\t\t\t\t\t'top'   : Math.floor( ($(window).height() / 100) * proportion ),\n\t\t\t\t\t'left'  : screenPadding,\n\t\t\t\t\t'right' : screenPadding\n\t\t\t\t})\n\t\t\t\t.append(photo_info)\n\t\t\t\t.append(imageMeta);\n\n\t\t\tif ( window.innerWidth <= 760 ) {\n\t\t\t\tphoto_info.remove().insertAfter( titleAndDescription );\n\t\t\t\tinfo.prepend( leftColWrapper );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tinfo.append( leftColWrapper );\n\t\t\t}\n\n\t\t\tvar targetBottomPos = ( $(window).height() - parseInt( info.css('top'), 10 ) ) + 'px';\n\n\t\t\tnextButton = $('<div><span></span></div>')\n\t\t\t\t.addClass('jp-carousel-next-button')\n\t\t\t\t.css({\n\t\t\t\t\t'right'    : '15px'\n\t\t\t\t})\n\t\t\t\t.hide();\n\n\t\t\tpreviousButton = $('<div><span></span></div>')\n\t\t\t\t.addClass('jp-carousel-previous-button')\n\t\t\t\t.css({\n\t\t\t\t\t'left'     : 0\n\t\t\t\t})\n\t\t\t\t.hide();\n\n\t\t\tnextButton.add( previousButton ).css( {\n\t\t\t\t'position' : 'fixed',\n\t\t\t\t'top' : '40px',\n\t\t\t\t'bottom' : targetBottomPos,\n\t\t\t\t'width' : screenPadding\n\t\t\t} );\n\n\t\t\tgallery = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel')\n\t\t\t\t.css({\n\t\t\t\t\t'position' : 'absolute',\n\t\t\t\t\t'top'      : 0,\n\t\t\t\t\t'bottom'   : targetBottomPos,\n\t\t\t\t\t'left'     : 0,\n\t\t\t\t\t'right'    : 0\n\t\t\t\t});\n\n\t\t\tclose_hint = $('<div class=\"jp-carousel-close-hint\"><span>&times;</span></div>')\n\t\t\t\t.css({\n\t\t\t\t\tposition : 'fixed'\n\t\t\t\t});\n\n\t\t\tcontainer = $('<div></div>')\n\t\t\t\t.addClass('jp-carousel-wrap')\n\t\t\t\t.addClass( 'jp-carousel-transitions' );\n\t\t\tif ( 'white' === jetpackCarouselStrings.background_color ) {\n\t\t\t\t container.addClass('jp-carousel-light');\n\t\t\t}\n\n\t\t\tcontainer.attr('itemscope', '');\n\n\t\t\tcontainer.attr('itemtype', 'https://schema.org/ImageGallery');\n\n\t\t\tcontainer.css({\n\t\t\t\t\t'position'   : 'fixed',\n\t\t\t\t\t'top'        : 0,\n\t\t\t\t\t'right'      : 0,\n\t\t\t\t\t'bottom'     : 0,\n\t\t\t\t\t'left'       : 0,\n\t\t\t\t\t'z-index'    : 2147483647,\n\t\t\t\t\t'overflow-x' : 'hidden',\n\t\t\t\t\t'overflow-y' : 'auto',\n\t\t\t\t\t'direction'  : 'ltr'\n\t\t\t\t})\n\t\t\t\t.hide()\n\t\t\t\t.append(overlay)\n\t\t\t\t.append(gallery)\n\t\t\t\t.append(fadeaway)\n\t\t\t\t.append(info)\n\t\t\t\t.append(nextButton)\n\t\t\t\t.append(previousButton)\n\t\t\t\t.append(close_hint)\n\t\t\t\t.appendTo($('body'))\n\t\t\t\t.click(function(e){\n\t\t\t\t\tvar target = $(e.target), wrap = target.parents('div.jp-carousel-wrap'), data = wrap.data('carousel-extra'),\n\t\t\t\t\t\tslide = wrap.find('div.selected'), attachment_id = slide.data('attachment-id');\n\t\t\t\t\tdata = data || [];\n\n\t\t\t\t\tif ( target.is(gallery) || target.parents().add(target).is(close_hint) ) {\n\t\t\t\t\t\tcontainer.jp_carousel('close');\n\t\t\t\t\t} else if ( target.hasClass('jp-carousel-commentlink') ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\tcontainer.animate({scrollTop: parseInt(info.position()['top'], 10)}, 'fast');\n\t\t\t\t\t\t$('#jp-carousel-comment-form-submit-and-info-wrapper').slideDown('fast');\n\t\t\t\t\t\t$('#jp-carousel-comment-form-comment-field').focus();\n\t\t\t\t\t} else if ( target.hasClass('jp-carousel-comment-login') ) {\n\t\t\t\t\t\tvar url = jetpackCarouselStrings.login_url + '%23jp-carousel-' + attachment_id;\n\n\t\t\t\t\t\twindow.location.href = url;\n\t\t\t\t\t} else if ( target.parents('#jp-carousel-comment-form-container').length ) {\n\t\t\t\t\t\tvar textarea = $('#jp-carousel-comment-form-comment-field')\n\t\t\t\t\t\t\t.blur(function(){\n\t\t\t\t\t\t\t\t$(window).bind('keydown', keyListener);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.focus(function(){\n\t\t\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar emailField = $('#jp-carousel-comment-form-email-field')\n\t\t\t\t\t\t\t.blur(function(){\n\t\t\t\t\t\t\t\t$(window).bind('keydown', keyListener);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.focus(function(){\n\t\t\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar authorField = $('#jp-carousel-comment-form-author-field')\n\t\t\t\t\t\t\t.blur(function(){\n\t\t\t\t\t\t\t\t$(window).bind('keydown', keyListener);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.focus(function(){\n\t\t\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar urlField = $('#jp-carousel-comment-form-url-field')\n\t\t\t\t\t\t\t.blur(function(){\n\t\t\t\t\t\t\t\t$(window).bind('keydown', keyListener);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.focus(function(){\n\t\t\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif ( textarea && textarea.attr('id') === target.attr('id')) {\n\t\t\t\t\t\t\t// For first page load\n\t\t\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t\t\t$('#jp-carousel-comment-form-submit-and-info-wrapper').slideDown('fast');\n\t\t\t\t\t\t} else if ( target.is( 'input[type=\"submit\"]' ) ) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\t\t\t$('#jp-carousel-comment-form-spinner').spin('small', 'white');\n\n\t\t\t\t\t\t\tvar ajaxData = {\n\t\t\t\t\t\t\t\taction: 'post_attachment_comment',\n\t\t\t\t\t\t\t\tnonce:   jetpackCarouselStrings.nonce,\n\t\t\t\t\t\t\t\tblog_id: data['blog_id'],\n\t\t\t\t\t\t\t\tid:      attachment_id,\n\t\t\t\t\t\t\t\tcomment: textarea.val()\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif ( ! ajaxData['comment'].length ) {\n\t\t\t\t\t\t\t\tgallery.jp_carousel('postCommentError', {'field': 'jp-carousel-comment-form-comment-field', 'error': jetpackCarouselStrings.no_comment_text});\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( 1 !== Number( jetpackCarouselStrings.is_logged_in ) ) {\n\t\t\t\t\t\t\t\tajaxData['email']  = emailField.val();\n\t\t\t\t\t\t\t\tajaxData['author'] = authorField.val();\n\t\t\t\t\t\t\t\tajaxData['url']    = urlField.val();\n\n\t\t\t\t\t\t\t\tif ( 1 === Number( jetpackCarouselStrings.require_name_email ) ) {\n\t\t\t\t\t\t\t\t\tif ( ! ajaxData['email'].length || ! ajaxData['email'].match('@') ) {\n\t\t\t\t\t\t\t\t\t\tgallery.jp_carousel('postCommentError', {'field': 'jp-carousel-comment-form-email-field', 'error': jetpackCarouselStrings.no_comment_email});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else if ( ! ajaxData['author'].length ) {\n\t\t\t\t\t\t\t\t\t\tgallery.jp_carousel('postCommentError', {'field': 'jp-carousel-comment-form-author-field', 'error': jetpackCarouselStrings.no_comment_author});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\ttype:       'POST',\n\t\t\t\t\t\t\t\turl:        jetpackCarouselStrings.ajaxurl,\n\t\t\t\t\t\t\t\tdata:       ajaxData,\n\t\t\t\t\t\t\t\tdataType:   'json',\n\t\t\t\t\t\t\t\tsuccess: function(response/*, status, xhr*/) {\n\t\t\t\t\t\t\t\t\tif ( 'approved' === response.comment_status ) {\n\t\t\t\t\t\t\t\t\t\t$('#jp-carousel-comment-post-results').slideUp('fast').html('<span class=\"jp-carousel-comment-post-success\">' + jetpackCarouselStrings.comment_approved + '</span>').slideDown('fast');\n\t\t\t\t\t\t\t\t\t} else if ( 'unapproved' === response.comment_status ) {\n\t\t\t\t\t\t\t\t\t\t$('#jp-carousel-comment-post-results').slideUp('fast').html('<span class=\"jp-carousel-comment-post-success\">' + jetpackCarouselStrings.comment_unapproved + '</span>').slideDown('fast');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// 'deleted', 'spam', false\n\t\t\t\t\t\t\t\t\t\t$('#jp-carousel-comment-post-results').slideUp('fast').html('<span class=\"jp-carousel-comment-post-error\">' + jetpackCarouselStrings.comment_post_error + '</span>').slideDown('fast');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tgallery.jp_carousel('clearCommentTextAreaValue');\n\t\t\t\t\t\t\t\t\tgallery.jp_carousel('getComments', {attachment_id: attachment_id, offset: 0, clear: true});\n\t\t\t\t\t\t\t\t\t$('#jp-carousel-comment-form-button-submit').val(jetpackCarouselStrings.post_comment);\n\t\t\t\t\t\t\t\t\t$('#jp-carousel-comment-form-spinner').spin(false);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terror: function(/*xhr, status, error*/) {\n\t\t\t\t\t\t\t\t\t// TODO: Add error handling and display here\n\t\t\t\t\t\t\t\t\tgallery.jp_carousel('postCommentError', {'field': 'jp-carousel-comment-form-comment-field', 'error': jetpackCarouselStrings.comment_post_error});\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( ! target.parents( '.jp-carousel-info' ).length ) {\n\t\t\t\t\t\tcontainer.jp_carousel('next');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('jp_carousel.afterOpen', function(){\n\t\t\t\t\t$(window).bind('keydown', keyListener);\n\t\t\t\t\t$(window).bind('resize', resizeListener);\n\t\t\t\t\tgallery.opened = true;\n\n\t\t\t\t\tresizeListener();\n\t\t\t\t})\n\t\t\t\t.bind('jp_carousel.beforeClose', function(){\n\t\t\t\t\tvar scroll = $(window).scrollTop();\n\n\t\t\t\t\t$(window).unbind('keydown', keyListener);\n\t\t\t\t\t$(window).unbind('resize', resizeListener);\n\t\t\t\t\t$(window).scrollTop(scroll);\n\t\t\t\t\t$( '.jp-carousel-previous-button' ).hide();\n\t\t\t\t\t$( '.jp-carousel-next-button' ).hide();\n\t\t\t\t})\n\t\t\t\t.bind('jp_carousel.afterClose', function(){\n\t\t\t\t\tif ( window.location.hash && history.back ) {\n\t\t\t\t\t\thistory.back();\n\t\t\t\t\t}\n\t\t\t\t\tlast_known_location_hash = '';\n\t\t\t\t\tgallery.opened = false;\n\t\t\t\t})\n\t\t\t\t.on( 'transitionend.jp-carousel ', '.jp-carousel-slide', function ( e ) {\n\t\t\t\t\t// If the movement transitions take more than twice the allotted time, disable them.\n\t\t\t\t\t// There is some wiggle room in the 2x, since some of that time is taken up in\n\t\t\t\t\t// JavaScript, setting up the transition and calling the events.\n\t\t\t\t\tif ( 'transform' === e.originalEvent.propertyName ) {\n\t\t\t\t\t\tvar transitionMultiplier = ( ( Date.now() - transitionBegin ) / 1000 ) / e.originalEvent.elapsedTime;\n\n\t\t\t\t\t\tcontainer.off( 'transitionend.jp-carousel' );\n\n\t\t\t\t\t\tif ( transitionMultiplier >= 2 ) {\n\t\t\t\t\t\t\t$( '.jp-carousel-transitions' ).removeClass( 'jp-carousel-transitions' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\t$( '.jp-carousel-wrap' ).touchwipe( {\n\t\t\t\t\twipeLeft : function ( e ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tgallery.jp_carousel( 'next' );\n\t\t\t\t\t},\n\t\t\t\t\twipeRight : function ( e ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tgallery.jp_carousel( 'previous' );\n\t\t\t\t\t},\n\t\t\t\t\tpreventDefaultEvents : false\n\t\t\t\t} );\n\n\t\t\tnextButton.add(previousButton).click(function(e){\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tif ( nextButton.is(this) ) {\n\t\t\t\t\tgallery.jp_carousel('next');\n\t\t\t\t} else {\n\t\t\t\t\tgallery.jp_carousel('previous');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\tvar processSingleImageGallery = function() {\n\t\t// process links that contain img tag with attribute data-attachment-id\n\t\t$( 'a img[data-attachment-id]' ).each(function() {\n\t\t\tvar container = $( this ).parent();\n\n\t\t\t// skip if image was already added to gallery by shortcode\n\t\t\tif( container.parent( '.gallery-icon' ).length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// skip if the container is not a link\n\t\t\tif ( 'undefined' === typeof( $( container ).attr( 'href' ) ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar valid = false;\n\n\t\t\t// if link points to 'Media File' (ignoring GET parameters) and flag is set allow it\n\t\t\tif ( $( container ).attr( 'href' ).split( '?' )[0] === $( this ).attr( 'data-orig-file' ).split( '?' )[0] &&\n\t\t\t\t1 === Number( jetpackCarouselStrings.single_image_gallery_media_file )\n\t\t\t) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\n\t\t\t// if link points to 'Attachment Page' allow it\n\t\t\tif( $( container ).attr( 'href' ) === $( this ).attr( 'data-permalink' ) ) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\n\t\t\t// links to 'Custom URL' or 'Media File' when flag not set are not valid\n\t\t\tif( ! valid ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// make this node a gallery recognizable by event listener above\n\t\t\t$( container ).addClass( 'single-image-gallery' ) ;\n\t\t\t// blog_id is needed to allow posting comments to correct blog\n\t\t\t$( container ).data( 'carousel-extra', { blog_id: Number( jetpackCarouselStrings.blog_id ) } );\n\t\t});\n\t};\n\n\tvar methods = {\n\t\ttestForData: function(gallery) {\n\t\t\tgallery = $( gallery ); // make sure we have it as a jQuery object.\n\t\t\treturn !( ! gallery.length || ! gallery.data( 'carousel-extra' ) );\n\t\t},\n\n\t\ttestIfOpened: function() {\n\t\t\treturn !!( 'undefined' !== typeof(gallery) && 'undefined' !== typeof(gallery.opened) && gallery.opened );\n\t\t},\n\n\t\topenOrSelectSlide: function( index ) {\n\t\t\t// The `open` method triggers an asynchronous effect, so we will get an\n\t\t\t// error if we try to use `open` then `selectSlideAtIndex` immediately\n\t\t\t// after it. We can only use `selectSlideAtIndex` if the carousel is\n\t\t\t// already open.\n\t\t\tif ( ! $( this ).jp_carousel( 'testIfOpened' ) ) {\n\t\t\t\t// The `open` method selects the correct slide during the\n\t\t\t\t// initialization.\n\t\t\t\t$( this ).jp_carousel( 'open', { start_index: index } );\n\t\t\t} else {\n\t\t\t\tgallery.jp_carousel( 'selectSlideAtIndex', index );\n\t\t\t}\n\t\t},\n\n\t\topen: function(options) {\n\t\t\tvar settings = {\n\t\t\t\t'items_selector' : '.gallery-item [data-attachment-id], .tiled-gallery-item [data-attachment-id], img[data-attachment-id]',\n\t\t\t\t'start_index': 0\n\t\t\t},\n\t\t\tdata = $(this).data('carousel-extra');\n\n\t\t\tif ( !data ) {\n\t\t\t\treturn; // don't run if the default gallery functions weren't used\n\t\t\t}\n\n\t\t\tprepareGallery( data );\n\n\t\t\tif ( gallery.jp_carousel( 'testIfOpened' ) ) {\n\t\t\t\treturn; // don't open if already opened\n\t\t\t}\n\n\t\t\t// make sure to stop the page from scrolling behind the carousel overlay, so we don't trigger\n\t\t\t// infiniscroll for it when enabled (Reader, theme infiniscroll, etc).\n\t\t\toriginalOverflow = $('body').css('overflow');\n\t\t\t$('body').css('overflow', 'hidden');\n\t\t\t// prevent html from overflowing on some of the new themes.\n\t\t\toriginalHOverflow = $('html').css('overflow');\n\t\t\t$('html').css('overflow', 'hidden');\n\t\t\tscrollPos = $( window ).scrollTop();\n\n\t\t\tcontainer.data('carousel-extra', data);\n\n\t\t\treturn this.each(function() {\n\t\t\t\t// If options exist, lets merge them\n\t\t\t\t// with our default settings\n\t\t\t\tvar $this = $(this);\n\n\t\t\t\tif ( options ) {\n\t\t\t\t\t$.extend( settings, options );\n\t\t\t\t}\n\t\t\t\tif ( -1 === settings.start_index ) {\n\t\t\t\t\tsettings.start_index = 0; //-1 returned if can't find index, so start from beginning\n\t\t\t\t}\n\n\t\t\t\tcontainer.trigger('jp_carousel.beforeOpen').fadeIn('fast',function(){\n\t\t\t\t\tcontainer.trigger('jp_carousel.afterOpen');\n\t\t\t\t\tgallery\n\t\t\t\t\t\t.jp_carousel('initSlides', $this.find(settings.items_selector), settings.start_index)\n\t\t\t\t\t\t.jp_carousel('selectSlideAtIndex', settings.start_index);\n\t\t\t\t});\n\t\t\t\tgallery.html('');\n\t\t\t});\n\t\t},\n\n\t\tselectSlideAtIndex : function(index){\n\t\t\tvar slides = this.jp_carousel('slides'), selected = slides.eq(index);\n\n\t\t\tif ( 0 === selected.length ) {\n\t\t\t\tselected = slides.eq(0);\n\t\t\t}\n\n\t\t\tgallery.jp_carousel('selectSlide', selected, false);\n\t\t\treturn this;\n\t\t},\n\n\t\tclose : function(){\n\t\t\t// make sure to let the page scroll again\n\t\t\t$('body').css('overflow', originalOverflow);\n\t\t\t$('html').css('overflow', originalHOverflow);\n\t\t\tthis.jp_carousel( 'clearCommentTextAreaValue' );\n\t\t\treturn container\n\t\t\t\t.trigger('jp_carousel.beforeClose')\n\t\t\t\t.fadeOut('fast', function(){\n\t\t\t\t\tcontainer.trigger('jp_carousel.afterClose');\n\t\t\t\t\t$( window ).scrollTop( scrollPos );\n\t\t\t\t});\n\n\t\t},\n\n\t\tnext : function() {\n\t\t\tthis.jp_carousel( 'previousOrNext', 'nextSlide' );\n\t\t},\n\n\t\tprevious : function() {\n\t\t\tthis.jp_carousel( 'previousOrNext', 'prevSlide' );\n\t\t},\n\n\t\tpreviousOrNext : function ( slideSelectionMethodName ) {\n\t\t\tif ( ! this.jp_carousel( 'hasMultipleImages' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar slide = gallery.jp_carousel( slideSelectionMethodName );\n\n\t\t\tif ( slide ) {\n\t\t\t\tcontainer.animate( { scrollTop: 0 }, 'fast' );\n\t\t\t\tthis.jp_carousel( 'clearCommentTextAreaValue' );\n\t\t\t\tthis.jp_carousel( 'selectSlide', slide );\n\t\t\t}\n\t\t},\n\n\n\n\t\tselectedSlide : function(){\n\t\t\treturn this.find('.selected');\n\t\t},\n\n\t\tsetSlidePosition : function(x) {\n\t\t\ttransitionBegin = Date.now();\n\n\t\t\treturn this.css({\n\t\t\t\t\t'-webkit-transform':'translate3d(' + x + 'px,0,0)',\n\t\t\t\t\t'-moz-transform':'translate3d(' + x + 'px,0,0)',\n\t\t\t\t\t'-ms-transform':'translate(' + x + 'px,0)',\n\t\t\t\t\t'-o-transform':'translate(' + x + 'px,0)',\n\t\t\t\t\t'transform':'translate3d(' + x + 'px,0,0)'\n\t\t\t});\n\t\t},\n\n\t\tupdateSlidePositions : function(animate) {\n\t\t\tvar current = this.jp_carousel( 'selectedSlide' ),\n\t\t\t\tgalleryWidth = gallery.width(),\n\t\t\t\tcurrentWidth = current.width(),\n\t\t\t\tprevious = gallery.jp_carousel( 'prevSlide' ),\n\t\t\t\tnext = gallery.jp_carousel( 'nextSlide' ),\n\t\t\t\tpreviousPrevious = previous.prev(),\n\t\t\t\tnextNext = next.next(),\n\t\t\t\tleft = Math.floor( ( galleryWidth - currentWidth ) * 0.5 );\n\n\t\t\tcurrent.jp_carousel( 'setSlidePosition', left ).show();\n\n\t\t\t// minimum width\n\t\t\tgallery.jp_carousel( 'fitInfo', animate );\n\n\t\t\t// prep the slides\n\t\t\tvar direction = lastSelectedSlide.is( current.prevAll() ) ? 1 : -1;\n\n\t\t\t// Since we preload the `previousPrevious` and `nextNext` slides, we need\n\t\t\t// to make sure they technically visible in the DOM, but invisible to the\n\t\t\t// user. To hide them from the user, we position them outside the edges\n\t\t\t// of the window.\n\t\t\t//\n\t\t\t// This section of code only applies when there are more than three\n\t\t\t// slides. Otherwise, the `previousPrevious` and `nextNext` slides will\n\t\t\t// overlap with the `previous` and `next` slides which must be visible\n\t\t\t// regardless.\n\t\t\tif ( 1 === direction ) {\n\t\t\t\tif ( ! nextNext.is( previous ) ) {\n\t\t\t\t\tnextNext.jp_carousel( 'setSlidePosition', galleryWidth + next.width() ).show();\n\t\t\t\t}\n\n\t\t\t\tif ( ! previousPrevious.is( next ) ) {\n\t\t\t\t\tpreviousPrevious.jp_carousel( 'setSlidePosition', -previousPrevious.width() - currentWidth ).show();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( ! nextNext.is( previous ) ) {\n\t\t\t\t\tnextNext.jp_carousel( 'setSlidePosition', galleryWidth + currentWidth ).show();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprevious.jp_carousel( 'setSlidePosition', Math.floor( -previous.width() + ( screenPadding * 0.75 ) ) ).show();\n\t\t\tnext.jp_carousel( 'setSlidePosition', Math.ceil( galleryWidth - ( screenPadding * 0.75 ) ) ).show();\n\t\t},\n\n\t\tselectSlide : function(slide, animate){\n\t\t\tlastSelectedSlide = this.find( '.selected' ).removeClass( 'selected' );\n\n\t\t\tvar slides = gallery.jp_carousel( 'slides' ).css({ 'position': 'fixed' }),\n\t\t\t\tcurrent = $( slide ).addClass( 'selected' ).css({ 'position': 'relative' }),\n\t\t\t\tattachmentId = current.data( 'attachment-id' ),\n\t\t\t\tprevious = gallery.jp_carousel( 'prevSlide' ),\n\t\t\t\tnext = gallery.jp_carousel( 'nextSlide' ),\n\t\t\t\tpreviousPrevious = previous.prev(),\n\t\t\t\tnextNext = next.next(),\n\t\t\t\tanimated,\n\t\t\t\tcaptionHtml;\n\n\t\t\t// center the main image\n\t\t\tgallery.jp_carousel( 'loadFullImage', current );\n\n\t\t\tcaption.hide();\n\n\t\t\tif ( next.length === 0 && slides.length <= 2 ) {\n\t\t\t\t$( '.jp-carousel-next-button' ).hide();\n\t\t\t} else {\n\t\t\t\t$( '.jp-carousel-next-button' ).show();\n\t\t\t}\n\n\t\t\tif ( previous.length === 0 && slides.length <= 2 ) {\n\t\t\t\t$( '.jp-carousel-previous-button' ).hide();\n\t\t\t} else {\n\t\t\t\t$( '.jp-carousel-previous-button' ).show();\n\t\t\t}\n\n\t\t\tanimated = current\n\t\t\t\t.add( previous )\n\t\t\t\t.add( previousPrevious )\n\t\t\t\t.add( next )\n\t\t\t\t.add( nextNext )\n\t\t\t\t.jp_carousel( 'loadSlide' );\n\n\t\t\t// slide the whole view to the x we want\n\t\t\tslides.not( animated ).hide();\n\n\t\t\tgallery.jp_carousel( 'updateSlidePositions', animate );\n\n\t\t\tcontainer.trigger( 'jp_carousel.selectSlide', [current] );\n\n\t\t\tgallery.jp_carousel( 'getTitleDesc', {\n\t\t\t\ttitle: current.data( 'title' ),\n\t\t\t\tdesc: current.data( 'desc' )\n\t\t\t});\n\n\t\t\tvar imageMeta = current.data( 'image-meta' );\n\t\t\tgallery.jp_carousel( 'updateExif', imageMeta );\n\t\t\tgallery.jp_carousel( 'updateFullSizeLink', current );\n\t\t\tgallery.jp_carousel( 'updateMap', imageMeta );\n\t\t\tgallery.jp_carousel( 'testCommentsOpened', current.data( 'comments-opened' ) );\n\t\t\tgallery.jp_carousel( 'getComments', {\n\t\t\t\t'attachment_id': attachmentId,\n\t\t\t\t'offset': 0,\n\t\t\t\t'clear': true\n\t\t\t});\n\t\t\t$( '#jp-carousel-comment-post-results' ).slideUp();\n\n\t\t\t// $('<div />').text(sometext).html() is a trick to go to HTML to plain\n\t\t\t// text (including HTML entities decode, etc)\n\t\t\tif ( current.data( 'caption' ) ) {\n\t\t\t\tcaptionHtml = $( '<div />' ).text( current.data( 'caption' ) ).html();\n\n\t\t\t\tif ( captionHtml === $( '<div />' ).text( current.data( 'title' ) ).html() ) {\n\t\t\t\t\t$( '.jp-carousel-titleanddesc-title' ).fadeOut( 'fast' ).empty();\n\t\t\t\t}\n\n\t\t\t\tif ( captionHtml === $( '<div />' ).text( current.data( 'desc' ) ).html() ) {\n\t\t\t\t\t$( '.jp-carousel-titleanddesc-desc' ).fadeOut( 'fast' ).empty();\n\t\t\t\t}\n\n\t\t\t\tcaption.html( current.data( 'caption' ) ).fadeIn( 'slow' );\n\t\t\t} else {\n\t\t\t\tcaption.fadeOut( 'fast' ).empty();\n\t\t\t}\n\n\t\t\t// Record pageview in WP Stats, for each new image loaded full-screen.\n\t\t\tif ( jetpackCarouselStrings.stats ) {\n\t\t\t\tnew Image().src = document.location.protocol +\n\t\t\t\t\t'//pixel.wp.com/g.gif?' +\n\t\t\t\t\tjetpackCarouselStrings.stats +\n\t\t\t\t\t'&post=' + encodeURIComponent( attachmentId ) +\n\t\t\t\t\t'&rand=' + Math.random();\n\t\t\t}\n\n\n\t\t\t// Load the images for the next and previous slides.\n\t\t\t$( next ).add( previous ).each( function() {\n\t\t\t\tgallery.jp_carousel( 'loadFullImage', $( this ) );\n\t\t\t});\n\n\t\t\twindow.location.hash = last_known_location_hash = '#jp-carousel-' + attachmentId;\n\t\t},\n\n\t\tslides : function(){\n\t\t\treturn this.find('.jp-carousel-slide');\n\t\t},\n\n\t\tslideDimensions : function(){\n\t\t\treturn {\n\t\t\t\twidth: $(window).width() - (screenPadding * 2),\n\t\t\t\theight: Math.floor( $(window).height() / 100 * proportion - 60 )\n\t\t\t};\n\t\t},\n\n\t\tloadSlide : function() {\n\t\t\treturn this.each(function(){\n\t\t\t\tvar slide = $(this);\n\t\t\t\tslide.find('img')\n\t\t\t\t\t.one('load', function(){\n\t\t\t\t\t\t// set the width/height of the image if it's too big\n\t\t\t\t\t\tslide\n\t\t\t\t\t\t\t.jp_carousel('fitSlide',false);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tbestFit : function(){\n\t\t\tvar max        = gallery.jp_carousel('slideDimensions'),\n\t\t\t    orig       = this.jp_carousel('originalDimensions'),\n\t\t\t    orig_ratio = orig.width / orig.height,\n\t\t\t    w_ratio    = 1,\n\t\t\t    h_ratio    = 1,\n\t\t\t    width, height;\n\n\t\t\tif ( orig.width > max.width ) {\n\t\t\t\tw_ratio = max.width / orig.width;\n\t\t\t}\n\t\t\tif ( orig.height > max.height ) {\n\t\t\t\th_ratio = max.height / orig.height;\n\t\t\t}\n\n\t\t\tif ( w_ratio < h_ratio ) {\n\t\t\t\twidth = max.width;\n\t\t\t\theight = Math.floor( width / orig_ratio );\n\t\t\t} else if ( h_ratio < w_ratio ) {\n\t\t\t\theight = max.height;\n\t\t\t\twidth = Math.floor( height * orig_ratio );\n\t\t\t} else {\n\t\t\t\twidth = orig.width;\n\t\t\t\theight = orig.height;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\t\t},\n\n\t\tfitInfo : function(/*animated*/){\n\t\t\tvar current = this.jp_carousel('selectedSlide'),\n\t\t\t\tsize = current.jp_carousel('bestFit');\n\n\t\t\tphoto_info.css({\n\t\t\t\t'left'  : Math.floor( (info.width() - size.width) * 0.5 ),\n\t\t\t\t'width' : Math.floor( size.width )\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\tfitMeta : function(animated){\n\t\t\tvar newInfoTop   = { top: Math.floor( $(window).height() / 100 * proportion + 5 ) + 'px' };\n\t\t\tvar newLeftWidth = { width: ( info.width() - (imageMeta.width() + 80) ) + 'px' };\n\n\t\t\tif (animated) {\n\t\t\t\tinfo.animate(newInfoTop);\n\t\t\t\tleftColWrapper.animate(newLeftWidth);\n\t\t\t} else {\n\t\t\t\tinfo.animate(newInfoTop);\n\t\t\t\tleftColWrapper.css(newLeftWidth);\n\t\t\t}\n\t\t},\n\n\t\tfitSlide : function(/*animated*/){\n\t\t\treturn this.each(function(){\n\t\t\t\tvar $this      = $(this),\n\t\t\t\t    dimensions = $this.jp_carousel('bestFit'),\n\t\t\t\t    method     = 'css',\n\t\t\t\t    max        = gallery.jp_carousel('slideDimensions');\n\n\t\t\t\tdimensions.left = 0;\n\t\t\t\tdimensions.top = Math.floor( (max.height - dimensions.height) * 0.5 ) + 40;\n\t\t\t\t$this[method](dimensions);\n\t\t\t});\n\t\t},\n\n\t\ttexturize : function(text) {\n\t\t\t\ttext = '' + text; // make sure we get a string. Title \"1\" came in as int 1, for example, which did not support .replace().\n\t\t\t\ttext = text.replace(/'/g, '&#8217;').replace(/&#039;/g, '&#8217;').replace(/[\\u2019]/g, '&#8217;');\n\t\t\t\ttext = text.replace(/\"/g, '&#8221;').replace(/&#034;/g, '&#8221;').replace(/&quot;/g, '&#8221;').replace(/[\\u201D]/g, '&#8221;');\n\t\t\t\ttext = text.replace(/([\\w]+)=&#[\\d]+;(.+?)&#[\\d]+;/g, '$1=\"$2\"'); // untexturize allowed HTML tags params double-quotes\n\t\t\t\treturn $.trim(text);\n\t\t},\n\n\t\tinitSlides : function(items, start_index){\n\t\t\tif ( items.length < 2 ) {\n\t\t\t\t$( '.jp-carousel-next-button, .jp-carousel-previous-button' ).hide();\n\t\t\t} else {\n\t\t\t\t$( '.jp-carousel-next-button, .jp-carousel-previous-button' ).show();\n\t\t\t}\n\n\t\t\t// Calculate the new src.\n\t\t\titems.each(function(/*i*/){\n\t\t\t\tvar src_item  = $(this),\n\t\t\t\t\torig_size = src_item.data('orig-size') || '',\n\t\t\t\t\tmax       = gallery.jp_carousel('slideDimensions'),\n\t\t\t\t\tparts     = orig_size.split(','),\n\t\t\t\t\tmedium_file     = src_item.data('medium-file') || '',\n\t\t\t\t\tlarge_file      = src_item.data('large-file') || '',\n\t\t\t\t\tsrc;\n\t\t\t\torig_size = {width: parseInt(parts[0], 10), height: parseInt(parts[1], 10)};\n\n\t\t\t\t\tsrc = src_item.data('orig-file');\n\n\t\t\t\t\tsrc = gallery.jp_carousel('selectBestImageSize', {\n\t\t\t\t\t\torig_file   : src,\n\t\t\t\t\t\torig_width  : orig_size.width,\n\t\t\t\t\t\torig_height : orig_size.height,\n\t\t\t\t\t\tmax_width   : max.width,\n\t\t\t\t\t\tmax_height  : max.height,\n\t\t\t\t\t\tmedium_file : medium_file,\n\t\t\t\t\t\tlarge_file  : large_file\n\t\t\t\t\t});\n\n\t\t\t\t// Set the final src\n\t\t\t\t$(this).data( 'gallery-src', src );\n\t\t\t});\n\n\t\t\t// If the start_index is not 0 then preload the clicked image first.\n\t\t\tif ( 0 !== start_index ) {\n\t\t\t\t$('<img/>')[0].src = $(items[start_index]).data('gallery-src');\n\t\t\t}\n\n\t\t\tvar useInPageThumbnails = items.first().closest( '.tiled-gallery.type-rectangular' ).length > 0;\n\n\t\t\t// create the 'slide'\n\t\t\titems.each(function(i){\n\t\t\t\tvar src_item        = $(this),\n\t\t\t\t\tattachment_id   = src_item.data('attachment-id') || 0,\n\t\t\t\t\tcomments_opened = src_item.data('comments-opened') || 0,\n\t\t\t\t\timage_meta      = src_item.data('image-meta') || {},\n\t\t\t\t\torig_size       = src_item.data('orig-size') || '',\n\t\t\t\t\tthumb_size      = { width : src_item[0].naturalWidth, height : src_item[0].naturalHeight },\n\t\t\t\t\ttitle           = src_item.data('image-title') || '',\n\t\t\t\t\tdescription     = src_item.data('image-description') || '',\n\t\t\t\t\tcaption         = src_item.parents('.gallery-item').find('.gallery-caption').html() || '',\n\t\t\t\t\tsrc\t\t= src_item.data('gallery-src') || '',\n\t\t\t\t\tmedium_file     = src_item.data('medium-file') || '',\n\t\t\t\t\tlarge_file      = src_item.data('large-file') || '',\n\t\t\t\t\torig_file\t= src_item.data('orig-file') || '';\n\n\t\t\t\tvar tiledCaption = src_item.parents('div.tiled-gallery-item').find('div.tiled-gallery-caption').html();\n\t\t\t\tif ( tiledCaption ) {\n\t\t\t\t\tcaption = tiledCaption;\n\t\t\t\t}\n\n\t\t\t\tif ( attachment_id && orig_size.length ) {\n\t\t\t\t\ttitle       = gallery.jp_carousel('texturize', title);\n\t\t\t\t\tdescription = gallery.jp_carousel('texturize', description);\n\t\t\t\t\tcaption     = gallery.jp_carousel('texturize', caption);\n\n\t\t\t\t\t// Initially, the image is a 1x1 transparent gif.  The preview is shown as a background image on the slide itself.\n\t\t\t\t\tvar image = $( '<img/>' )\n\t\t\t\t\t\t.attr( 'src', 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' )\n\t\t\t\t\t\t.css( 'width', '100%' )\n\t\t\t\t\t\t.css( 'height', '100%' );\n\n\t\t\t\t\tvar slide = $('<div class=\"jp-carousel-slide\" itemprop=\"associatedMedia\" itemscope itemtype=\"https://schema.org/ImageObject\"></div>')\n\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\t\t//'position' : 'fixed',\n\t\t\t\t\t\t\t\t'left'     : i < start_index ? -1000 : gallery.width()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.append( image )\n\t\t\t\t\t\t\t.appendTo(gallery)\n\t\t\t\t\t\t\t.data('src', src )\n\t\t\t\t\t\t\t.data('title', title)\n\t\t\t\t\t\t\t.data('desc', description)\n\t\t\t\t\t\t\t.data('caption', caption)\n\t\t\t\t\t\t\t.data('attachment-id', attachment_id)\n\t\t\t\t\t\t\t.data('permalink', src_item.parents('a').attr('href'))\n\t\t\t\t\t\t\t.data('orig-size', orig_size)\n\t\t\t\t\t\t\t.data('comments-opened', comments_opened)\n\t\t\t\t\t\t\t.data('image-meta', image_meta)\n\t\t\t\t\t\t\t.data('medium-file', medium_file)\n\t\t\t\t\t\t\t.data('large-file', large_file)\n\t\t\t\t\t\t\t.data('orig-file', orig_file)\n\t\t\t\t\t\t\t.data('thumb-size', thumb_size)\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif ( useInPageThumbnails ) {\n\t\t\t\t\t\t\t// Use the image already loaded in the gallery as a preview.\n\t\t\t\t\t\t\tslide\n\t\t\t\t\t\t\t\t.data( 'preview-image', src_item.attr( 'src' ) )\n\t\t\t\t\t\t\t\t.css( {\n\t\t\t\t\t\t\t\t\t'background-image' : 'url(\"' + src_item.attr( 'src' ) + '\")',\n\t\t\t\t\t\t\t\t\t'background-size' : '100% 100%',\n\t\t\t\t\t\t\t\t\t'background-position' : 'center center'\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tslide.jp_carousel( 'fitSlide', false );\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\tselectBestImageSize: function(args) {\n\t\t\tif ( 'object' !== typeof args ) {\n\t\t\t\targs = {};\n\t\t\t}\n\n\t\t\tif ( 'undefined' === typeof args.orig_file ) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif ( 'undefined' === typeof args.orig_width || 'undefined' === typeof args.max_width ) {\n\t\t\t\treturn args.orig_file;\n\t\t\t}\n\n\t\t\tif ( 'undefined' === typeof args.medium_file || 'undefined' === typeof args.large_file ) {\n\t\t\t\treturn args.orig_file;\n\t\t\t}\n\n\t\t\t// Check if the image is being served by Photon (using a regular expression on the hostname).\n\n\t\t\tvar imageLinkParser = document.createElement( 'a' );\n\t\t\timageLinkParser.href = args.large_file;\n\n\t\t\tvar isPhotonUrl = ( imageLinkParser.hostname.match( /^i[\\d]{1}.wp.com$/i ) != null );\n\n\t\t\tvar medium_size_parts\t= gallery.jp_carousel( 'getImageSizeParts', args.medium_file, args.orig_width, isPhotonUrl );\n\t\t\tvar large_size_parts\t= gallery.jp_carousel( 'getImageSizeParts', args.large_file, args.orig_width, isPhotonUrl );\n\n\t\t\tvar large_width       = parseInt( large_size_parts[0], 10 ),\n\t\t\t\tlarge_height      = parseInt( large_size_parts[1], 10 ),\n\t\t\t\tmedium_width      = parseInt( medium_size_parts[0], 10 ),\n\t\t\t\tmedium_height     = parseInt( medium_size_parts[1], 10 );\n\n\t\t\t// Assign max width and height.\n\t\t\targs.orig_max_width  = args.max_width;\n\t\t\targs.orig_max_height = args.max_height;\n\n\t\t\t// Give devices with a higher devicePixelRatio higher-res images (Retina display = 2, Android phones = 1.5, etc)\n\t\t\tif ( 'undefined' !== typeof window.devicePixelRatio && window.devicePixelRatio > 1 ) {\n\t\t\t\targs.max_width  = args.max_width * window.devicePixelRatio;\n\t\t\t\targs.max_height = args.max_height * window.devicePixelRatio;\n\t\t\t}\n\n\t\t\tif ( large_width >= args.max_width || large_height >= args.max_height ) {\n\t\t\t\treturn args.large_file;\n\t\t\t}\n\n\t\t\tif ( medium_width >= args.max_width || medium_height >= args.max_height ) {\n\t\t\t\treturn args.medium_file;\n\t\t\t}\n\n\t\t\tif ( isPhotonUrl ) {\n\t\t\t\t// args.orig_file doesn't point to a Photon url, so in this case we use args.large_file\n\t\t\t\t// to return the photon url of the original image.\n\t\t\t\tvar largeFileIndex = args.large_file.lastIndexOf( '?' );\n\t\t\t\tvar origPhotonUrl = args.large_file;\n\t\t\t\tif ( -1 !== largeFileIndex ) {\n\t\t\t\t\torigPhotonUrl = args.large_file.substring( 0, largeFileIndex );\n\t\t\t\t\t// If we have a really large image load a smaller version\n\t\t\t\t\t// that is closer to the viewable size\n\t\t\t\t\tif ( args.orig_width > args.max_width || args.orig_height > args.max_height ) {\n\t\t\t\t\t\torigPhotonUrl += '?fit=' + args.orig_max_width + '%2C' + args.orig_max_height;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn origPhotonUrl;\n\t\t\t}\n\n\t\t\treturn args.orig_file;\n\t\t},\n\n\t\tgetImageSizeParts: function( file, orig_width, isPhotonUrl ) {\n\t\t\tvar size\t\t= isPhotonUrl ?\n\t\t\t\t\t\t\tfile.replace( /.*=([\\d]+%2C[\\d]+).*$/, '$1' ) :\n\t\t\t\t\t\t\tfile.replace( /.*-([\\d]+x[\\d]+)\\..+$/, '$1' );\n\n\t\t\tvar size_parts  = ( size !== file ) ?\n\t\t\t\t\t\t\t( isPhotonUrl ? size.split( '%2C' ) : size.split( 'x' ) ) :\n\t\t\t\t\t\t\t[ orig_width, 0 ];\n\n\t\t\t// If one of the dimensions is set to 9999, then the actual value of that dimension can't be retrieved from the url.\n\t\t\t// In that case, we set the value to 0.\n\t\t\tif ( '9999' === size_parts[0] ) {\n\t\t\t\tsize_parts[0] = '0';\n\t\t\t}\n\n\t\t\tif ( '9999' === size_parts[1] ) {\n\t\t\t\tsize_parts[1] = '0';\n\t\t\t}\n\n\t\t\treturn size_parts;\n\t\t},\n\n\n\t\toriginalDimensions: function() {\n\t\t\tvar splitted = $(this).data('orig-size').split(',');\n\t\t\treturn {width: parseInt(splitted[0], 10), height: parseInt(splitted[1], 10)};\n\t\t},\n\n\t\tformat: function( args ) {\n\t\t\tif ( 'object' !== typeof args ) {\n\t\t\t\targs = {};\n\t\t\t}\n\t\t\tif ( ! args.text || 'undefined' === typeof args.text ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( ! args.replacements || 'undefined' === typeof args.replacements ) {\n\t\t\t\treturn args.text;\n\t\t\t}\n\t\t\treturn args.text.replace(/{(\\d+)}/g, function( match, number ) {\n\t\t\t\treturn typeof args.replacements[number] !== 'undefined' ? args.replacements[number] : match;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a number in a fraction format that represents the shutter speed.\n\t\t * @param Number speed\n\t\t * @return String\n\t\t */\n\t\tshutterSpeed: function( speed ) {\n\t\t\tvar denominator;\n\n\t\t\t// round to one decimal if value > 1s by multiplying it by 10, rounding, then dividing by 10 again\n\t\t\tif ( speed >= 1 ) {\n\t\t\t\treturn Math.round( speed * 10 ) / 10 + 's';\n\t\t\t}\n\n\t\t\t// If the speed is less than one, we find the denominator by inverting\n\t\t\t// the number. Since cameras usually use rational numbers as shutter\n\t\t\t// speeds, we should get a nice round number. Or close to one in cases\n\t\t\t// like 1/30. So we round it.\n\t\t\tdenominator = Math.round( 1 / speed );\n\n\t\t\treturn '1/' + denominator + 's';\n\t\t},\n\n\t\tparseTitleDesc: function( value ) {\n\t\t\tif ( !value.match(' ') && value.match('_') ) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t// Prefix list originally based on http://commons.wikimedia.org/wiki/MediaWiki:Filename-prefix-blacklist\n\t\t\t$([\n\t\t\t\t'CIMG',                   // Casio\n\t\t\t\t'DSC_',                   // Nikon\n\t\t\t\t'DSCF',                   // Fuji\n\t\t\t\t'DSCN',                   // Nikon\n\t\t\t\t'DUW',                    // some mobile phones\n\t\t\t\t'GEDC',                   // GE\n\t\t\t\t'IMG',                    // generic\n\t\t\t\t'JD',                     // Jenoptik\n\t\t\t\t'MGP',                    // Pentax\n\t\t\t\t'PICT',                   // misc.\n\t\t\t\t'Imagen',                 // misc.\n\t\t\t\t'Foto',                   // misc.\n\t\t\t\t'DSC',                    // misc.\n\t\t\t\t'Scan',                   // Scanners\n\t\t\t\t'SANY',                   // Sanyo\n\t\t\t\t'SAM',                    // Samsung\n\t\t\t\t'Screen Shot [0-9]+'      // Mac screenshots\n\t\t\t])\n\t\t\t.each(function(key, val){\n\t\t\t\tvar regex = new RegExp('^' + val);\n\t\t\t\tif ( regex.test(value) ) {\n\t\t\t\t\tvalue = '';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn value;\n\t\t},\n\n\t\tgetTitleDesc: function( data ) {\n\t\t\tvar title ='', desc = '', markup = '', target;\n\n\t\t\ttarget = $( 'div.jp-carousel-titleanddesc', 'div.jp-carousel-wrap' );\n\t\t\ttarget.hide();\n\n\t\t\ttitle = gallery.jp_carousel('parseTitleDesc', data.title) || '';\n\t\t\tdesc  = gallery.jp_carousel('parseTitleDesc', data.desc)  || '';\n\n\t\t\tif ( title.length || desc.length ) {\n\t\t\t\t// Convert from HTML to plain text (including HTML entities decode, etc)\n\t\t\t\tif ( $('<div />').html( title ).text() === $('<div />').html( desc ).text() ) {\n\t\t\t\t\ttitle = '';\n\t\t\t\t}\n\n\t\t\t\tmarkup  = ( title.length ) ? '<div class=\"jp-carousel-titleanddesc-title\">' + title + '</div>' : '';\n\t\t\t\tmarkup += ( desc.length )  ? '<div class=\"jp-carousel-titleanddesc-desc\">' + desc + '</div>'   : '';\n\n\t\t\t\ttarget.html( markup ).fadeIn('slow');\n\t\t\t}\n\n\t\t\t$( 'div#jp-carousel-comment-form-container' ).css('margin-top', '20px');\n\t\t\t$( 'div#jp-carousel-comments-loading' ).css('margin-top', '20px');\n\t\t},\n\n\t\t// updateExif updates the contents of the exif UL (.jp-carousel-image-exif)\n\t\tupdateExif: function( meta ) {\n\t\t\tif ( !meta || 1 !== Number( jetpackCarouselStrings.display_exif ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar $ul = $( '<ul class=\\'jp-carousel-image-exif\\'></ul>' );\n\n\t\t\t$.each( meta, function( key, val ) {\n\t\t\t\tif ( 0 === parseFloat(val) || !val.length || -1 === $.inArray( key, $.makeArray( jetpackCarouselStrings.meta_data ) ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch( key ) {\n\t\t\t\t\tcase 'focal_length':\n\t\t\t\t\t\tval = val + 'mm';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'shutter_speed':\n\t\t\t\t\t\tval = gallery.jp_carousel('shutterSpeed', val);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'aperture':\n\t\t\t\t\t\tval = 'f/' + val;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t$ul.append( '<li><h5>' + jetpackCarouselStrings[key] + '</h5>' + val + '</li>' );\n\t\t\t});\n\n\t\t\t// Update (replace) the content of the ul\n\t\t\t$( 'div.jp-carousel-image-meta ul.jp-carousel-image-exif' ).replaceWith( $ul );\n\t\t},\n\n\t\t// updateFullSizeLink updates the contents of the jp-carousel-image-download link\n\t\tupdateFullSizeLink: function(current) {\n\t\t\tif(!current || !current.data) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar original,\n\t\t\t\torigSize = current.data('orig-size').split(',' ),\n\t\t\t\timageLinkParser = document.createElement( 'a' );\n\n\t\t\timageLinkParser.href = current.data( 'src' ).replace( /\\?.+$/, '' );\n\n\t\t\t// Is this a Photon URL?\n\t\t\tif ( imageLinkParser.hostname.match( /^i[\\d]{1}.wp.com$/i ) !== null ) {\n\t\t\t\toriginal = imageLinkParser.href;\n\t\t\t} else {\n\t\t\t\toriginal = current.data('orig-file').replace(/\\?.+$/, '');\n\t\t\t}\n\n\t\t\tvar permalink = $( '<a>'+gallery.jp_carousel('format', {'text': jetpackCarouselStrings.download_original, 'replacements': origSize})+'</a>' )\n\t\t\t\t.addClass( 'jp-carousel-image-download' )\n\t\t\t\t.attr( 'href', original )\n\t\t\t\t.attr( 'target', '_blank' );\n\n\t\t\t// Update (replace) the content of the anchor\n\t\t\t$( 'div.jp-carousel-image-meta a.jp-carousel-image-download' ).replaceWith( permalink );\n\t\t},\n\n\t\tupdateMap: function( meta ) {\n\t\t\tif ( !meta.latitude || !meta.longitude || 1 !== Number( jetpackCarouselStrings.display_geo ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar latitude  = meta.latitude,\n\t\t\t\tlongitude = meta.longitude,\n\t\t\t\t$metabox  = $( 'div.jp-carousel-image-meta', 'div.jp-carousel-wrap' ),\n\t\t\t\t$mapbox   = $( '<div></div>' ),\n\t\t\t\tstyle     = '&scale=2&style=feature:all|element:all|invert_lightness:true|hue:0x0077FF|saturation:-50|lightness:-5|gamma:0.91';\n\n\t\t\t$mapbox\n\t\t\t\t.addClass( 'jp-carousel-image-map' )\n\t\t\t\t.html( '<img width=\"154\" height=\"154\" src=\"https://maps.googleapis.com/maps/api/staticmap?\\\n\t\t\t\t\t\t\tcenter=' + latitude + ',' + longitude + '&\\\n\t\t\t\t\t\t\tzoom=8&\\\n\t\t\t\t\t\t\tsize=154x154&\\\n\t\t\t\t\t\t\tsensor=false&\\\n\t\t\t\t\t\t\tmarkers=size:medium%7Ccolor:blue%7C' + latitude + ',' + longitude + style +'\" class=\"gmap-main\" />\\\n\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t<div class=\"gmap-topright\"><div class=\"imgclip\"><img width=\"175\" height=\"154\" src=\"https://maps.googleapis.com/maps/api/staticmap?\\\n\t\t\t\t\t\t\tcenter=' + latitude + ',' + longitude + '&\\\n\t\t\t\t\t\t\tzoom=3&\\\n\t\t\t\t\t\t\tsize=175x154&\\\n\t\t\t\t\t\t\tsensor=false&\\\n\t\t\t\t\t\t\tmarkers=size:small%7Ccolor:blue%7C' + latitude + ',' + longitude + style + '\"c /></div></div>\\\n\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t' )\n\t\t\t\t.prependTo( $metabox );\n\t\t},\n\n\t\ttestCommentsOpened: function( opened ) {\n\t\t\tif ( 1 === parseInt( opened, 10 ) ) {\n\t\t\t\t\t$('.jp-carousel-buttons').fadeIn('fast');\n\t\t\t\tcommentForm.fadeIn('fast');\n\t\t\t} else {\n\t\t\t\t\t$('.jp-carousel-buttons').fadeOut('fast');\n\t\t\t\tcommentForm.fadeOut('fast');\n\t\t\t}\n\t\t},\n\n\t\tgetComments: function( args ) {\n\t\t\tclearInterval( commentInterval );\n\n\t\t\tif ( 'object' !== typeof args ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( 'undefined' === typeof args.attachment_id || ! args.attachment_id ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! args.offset || 'undefined' === typeof args.offset || args.offset < 1 ) {\n\t\t\t\targs.offset = 0;\n\t\t\t}\n\n\t\t\tvar comments        = $('.jp-carousel-comments'),\n\t\t\t\tcommentsLoading = $('#jp-carousel-comments-loading').show();\n\n\t\t\tif ( args.clear ) {\n\t\t\t\tcomments.hide().empty();\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\ttype:       'GET',\n\t\t\t\turl:        jetpackCarouselStrings.ajaxurl,\n\t\t\t\tdataType:   'json',\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'get_attachment_comments',\n\t\t\t\t\tnonce:  jetpackCarouselStrings.nonce,\n\t\t\t\t\tid:     args.attachment_id,\n\t\t\t\t\toffset: args.offset\n\t\t\t\t},\n\t\t\t\tsuccess: function(data/*, status, xhr*/) {\n\t\t\t\t\tif ( args.clear ) {\n\t\t\t\t\t\tcomments.fadeOut('fast').empty();\n\t\t\t\t\t}\n\n\t\t\t\t\t$( data ).each(function(){\n\t\t\t\t\t\tvar comment = $('<div></div>')\n\t\t\t\t\t\t\t.addClass('jp-carousel-comment')\n\t\t\t\t\t\t\t.attr('id', 'jp-carousel-comment-' + this['id'])\n\t\t\t\t\t\t\t.html(\n\t\t\t\t\t\t\t\t  '<div class=\"comment-gravatar\">' +\n\t\t\t\t\t\t\t\t    this['gravatar_markup'] +\n\t\t\t\t\t\t\t\t  '</div>' +\n\t\t\t\t\t\t\t\t  '<div class=\"comment-author\">' +\n\t\t\t\t\t\t\t\t    this['author_markup'] +\n\t\t\t\t\t\t\t\t  '</div>' +\n\t\t\t\t\t\t\t\t  '<div class=\"comment-date\">' +\n\t\t\t\t\t\t\t\t    this['date_gmt'] +\n\t\t\t\t\t\t\t\t  '</div>' +\n\t\t\t\t\t\t\t\t  '<div class=\"comment-content\">' +\n\t\t\t\t\t\t\t\t    this['content'] +\n\t\t\t\t\t\t\t\t  '</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tcomments.append(comment);\n\n\t\t\t\t\t\t// Set the interval to check for a new page of comments.\n\t\t\t\t\t\tclearInterval( commentInterval );\n\t\t\t\t\t\tcommentInterval = setInterval( function() {\n\t\t\t\t\t\t\tif ( ( $('.jp-carousel-overlay').height() - 150 ) < $('.jp-carousel-wrap').scrollTop() + $(window).height() ) {\n\t\t\t\t\t\t\t\tgallery.jp_carousel('getComments',{ attachment_id: args.attachment_id, offset: args.offset + 10, clear: false });\n\t\t\t\t\t\t\t\tclearInterval( commentInterval );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 300 );\n\t\t\t\t\t});\n\n\t\t\t\t\t// Verify (late) that the user didn't repeatldy click the arrows really fast, in which case the requested\n\t\t\t\t\t// attachment id might no longer match the current attachment id by the time we get the data back or a now\n\t\t\t\t\t// registered infiniscroll event kicks in, so we don't ever display comments for the wrong image by mistake.\n\t\t\t\t\tvar current = $('.jp-carousel div.selected');\n\t\t\t\t\tif ( current && current.data && current.data('attachment-id') != args.attachment_id ) { // jshint ignore:line\n\t\t\t\t\t\tcomments.fadeOut('fast');\n\t\t\t\t\t\tcomments.empty();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Increase the height of the background, semi-transparent overlay to match the new length of the comments list.\n\t\t\t\t\t$('.jp-carousel-overlay').height( $(window).height() + titleAndDescription.height() + commentForm.height() + ( (comments.height() > 0) ? comments.height() : imageMeta.height() ) + 200 );\n\n\t\t\t\t\tcomments.show();\n\t\t\t\t\tcommentsLoading.hide();\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\t// TODO: proper error handling\n\t\t\t\t\tconsole.log( 'Comment get fail...', xhr, status, error );\n\t\t\t\t\tcomments.fadeIn('fast');\n\t\t\t\t\tcommentsLoading.fadeOut('fast');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tpostCommentError: function(args) {\n\t\t\tif ( 'object' !== typeof args ) {\n\t\t\t\targs = {};\n\t\t\t}\n\t\t\tif ( ! args.field || 'undefined' === typeof args.field ||  ! args.error || 'undefined' === typeof args.error ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$('#jp-carousel-comment-post-results').slideUp('fast').html('<span class=\"jp-carousel-comment-post-error\">'+args.error+'</span>').slideDown('fast');\n\t\t\t$('#jp-carousel-comment-form-spinner').spin(false);\n\t\t},\n\n\t\tsetCommentIframeSrc: function(attachment_id) {\n\t\t\tvar iframe = $('#jp-carousel-comment-iframe');\n\t\t\t// Set the proper irame src for the current attachment id\n\t\t\tif (iframe && iframe.length) {\n\t\t\t\tiframe.attr('src', iframe.attr('src').replace(/(postid=)\\d+/, '$1'+attachment_id) );\n\t\t\t\tiframe.attr('src', iframe.attr('src').replace(/(%23.+)?$/, '%23jp-carousel-'+attachment_id) );\n\t\t\t}\n\t\t},\n\n\t\tclearCommentTextAreaValue: function() {\n\t\t\tvar commentTextArea = $('#jp-carousel-comment-form-comment-field');\n\t\t\tif ( commentTextArea ) {\n\t\t\t\tcommentTextArea.val('');\n\t\t\t}\n\t\t},\n\n\t\tnextSlide : function () {\n\t\t\tvar slides = this.jp_carousel( 'slides' );\n\t\t\tvar selected = this.jp_carousel( 'selectedSlide' );\n\n\t\t\tif ( selected.length === 0 || ( slides.length > 2 && selected.is( slides.last() ) ) ) {\n\t\t\t\treturn slides.first();\n\t\t\t}\n\n\t\t\treturn selected.next();\n\t\t},\n\n\t\tprevSlide : function () {\n\t\t\tvar slides = this.jp_carousel( 'slides' );\n\t\t\tvar selected = this.jp_carousel( 'selectedSlide' );\n\n\t\t\tif ( selected.length === 0 || ( slides.length > 2 && selected.is( slides.first() ) ) ) {\n\t\t\t\treturn slides.last();\n\t\t\t}\n\n\t\t\treturn selected.prev();\n\t\t},\n\n\t\tloadFullImage : function ( slide ) {\n\t\t\tvar image = slide.find( 'img:first' );\n\n\t\t\tif ( ! image.data( 'loaded' ) ) {\n\t\t\t\t// If the width of the slide is smaller than the width of the \"thumbnail\" we're already using,\n\t\t\t\t// don't load the full image.\n\n\t\t\t\timage.on( 'load.jetpack', function () {\n\t\t\t\t\timage.off( 'load.jetpack' );\n\t\t\t\t\t$( this ).closest( '.jp-carousel-slide' ).css( 'background-image', '' );\n\t\t\t\t} );\n\n\t\t\t\tif ( ! slide.data( 'preview-image' ) || ( slide.data( 'thumb-size' ) && slide.width() > slide.data( 'thumb-size' ).width ) ) {\n\t\t\t\t\timage.attr( 'src', image.closest( '.jp-carousel-slide' ).data( 'src' ) ).attr('itemprop', 'image');\n\t\t\t\t} else {\n\t\t\t\t\timage.attr( 'src', slide.data( 'preview-image' ) ).attr('itemprop', 'image');\n\t\t\t\t}\n\n\t\t\t\timage.data( 'loaded', 1 );\n\t\t\t}\n\t\t},\n\n\t\thasMultipleImages : function () {\n\t\t\treturn gallery.jp_carousel('slides').length > 1;\n\t\t}\n\t};\n\n\t$.fn.jp_carousel = function(method){\n\t\t// ask for the HTML of the gallery\n\t\t// Method calling logic\n\t\tif ( methods[method] ) {\n\t\t\treturn methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));\n\t\t} else if ( typeof method === 'object' || ! method ) {\n\t\t\treturn methods.open.apply( this, arguments );\n\t\t} else {\n\t\t\t$.error( 'Method ' +\tmethod + ' does not exist on jQuery.jp_carousel' );\n\t\t}\n\n\t};\n\n\t// register the event listener for starting the gallery\n\t$( document.body ).on( 'click.jp-carousel', 'div.gallery,div.tiled-gallery, a.single-image-gallery', function(e) {\n\t\tif ( ! $(this).jp_carousel( 'testForData', e.currentTarget ) ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( $(e.target).parent().hasClass('gallery-caption') ) {\n\t\t\treturn;\n\t\t}\n\t\te.preventDefault();\n\n\t\t// Stopping propagation in case there are parent elements\n\t\t// with .gallery or .tiled-gallery class\n\t\te.stopPropagation();\n\t\t$(this).jp_carousel('open', {start_index: $(this).find('.gallery-item, .tiled-gallery-item').index($(e.target).parents('.gallery-item, .tiled-gallery-item'))});\n\t});\n\n\t// handle lightbox (single image gallery) for images linking to 'Attachment Page'\n\tif ( 1 === Number( jetpackCarouselStrings.single_image_gallery ) ) {\n\t\tprocessSingleImageGallery();\n\t\t$( document.body ).on( 'post-load', function() {\n\t\t\tprocessSingleImageGallery();\n\t\t} );\n\t}\n\n\t// Makes carousel work on page load and when back button leads to same URL with carousel hash (ie: no actual document.ready trigger)\n\t$( window ).on( 'hashchange.jp-carousel', function () {\n\n\t\tvar hashRegExp = /jp-carousel-(\\d+)/,\n\t\t\tmatches, attachmentId, galleries, selectedThumbnail;\n\n\t\tif ( ! window.location.hash || ! hashRegExp.test( window.location.hash ) ) {\n\t\t\tif ( gallery && gallery.opened ) {\n\t\t\t\tcontainer.jp_carousel( 'close' );\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ( window.location.hash === last_known_location_hash ) && gallery.opened ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( window.location.hash && gallery && !gallery.opened && history.back) {\n\t\t\thistory.back();\n\t\t\treturn;\n\t\t}\n\n\t\tlast_known_location_hash = window.location.hash;\n\t\tmatches = window.location.hash.match( hashRegExp );\n\t\tattachmentId = parseInt( matches[1], 10 );\n\t\tgalleries = $( 'div.gallery, div.tiled-gallery, a.single-image-gallery' );\n\n\t\t// Find the first thumbnail that matches the attachment ID in the location\n\t\t// hash, then open the gallery that contains it.\n\t\tgalleries.each( function( _, galleryEl ) {\n\t\t\t$( galleryEl ).find('img').each( function( imageIndex, imageEl ) {\n\t\t\t\tif ( $( imageEl ).data( 'attachment-id' ) === parseInt( attachmentId, 10 ) ) {\n\t\t\t\t\tselectedThumbnail = { index: imageIndex, gallery: galleryEl };\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif ( selectedThumbnail ) {\n\t\t\t\t$( selectedThumbnail.gallery )\n\t\t\t\t\t.jp_carousel( 'openOrSelectSlide', selectedThumbnail.index );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t});\n\n\tif ( window.location.hash ) {\n\t\t$( window ).trigger( 'hashchange' );\n\t}\n});\n\n/**\n * jQuery Plugin to obtain touch gestures from iPhone, iPod Touch and iPad, should also work with Android mobile phones (not tested yet!)\n * Common usage: wipe images (left and right to show the previous or next image)\n *\n * @author Andreas Waltl, netCU Internetagentur (http://www.netcu.de)\n * Version 1.1.1, modified to pass the touchmove event to the callbacks.\n */\n(function($) {\n$.fn.touchwipe = function(settings) {\n\tvar config = {\n\t\t\tmin_move_x: 20,\n\t\t\tmin_move_y: 20,\n\t\t\twipeLeft: function(/*e*/) { },\n\t\t\twipeRight: function(/*e*/) { },\n\t\t\twipeUp: function(/*e*/) { },\n\t\t\twipeDown: function(/*e*/) { },\n\t\t\tpreventDefaultEvents: true\n\t};\n\n\tif (settings) {\n\t\t$.extend(config, settings);\n\t}\n\n\tthis.each(function() {\n\t\tvar startX;\n\t\tvar startY;\n\t\tvar isMoving = false;\n\n\t\tfunction cancelTouch() {\n\t\t\tthis.removeEventListener('touchmove', onTouchMove);\n\t\t\tstartX = null;\n\t\t\tisMoving = false;\n\t\t}\n\n\t\tfunction onTouchMove(e) {\n\t\t\tif(config.preventDefaultEvents) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t\tif(isMoving) {\n\t\t\t\tvar x = e.touches[0].pageX;\n\t\t\t\tvar y = e.touches[0].pageY;\n\t\t\t\tvar dx = startX - x;\n\t\t\t\tvar dy = startY - y;\n\t\t\t\tif(Math.abs(dx) >= config.min_move_x) {\n\t\t\t\t\tcancelTouch();\n\t\t\t\t\tif(dx > 0) {\n\t\t\t\t\t\tconfig.wipeLeft(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.wipeRight(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(Math.abs(dy) >= config.min_move_y) {\n\t\t\t\t\t\tcancelTouch();\n\t\t\t\t\t\tif(dy > 0) {\n\t\t\t\t\t\t\tconfig.wipeDown(e);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconfig.wipeUp(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onTouchStart(e)\n\t\t{\n\t\t\tif (e.touches.length === 1) {\n\t\t\t\tstartX = e.touches[0].pageX;\n\t\t\t\tstartY = e.touches[0].pageY;\n\t\t\t\tisMoving = true;\n\t\t\t\tthis.addEventListener('touchmove', onTouchMove, false);\n\t\t\t}\n\t\t}\n\t\tif ('ontouchstart' in document.documentElement) {\n\t\t\tthis.addEventListener('touchstart', onTouchStart, false);\n\t\t}\n\t});\n\n\treturn this;\n};\n})(jQuery);\n"]}