{"version":3,"sources":["tiled-gallery/tiled-gallery/tiled-gallery.js"],"names":["$","TiledGalleryCollection","this","galleries","findAndSetupNewGalleries","TiledGallery","galleryElem","gallery","addCaptionEvents","resize","removeClass","attachResizeInAnimationFrames","tiledGalleries","handleFrame","resizeAll","resizing","requestAnimationFrame","resizeTimeout","window","clearTimeout","setTimeout","attachPlainResize","prototype","self","each","push","i","resizeableElementsSelector","find","hide","hover","stop","slideDown","slideUp","getExtraDimension","el","attribute","mode","left","right","parseInt","css","top","bottom","originalWidth","data","currentWidth","parent","width","resizeRatio","Math","min","thisGalleryElement","marginWidth","marginHeight","paddingWidth","paddingHeight","borderWidth","borderHeight","outerWidth","outerHeight","floor","height","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","document","ready","on","e","maybeResize","chrome","wp","customize","selectiveRefresh","bind","placement","isJetpackWidgetPlaced","jQuery"],"mappings":"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","file":"../../../tiled-gallery/tiled-gallery/tiled-gallery.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* jshint onevar:false, smarttabs:true */\n\n( function($) {\n\n\tfunction TiledGalleryCollection() {\n\t\tthis.galleries = [];\n\t\tthis.findAndSetupNewGalleries();\n\t}\n\n\tTiledGalleryCollection.prototype.findAndSetupNewGalleries = function() {\n\t\tvar self = this;\n\t\t$( '.tiled-gallery.tiled-gallery-unresized' ).each( function() {\n\t\t\tself.galleries.push( new TiledGallery( $( this ) ) );\n\t\t} );\n\t};\n\n\tTiledGalleryCollection.prototype.resizeAll = function() {\n\t\t$.each(this.galleries, function(i, gallery) {\n\t\t\tgallery.resize();\n\t\t} );\n\t};\n\n\tfunction TiledGallery( galleryElem ) {\n\t\tthis.gallery = galleryElem;\n\n\t\tthis.addCaptionEvents();\n\n\t\t// Resize when initialized to fit the gallery to window dimensions\n\t\tthis.resize();\n\n\t\t// Displays the gallery and prevents it from being initialized again\n\t\tthis.gallery.removeClass( 'tiled-gallery-unresized' );\n\t}\n\n\t/**\n\t * Selector for all resizeable elements inside a Tiled Gallery\n\t */\n\n\tTiledGallery.prototype.resizeableElementsSelector = '.gallery-row, .gallery-group, .tiled-gallery-item img';\n\n\t/**\n\t * Story\n\t */\n\n\tTiledGallery.prototype.addCaptionEvents = function() {\n\t\t// Hide captions\n\t\tthis.gallery.find( '.tiled-gallery-caption' ).hide();\n\n\t\t// Add hover effects to bring the caption up and down for each item\n\t\tthis.gallery.find( '.tiled-gallery-item' ).hover(\n\t\t\tfunction() { $( this ).find( '.tiled-gallery-caption' ).stop(true, true).slideDown( 'fast' ); },\n\t\t\tfunction() { $( this ).find( '.tiled-gallery-caption' ).stop(true, true).slideUp( 'fast' ); }\n\t\t);\n\t};\n\n\tTiledGallery.prototype.getExtraDimension = function( el, attribute, mode ) {\n\t\tif ( mode === 'horizontal' ) {\n\t\t\tvar left = ( attribute === 'border' ) ? 'borderLeftWidth' : attribute + 'Left';\n\t\t\tvar right = ( attribute === 'border' ) ? 'borderRightWidth' : attribute + 'Right';\n\t\t\treturn ( parseInt( el.css( left ), 10 ) || 0 ) +  ( parseInt( el.css( right ), 10 ) || 0 );\n\t\t} else if ( mode === 'vertical' ) {\n\t\t\tvar top = ( attribute === 'border' ) ? 'borderTopWidth' : attribute + 'Top';\n\t\t\tvar bottom = ( attribute === 'border' ) ? 'borderBottomWidth' : attribute + 'Bottom';\n\t\t\treturn ( parseInt( el.css( top ), 10 ) || 0 ) + ( parseInt( el.css( bottom ), 10 ) || 0 );\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t};\n\n\tTiledGallery.prototype.resize = function() {\n\t\t// Resize everything in the gallery based on the ratio of the current content width\n\t\t// to the original content width;\n\t\tvar originalWidth = this.gallery.data( 'original-width' );\n\t\tvar currentWidth = this.gallery.parent().width();\n\t\tvar resizeRatio = Math.min( 1, currentWidth / originalWidth );\n\n\t\tvar self = this;\n\t\tthis.gallery.find( this.resizeableElementsSelector ).each( function () {\n\t\t\tvar thisGalleryElement = $( this );\n\n\t\t\tvar marginWidth = self.getExtraDimension( thisGalleryElement, 'margin', 'horizontal' );\n\t\t\tvar marginHeight = self.getExtraDimension( thisGalleryElement, 'margin', 'vertical' );\n\n\t\t\tvar paddingWidth = self.getExtraDimension( thisGalleryElement, 'padding', 'horizontal' );\n\t\t\tvar paddingHeight = self.getExtraDimension( thisGalleryElement, 'padding', 'vertical' );\n\n\t\t\tvar borderWidth = self.getExtraDimension( thisGalleryElement, 'border', 'horizontal' );\n\t\t\tvar borderHeight = self.getExtraDimension( thisGalleryElement, 'border', 'vertical' );\n\n\t\t\t// Take all outer dimensions into account when resizing so that images\n\t\t\t// scale with constant empty space between them\n\t\t\tvar outerWidth = thisGalleryElement.data( 'original-width' ) + paddingWidth + borderWidth + marginWidth;\n\t\t\tvar outerHeight = thisGalleryElement.data( 'original-height' ) + paddingHeight + borderHeight + marginHeight;\n\n\t\t\t// Subtract margins so that images don't overflow on small browser windows\n\t\t\tthisGalleryElement\n\t\t\t\t.width( Math.floor( resizeRatio * outerWidth ) - marginWidth )\n\t\t\t\t.height( Math.floor( resizeRatio * outerHeight ) - marginHeight );\n\t\t} );\n\t};\n\n\t/**\n\t * Resizing logic\n\t */\n\n\tvar requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;\n\n\tfunction attachResizeInAnimationFrames( tiledGalleries ) {\n\t\tvar resizing = false;\n\t\tvar resizeTimeout = null;\n\n\t\tfunction handleFrame() {\n\t\t\ttiledGalleries.resizeAll();\n\t\t\tif ( resizing ) {\n\t\t\t\trequestAnimationFrame( handleFrame );\n\t\t\t}\n\t\t}\n\n\t\t$( window ).resize( function() {\n\t\t\tclearTimeout( resizeTimeout );\n\n\t\t\tif ( ! resizing ) {\n\t\t\t\trequestAnimationFrame( handleFrame );\n\t\t\t}\n\t\t\tresizing = true;\n\t\t\tresizeTimeout = setTimeout( function() {\n\t\t\t\tresizing = false;\n\t\t\t}, 15 );\n\t\t} );\n\t}\n\n\tfunction attachPlainResize( tiledGalleries ) {\n\t\t$( window ).resize( function() {\n\t\t\ttiledGalleries.resizeAll();\n\t\t} );\n\t}\n\n\t/**\n\t * Ready, set...\n\t */\n\n\t$( document ).ready( function() {\n\t\tvar tiledGalleries = new TiledGalleryCollection();\n\n\t\t$( 'body' ).on( 'post-load', function( e, maybeResize ) {\n\t\t\tif ( 'string' === typeof maybeResize && 'resize' === maybeResize ) {\n\t\t\t\ttiledGalleries.resizeAll();\n\t\t\t} else {\n\t\t\t\ttiledGalleries.findAndSetupNewGalleries();\n\t\t\t}\n\t\t} );\n\t\t$( document ).on( 'page-rendered.wpcom-newdash', function() {\n\t\t\ttiledGalleries.findAndSetupNewGalleries();\n\t\t} );\n\n\t\t// Chrome is a unique snow flake and will start lagging on occasion\n\t\t// It helps if we only resize on animation frames\n\t\t//\n\t\t// For other browsers it seems like there is no lag even if we resize every\n\t\t// time there is an event\n\t\tif ( window.chrome && requestAnimationFrame ) {\n\t\t\tattachResizeInAnimationFrames( tiledGalleries );\n\t\t} else {\n\t\t\tattachPlainResize( tiledGalleries );\n\t\t}\n\n\t\tif ( 'undefined' !== typeof wp && wp.customize && wp.customize.selectiveRefresh ) {\n\t\t\twp.customize.selectiveRefresh.bind( 'partial-content-rendered', function( placement ) {\n\t\t\t\tif ( wp.isJetpackWidgetPlaced( placement, 'gallery' ) ) {\n\t\t\t\t\ttiledGalleries.findAndSetupNewGalleries();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t});\n\n})(jQuery);\n"]}