{"version":3,"sources":["contact-form/js/editor-view.js"],"names":["$","wp","grunionEditorView","mce","views","grunion_wp_view_renderer","shortcode_string","template","field_templates","email","telephone","textarea","radio","checkbox","checkbox-multiple","select","date","text","name","url","edit_template","editor_inline","editor_option","getContent","field","named","content","this","shortcode","index","body","default_form","next","length","attrs","type","required","labels","required_field_text","options","split","submit_button_text","edit","data","update_callback","shortcode_data","$tinyMCE_document","tinyMCE","activeEditor","getDoc","$view","find","filter","attr","$editframe","fields","on","innerDoc","contentDocument","contentWindow","document","style","height","scrollHeight","execCommand","stylesheet_url","window","isRtl","inline_editing_style_rtl","inline_editing_style","$stylesheet","$dashicons_css","dashicons_css_url","contents","css","trigger","append","html","to","subject","focus","setTimeout","$editfields","$buttons","sortable","closest","className","val","e","preventDefault","remove","$new_option","before","new_data","children","each","field_shortcode","tag","label","push","join","string","$new_field","register","QTags","addButton","quicktags_label","insertContent","$wp_content_wrap","hasClass","console","error","jQuery"],"mappings":"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","file":"../../../contact-form/js/editor-view.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\n/* global grunionEditorView, tinyMCE, QTags, wp */\n( function( $, wp, grunionEditorView ) {\n\twp.mce = wp.mce || {};\n\tif ( 'undefined' === typeof wp.mce.views ) {\n\t\treturn;\n\t}\n\n\twp.mce.grunion_wp_view_renderer = {\n\t\tshortcode_string : 'contact-form',\n\t\ttemplate       : wp.template( 'grunion-contact-form' ),\n\t\tfield_templates: {\n\t\t\temail               : wp.template( 'grunion-field-email' ),\n\t\t\ttelephone           : wp.template( 'grunion-field-telephone' ),\n\t\t\ttextarea            : wp.template( 'grunion-field-textarea' ),\n\t\t\tradio               : wp.template( 'grunion-field-radio' ),\n\t\t\tcheckbox            : wp.template( 'grunion-field-checkbox' ),\n\t\t\t'checkbox-multiple' : wp.template( 'grunion-field-checkbox-multiple' ),\n\t\t\tselect              : wp.template( 'grunion-field-select' ),\n\t\t\tdate                : wp.template( 'grunion-field-date' ),\n\t\t\ttext                : wp.template( 'grunion-field-text' ),\n\t\t\tname                : wp.template( 'grunion-field-text' ),\n\t\t\turl                 : wp.template( 'grunion-field-url' )\n\t\t},\n\t\tedit_template  : wp.template( 'grunion-field-edit' ),\n\t\teditor_inline  : wp.template( 'grunion-editor-inline' ),\n\t\teditor_option  : wp.template( 'grunion-field-edit-option' ),\n\t\tgetContent     : function() {\n\t\t\tvar content = this.shortcode.content,\n\t\t\t\tindex = 0,\n\t\t\t\tfield, named,\n\t\t\t\tbody = '';\n\n\t\t\t// If it's the legacy `[contact-form /]` syntax, populate default fields.\n\t\t\tif ( ! content ) {\n\t\t\t\tcontent = grunionEditorView.default_form;\n\t\t\t}\n\n\t\t\t// Render the fields.\n\t\t\twhile ( ( field = wp.shortcode.next( 'contact-field', content, index ) ) ) {\n\t\t\t\tindex = field.index + field.content.length;\n\t\t\t\tnamed = field.shortcode.attrs.named;\n\t\t\t\tif ( ! named.type || ! this.field_templates[ named.type ] ) {\n\t\t\t\t\tnamed.type = 'text';\n\t\t\t\t}\n\t\t\t\tif ( named.required ) {\n\t\t\t\t\tnamed.required = grunionEditorView.labels.required_field_text;\n\t\t\t\t}\n\t\t\t\tif ( named.options && 'string' === typeof named.options ) {\n\t\t\t\t\tnamed.options = named.options.split( ',' );\n\t\t\t\t}\n\t\t\t\tbody += this.field_templates[ named.type ]( named );\n\t\t\t}\n\n\t\t\tvar options = {\n\t\t\t\tbody : body,\n\t\t\t\tsubmit_button_text : grunionEditorView.labels.submit_button_text\n\t\t\t};\n\n\t\t\treturn this.template( options );\n\t\t},\n\t\tedit: function( data, update_callback ) {\n\t\t\tvar shortcode_data = wp.shortcode.next( this.shortcode_string, data ),\n\t\t\t\tshortcode = shortcode_data.shortcode,\n\t\t\t\t$tinyMCE_document = $( tinyMCE.activeEditor.getDoc() ),\n\t\t\t\t$view = $tinyMCE_document.find( '.wpview.wpview-wrap' ).filter( function() {\n\t\t\t\t\treturn $( this ).attr( 'data-mce-selected' );\n\t\t\t\t} ),\n\t\t\t\t$editframe = $( '<iframe scrolling=\"no\" class=\"inline-edit-contact-form\" />' ),\n\t\t\t\tindex = 0,\n\t\t\t\tnamed,\n\t\t\t\tfields = '',\n\t\t\t\tfield;\n\n\t\t\tif ( ! shortcode.content ) {\n\t\t\t\tshortcode.content = grunionEditorView.default_form;\n\t\t\t}\n\n\t\t\t// Render the fields.\n\t\t\twhile ( ( field = wp.shortcode.next( 'contact-field', shortcode.content, index ) ) ) {\n\t\t\t\tindex = field.index + field.content.length;\n\t\t\t\tnamed = field.shortcode.attrs.named;\n\t\t\t\tif ( named.options && 'string' === typeof named.options ) {\n\t\t\t\t\tnamed.options = named.options.split( ',' );\n\t\t\t\t}\n\t\t\t\tfields += this.edit_template( named );\n\t\t\t}\n\n\t\t\t$editframe.on( 'checkheight', function() {\n\t\t\t\tvar innerDoc = ( this.contentDocument ) ? this.contentDocument : this.contentWindow.document;\n\t\t\t\tthis.style.height = '10px';\n\t\t\t\tthis.style.height = ( 5 + innerDoc.body.scrollHeight ) + 'px';\n\t\t\t\ttinyMCE.activeEditor.execCommand( 'wpAutoResize' );\n\t\t\t} );\n\n\t\t\t$editframe.on( 'load', function() {\n\t\t\t\tvar stylesheet_url = ( 1 === window.isRtl ) ? grunionEditorView.inline_editing_style_rtl : grunionEditorView.inline_editing_style,\n\t\t\t\t\t$stylesheet = $( '<link rel=\"stylesheet\" href=\"' + stylesheet_url + '\" />' ),\n\t\t\t\t\t$dashicons_css = $( '<link rel=\"stylesheet\" href=\"' + grunionEditorView.dashicons_css_url + '\" />' );\n\n\t\t\t\t$stylesheet.on( 'load', function() {\n\t\t\t\t\t$editframe.contents().find( 'body' ).css( 'visibility', 'visible' );\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t} );\n\t\t\t\t$editframe.contents().find( 'head' ).append( $stylesheet ).append( $dashicons_css );\n\n\t\t\t\t$editframe.contents().find( 'body' ).html( wp.mce.grunion_wp_view_renderer.editor_inline( {\n\t\t\t\t\tto      : shortcode.attrs.named.to,\n\t\t\t\t\tsubject : shortcode.attrs.named.subject,\n\t\t\t\t\tfields  : fields\n\t\t\t\t} ) ).css( 'visibility', 'hidden' );\n\n\t\t\t\t$editframe.contents().find( 'input:first' ).focus();\n\n\t\t\t\tsetTimeout( function(){\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t}, 250 );\n\n\t\t\t\t// Add a second timeout for super long forms racing, and to not slow it down for shorter forms unnecessarily.\n\t\t\t\tsetTimeout( function(){\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t}, 500 );\n\n\t\t\t\tvar $editfields = $editframe.contents().find( '.grunion-fields' ),\n\t\t\t\t\t$buttons = $editframe.contents().find( '.grunion-controls' );\n\n\t\t\t\t$editfields.sortable();\n\n\t\t\t\t// Now, add all the listeners!\n\n\t\t\t\t$editfields.on( 'change select', 'select[name=type]', function() {\n\t\t\t\t\t$( this ).closest( '.grunion-field-edit' )[ 0 ].className =\n\t\t\t\t\t\t'card is-compact grunion-field-edit grunion-field-' + $( this ).val();\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t} );\n\n\t\t\t\t$editfields.on( 'click', '.delete-option', function( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$( this ).closest( 'li' ).remove();\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t} );\n\n\t\t\t\t$editfields.on( 'click', '.add-option', function( e ) {\n\t\t\t\t\tvar $new_option = $( wp.mce.grunion_wp_view_renderer.editor_option() );\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$( this ).closest( 'li' ).before( $new_option );\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t\t$new_option.find( 'input:first' ).focus();\n\t\t\t\t} );\n\n\t\t\t\t$editfields.on( 'click', '.delete-field', function( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$( this ).closest( '.card' ).remove();\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t} );\n\n\t\t\t\t$buttons.find( 'input[name=submit]' ).on( 'click', function(){\n\t\t\t\t\tvar new_data = shortcode;\n\n\t\t\t\t\tnew_data.type = 'closed';\n\t\t\t\t\tnew_data.attrs = {};\n\t\t\t\t\tnew_data.content = '';\n\n\t\t\t\t\t$editfields.children().each( function() {\n\t\t\t\t\t\tvar field_shortcode = {\n\t\t\t\t\t\t\t\ttag   : 'contact-field',\n\t\t\t\t\t\t\t\ttype  : 'single',\n\t\t\t\t\t\t\t\tattrs : {\n\t\t\t\t\t\t\t\t\tlabel : $( this ).find( 'input[name=label]' ).val(),\n\t\t\t\t\t\t\t\t\ttype  : $( this ).find( 'select[name=type]' ).val()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toptions = [];\n\n\t\t\t\t\t\tif ( $( this ).find( 'input[name=required]:checked' ).length ) {\n\t\t\t\t\t\t\tfield_shortcode.attrs.required = '1';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$( this ).find( 'input[name=option]' ).each( function() {\n\t\t\t\t\t\t\tif ( $( this ).val() ) {\n\t\t\t\t\t\t\t\toptions.push( $( this ).val() );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tif ( options.length ) {\n\t\t\t\t\t\t\tfield_shortcode.attrs.options = options.join( ',' );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnew_data.content += wp.shortcode.string( field_shortcode );\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( $editframe.contents().find( 'input[name=to]' ).val() ) {\n\t\t\t\t\t\tnew_data.attrs.to = $editframe.contents().find( 'input[name=to]' ).val();\n\t\t\t\t\t}\n\t\t\t\t\tif ( $editframe.contents().find( 'input[name=subject]' ).val() ) {\n\t\t\t\t\t\tnew_data.attrs.subject = $editframe.contents().find( 'input[name=subject]' ).val();\n\t\t\t\t\t}\n\n\t\t\t\t\tupdate_callback( wp.shortcode.string( new_data ) );\n\t\t\t\t} );\n\n\t\t\t\t$buttons.find( 'input[name=cancel]' ).on( 'click', function() {\n\t\t\t\t\tupdate_callback( wp.shortcode.string( shortcode ) );\n\t\t\t\t} );\n\n\t\t\t\t$buttons.find( 'input[name=add-field]' ).on( 'click', function() {\n\t\t\t\t\tvar $new_field = $( wp.mce.grunion_wp_view_renderer.edit_template( {} ) );\n\t\t\t\t\t$editfields.append( $new_field );\n\t\t\t\t\t$editfields.sortable( 'refresh' );\n\t\t\t\t\t$editframe.trigger( 'checkheight' );\n\t\t\t\t\t$new_field.find( 'input:first' ).focus();\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t$view.html( $editframe );\n\t\t}\n\t};\n\twp.mce.views.register( 'contact-form', wp.mce.grunion_wp_view_renderer );\n\n\t// Add the 'text' editor button.\n\tQTags.addButton(\n\t\t'grunion_shortcode',\n\t\tgrunionEditorView.labels.quicktags_label,\n\t\tfunction() {\n\t\t\tQTags.insertContent( '[contact-form]' + grunionEditorView.default_form + '[/contact-form]' );\n\t\t}\n\t);\n\n\tvar $wp_content_wrap = $( '#wp-content-wrap' );\n\t$( '#insert-jetpack-contact-form' ).on( 'click', function( e ) {\n\t\te.preventDefault();\n\t\tif ( $wp_content_wrap.hasClass( 'tmce-active' ) ) {\n\t\t\ttinyMCE.execCommand( 'grunion_add_form' );\n\t\t} else if ( $wp_content_wrap.hasClass( 'html-active' ) ) {\n\t\t\tQTags.insertContent( '[contact-form]' + grunionEditorView.default_form + '[/contact-form]' );\n\t\t} else {\n\t\t\twindow.console.error( 'Neither TinyMCE nor QuickTags is active. Unable to insert form.' );\n\t\t}\n\t} );\n}( jQuery, wp, grunionEditorView ) );\n"]}